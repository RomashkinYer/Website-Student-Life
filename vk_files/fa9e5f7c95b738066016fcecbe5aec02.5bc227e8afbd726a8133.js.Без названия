"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[67370],{182780:(t,e,i)=>{i.d(e,{Player:()=>N,SECONDARY_ATTACHMENT_CLASS_MAP:()=>M});var s=i(434788),a=i(659397),n=i(75272),l=i(866310),o=i(606222),r=i(540842),d=i(792829),c=i(744986),u=i(769227),h=i(39356),_=i(333954),m=i(482522),A=i(182525),p=i(44804),y=i(220126),E=i(925189),v=i(437683),g=i(800523),f=i(72587);const{icon:S}=(0,o.getIcon28PlayCircle)(),{icon:T}=(0,r.getIcon28PauseCircle)(),{icon:I}=(0,d.getIcon24Play)(),{icon:C}=(0,c.getIcon24Pause)(),{icon:b}=(0,u.getIcon24Add)(),{icon:w}=(0,h.getIcon24Done)(),{icon:L}=(0,_.getIcon12Explicit)();var P,M;!function(t){t.PLAYLIST="secondary-attach-playlist",t.AUDIO="secondary-attach-audio"}(P||(P={})),function(t){t.JS_SECONDARY_ATTACHMENT="js-SecondaryAttachment",t.ADD_BUTTON="SecondaryAttachment__afterItem--iconAddButton",t.ACTIONS="SecondaryAttachment__actions",t.ACTIONS_ANIMATION="SecondaryAttachment__actions--animation",t.ACTIONS_ACTIVATED="SecondaryAttachment__actions--activated",t.ACTIONS_HIDDEN="SecondaryAttachment__actions--hidden",t.AFTER_ITEM_SLIDER="SecondaryAttachment__afterItemSlider",t.AFTER_ITEM_SLIDER_HIDDEN="SecondaryAttachment__afterItemSlider--hidden",t.AFTER_ITEM_SLIDER_ANIMATION_BEFORE="SecondaryAttachment__afterItemSlider--animationBefore",t.AFTER_ITEM_SLIDER_ANIMATION_AFTER="SecondaryAttachment__afterItemSlider--animationAfter",t.MAIN_RICH="SecondaryAttachment__mainRich",t.MAIN="SecondaryAttachment__main",t.MAIN_WITH_CONTENT_AFTER="SecondaryAttachment__main--withContentAfter",t.MAIN_WITH_ACTIONS="SecondaryAttachment__main--withActions",t.MAIN_ANIMATION_AFTER="SecondaryAttachment__main--animationAfter",t.DESCRIPTION="SecondaryAttachment__description",t.DESCRIPTION_SQUEEZED="SecondaryAttachment__description--squeezed",t.CONTENT_AFTER_WITH_ACTIONS="SecondaryAttachment__contentAfter--withActions",t.CONTENT_AFTER="SecondaryAttachment__contentAfter",t.CONTENT_AFTER_HIDDEN="SecondaryAttachment__contentAfter--hidden",t.CONTENT_AFTER_ITEM="SecondaryAttachment__contentAfterItem",t.CONTENT_AFTER_ITEM_ACTIVE="SecondaryAttachment__contentAfterItem--active",t.ICON_BUTTON_PAUSE="SecondaryAttachment__iconButton--audioPause",t.ICON_BUTTON_PLAY="SecondaryAttachment__iconButton--audioPlay"}(M||(M={}));class N{static getAudioDataFromElement(t){try{var e,i;return JSON.parse(null!=(i=null==(e=t)?void 0:e.dataset.audio)?i:"")}catch(t){return null}}static initial(){return{status:"stopped",currentTrack:null,currentNode:null,audioElementList:[],playlist:null,progress:0,duration:0,time:0}}static toTrack(t){if(!t)return null;const[e,i,s,a,n,l,o,,,,r,d,,c,u,,h,,,,_,m,p,,y]=t,[E,v,g,f,S,T,I]=c.split("/");return{kind:"Audio",id:e,owner_id:i,url:s,title:a,artist:n,duration:l,album_id:o,subtitle:h,trackCode:_,contentRestricted:m,albumPartNumber:p,accessKey:y,addHash:E,editHash:v,actionHash:g,deleteHash:f,replaceHash:S,urlHash:T,restoreHash:I,context:d,isExplicit:r===A.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_EXPLICIT_BIT,coverUrl:u}}static toAudio({id:t,owner_id:e,url:i,title:s,artist:a,duration:n,album_id:l,subtitle:o,trackCode:r,coverUrl:d,contentRestricted:c,albumPartNumber:u,accessKey:h="",addHash:_="",editHash:m="",actionHash:p="",deleteHash:y="",replaceHash:E="",urlHash:v="",restoreHash:g="",context:f="",isExplicit:S}){return[t,e,i,s,a,n,l||0,0,"",0,S?A.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_EXPLICIT_BIT:0,f,"[]",[_,m,p,y,E,v,g].join("/"),d||"",{},o||"","","",!1,r||"",c||0,u||0,!0,h||"",!1,""]}static coerceAttachAudioIntoAudioObject(t){var e,i,s,a,n,l,o,r,d,c,u,h;return{id:t.id,owner_id:t.owner_id,ownerId:t.owner_id,fullId:N.getFullIdFromTrack(t),title:t.title,subTitle:"",performer:t.artist,duration:t.duration,mainArtists:"",featArtists:"",authorLink:"",lyrics:"",url:t.url,flags:0,hasLyrics:!1,context:t.context,extra:"",accessKey:null!=(e=t.accessKey)?e:"",addHash:null!=(i=t.addHash)?i:"",editHash:null!=(s=t.editHash)?s:"",actionHash:null!=(a=t.actionHash)?a:"",deleteHash:null!=(n=t.deleteHash)?n:"",replaceHash:null!=(l=t.replaceHash)?l:"",urlHash:null!=(o=t.urlHash)?o:"",restoreHash:null!=(r=t.restoreHash)?r:"",canEdit:!1,canDelete:!1,isLongPerformer:!1,canAdd:!1,coverUrl_s:"",coverUrl_p:"",coverUrl_l:"",hasTrackPage:!1,trackPageId:"",isClaimed:!1,isFromQueue:!1,isExplicit:t.isExplicit,isUMA:!1,isReplaceable:!1,ads:{content_id:""},album:!1,albumId:t.album_id,albumPart:null!=(d=t.albumPartNumber)?d:0,trackCode:null!=(c=t.trackCode)?c:"",restrictionStatus:t.contentRestricted,chartInfo:!1,showInfo:t.showInfo,adminUrl:null!=(u=t.adminUrl)?u:"",umaQueryUrl:null!=(h=t.umaQueryUrl)?h:""}}constructor(t){if(this.sliders=[],this.listeners=[],this.state=N.initial(),this.eventEmitter=new f.Emitter,this.play=(t,e=0)=>{var i,s;if(!this.isListIncludeThisTrack(N.getFullIdFromTrack(t)))return;const a=N.toAudio(t);var n,l;const o=null!=(l=null!=(n=null==(i=this.state.currentNode)?void 0:i.dataset.outerPostId)?n:null==(s=this.state.currentNode)?void 0:s.dataset.currentPostId)?l:v.NO_POST_ID,r=this.player.getSharedFeedAudioEntryStore().getAllAudios(),d=(0,g.makeAttachAudioPlaylistParameters)(a,o),c=this.player.getCurrentAudio(),u=c&&N.getFullIdFromAudio(c),h=a&&N.getFullIdFromAudio(a);this.eventEmitter.emit(E.AttachPlayerEvents.PLAY,{isAudioChanged:u!==h||!c,attachElement:this.state.currentNode}),this.player.play(a,r,d),e>0&&this.player.seek(e)},this.togglePlayPlaylist=(t,e,i,a)=>{var n;const l=(null==(n=this.state.currentNode)?void 0:n.dataset)||{};"playing"===this.state.status&&"secondary-attach-playlist"===l.attachType&&l.playlistId===e?this.player.pause():(this.setState((0,s._)({},this.state,{currentNode:t})),this.player.playPlaylist(i,e,a))},this.pause=()=>{"playing"===this.state.status&&this.player.pause()},this.isExistElement=t=>!!this.state.audioElementList.find((e=>e===t)),this.getAttachType=()=>this.state.currentNode?this.state.currentNode.dataset.attachType:null,this.addAudioElementyToList=t=>{if(this.state.currentTrack){N.getFullIdFromTrack(this.state.currentTrack)===t.dataset.fullId&&this.updateControl(t,this.state.status)}if(this.isExistElement(t))return;this.setState({audioElementList:[...this.state.audioElementList,t]});const e=N.getAudioDataFromElement(t);if(e){var i;const a=this.player.getSharedFeedAudioEntryStore(),n=N.toAudio(e);var s;const l=null!=(s=null==(i=t.closest("[data-current-post-id]"))?void 0:i.getAttribute("data-current-post-id"))?s:v.NO_POST_ID;a.push(n,l)}},this.findAudioElByFullId=t=>this.state.audioElementList.find((e=>e.dataset.fullId===t)),this.getElementsByPostId=t=>this.state.audioElementList.filter((e=>e.dataset.currentPostId===t)),this.getAudioByPostId=t=>this.getElementsByPostId(t).map((t=>N.toAudio(JSON.parse(t.dataset.audio)))),this.isListIncludeThisTrack=t=>Boolean(this.findAudioElByFullId(t)),this.togglePlay=(t,e)=>{this.isNewTrack(t.id)&&this.setState((0,s._)({},N.initial(),{audioElementList:this.state.audioElementList})),"playing"===this.state.status?this.player.pause():(this.setState((0,s._)({},this.state,{currentNode:e})),this.play(t,0))},this.isNewTrack=t=>!!t&&!!this.state.currentTrack&&t!==this.state.currentTrack.id,this.updateControl=(t,e)=>{const[i]=t.getElementsByClassName(this.player.playButtonClass),[s]=t.getElementsByClassName(this.player.avatarContainerClass),a=t.closest(`.${this.player.secondaryAttachmentClass}`),l=s||null;if(i){i.firstElementChild&&i.removeChild(i.firstElementChild),a&&this.setAriaLabel(a,a.dataset.attachType,this.state.status);const[t,s]=this.resolvePlayIcon(),l=(0,n.createElementFromHTML)("playing"===e?s:t);this.updatePlayButtonStyle(i),i.appendChild(l)}if("playing"===e){var o;this.showAudioAttachmentControls(t);const e=(0,m.createAudioEqualizer)((0,m.makeEqualizerParams)(),l);null==(o=e)||o.classList.add(this.player.soundBarClass),(0,m.appendEqualizerToContainer)(l,e),this.makeSecondarySliders(t),this.player.isAdsPlaying()&&this.setTitleAndDescriptionForAds(t)}else(0,m.removeEqualizer)(l);s.classList["playing"===e?"add":"remove"](A.AUDIO_PLAYER_ENUMS.AUDIO_PLAYING_CLS)},this.makeSecondarySliders=t=>{var e,i;if(!this.player.features.isAudioPlayerRedesignEnabled)return;const s=null==(e=t)?void 0:e.querySelector(".SecondaryAttachment__actions");this.makeProgressSlider(s,t);const a=null==(i=t)?void 0:i.querySelector(".SecondaryAttachment__afterItemSlider");this.makeVolumeSlider(a)},this.makeProgressSlider=(t,e)=>{if(!t)return;if(t.querySelector(".slider"))return;const i=document.createElement("div");t.append(i);const s=new p.Slider(i,{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:t=>{const e=this.player.getCurrentAudio();return(0,y.formatAudioTime)({duration:e[A.EAudioTupleIndex.DURATION],progress:t})},onEndDragging:t=>{this.player.seek(t)}}),a=this.player.subscribe(this,l.events.PROGRESS,((t,i,a)=>{var n,l,o;const r=null==(n=e)?void 0:n.querySelector(".SecondaryAttachment__contentAfterItem"),d=this.player.getCurrentAudio();if(r){const t=this.player.isAdsPlaying()?(0,y.formatAudioTime)({duration:null!=a?a:0,progress:i}):(0,y.formatAudioTime)({duration:d[A.EAudioTupleIndex.DURATION],progress:i});r.textContent=t}null==(l=s)||l.toggleLoading(!1),null==(o=s)||o.setValue(i,!0,!1)})),n=this.player.subscribe(this,l.events.AD_STARTED,(()=>{s.setBlocked(!0),s.setBackValue(0),this.setTitleAndDescriptionForAds(e)})),o=this.player.subscribe(this,l.events.AD_COMPLETED,(()=>{s.setBlocked(!1),this.restoreTitleAndDescription(e)}));this.sliders.push({slider:s,sliderContainerElement:t,unsubscribe:()=>{a(),n(),o()}})},this.makeVolumeSlider=t=>{if(!t)return null;if(t.querySelector(".slider"))return;const e=document.createElement("div");t.append(e);const i=new p.Slider(e,{value:this.player.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:t=>Math.round(100*t)+"%",onChange:t=>this.player.setVolume(t)}),s=this.player.subscribe(this,l.events.VOLUME,((t,e)=>{var s;null==(s=i)||s.setValue(e,!1,!1)}));this.sliders.push({slider:i,sliderContainerElement:t,unsubscribe:s})},this.destroySliders=()=>{this.player.features.isAudioPlayerRedesignEnabled&&(this.sliders.forEach((t=>{t.unsubscribe(),t.slider.destroy()})),this.sliders=[])},this.getAddAudioButton=()=>{var t;if(this.player.features.isAudioPlayerRedesignEnabled)return null==(t=this.state.currentNode)?void 0:t.querySelector(".SecondaryAttachment__afterItem--iconAddButton")},this.resolvePlayIcon=()=>this.player.features.isAudioPlayerRedesignEnabled?[I,C]:[S,T],this.showAudioAttachmentControls=t=>{var e,i,s,a,n,l,o,r,d,c,u;if(!this.player.features.isAudioPlayerRedesignEnabled)return;null==(i=null==(e=t)?void 0:e.querySelector(".SecondaryAttachment__main"))||i.classList.add("SecondaryAttachment__main--withContentAfter","SecondaryAttachment__main--withActions","SecondaryAttachment__main--animationAfter");const h=null==(s=t)?void 0:s.querySelector(".SecondaryAttachment__contentAfter");null==(a=h)||a.classList.add("SecondaryAttachment__contentAfter--withActions"),null==(n=h)||n.classList.remove("SecondaryAttachment__contentAfter--hidden"),setTimeout((()=>{var e,i;null==(i=null==(e=t)?void 0:e.querySelector(".SecondaryAttachment__contentAfterItem"))||i.classList.add("SecondaryAttachment__contentAfterItem--active")}),0);const _=null==(l=t)?void 0:l.querySelector(".SecondaryAttachment__actions");null==(o=_)||o.classList.add("SecondaryAttachment__actions--animation"),null==(r=_)||r.classList.remove("SecondaryAttachment__actions--hidden");null==(d=_)||d.addEventListener("animationend",(()=>{var e;const i=null==(e=t)?void 0:e.querySelector(".SecondaryAttachment__actions");if(i){var s;null==(s=this.sliders.find((t=>t.sliderContainerElement.isSameNode(i))))||s.slider.resetWidthCache()}}),{once:!0});const m=null==(c=t)?void 0:c.querySelector(".SecondaryAttachment__afterItemSlider");null==(u=m)||u.classList.remove("SecondaryAttachment__afterItemSlider--hidden"),setTimeout((()=>{var t;null==(t=m)||t.classList.add("SecondaryAttachment__afterItemSlider--animationAfter")}),0)},this.hideAudioAttachmentControls=t=>{var e,i,s,a,n,l,o,r,d,c,u,h,_;if(!this.player.features.isAudioPlayerRedesignEnabled)return;null==(i=null==(e=t)?void 0:e.querySelector(".SecondaryAttachment__main"))||i.classList.remove("SecondaryAttachment__main--withContentAfter","SecondaryAttachment__main--withActions","SecondaryAttachment__main--animationAfter");const m=null==(s=t)?void 0:s.querySelector(".SecondaryAttachment__contentAfter");null==(a=m)||a.classList.remove("SecondaryAttachment__contentAfter--withActions"),null==(n=m)||n.classList.add("SecondaryAttachment__contentAfter--hidden");null==(o=null==(l=t)?void 0:l.querySelector(".SecondaryAttachment__contentAfterItem"))||o.classList.remove("SecondaryAttachment__contentAfterItem--active");const A=null==(r=t)?void 0:r.querySelector(".SecondaryAttachment__actions");null==(d=A)||d.classList.remove("SecondaryAttachment__actions--animation"),null==(c=A)||c.classList.add("SecondaryAttachment__actions--hidden");const p=null==(u=t)?void 0:u.querySelector(".SecondaryAttachment__afterItemSlider");null==(h=p)||h.classList.remove("SecondaryAttachment__afterItemSlider--animationAfter"),null==(_=p)||_.classList.add("SecondaryAttachment__afterItemSlider--hidden")},this.updatePlayButtonStyle=t=>{if(!this.player.features.isAudioPlayerRedesignEnabled)return!1;"playing"===this.state.status?(t.classList.add("SecondaryAttachment__iconButton--audioPause"),t.classList.remove("SecondaryAttachment__iconButton--audioPlay")):(t.classList.remove("SecondaryAttachment__iconButton--audioPause"),t.classList.add("SecondaryAttachment__iconButton--audioPlay"))},this.updateAllElements=(t=!1)=>{this.state.audioElementList.forEach((e=>{const i=this.state.currentTrack&&e.dataset.fullId===N.getFullIdFromTrack(this.state.currentTrack);!t&&i?this.updateControl(e,this.state.status):this.setDefaultElementState(e,Boolean(i))}))},this.addAudio=t=>{this.setState((0,s._)({},this.state,{currentNode:t}));const e=N.getAudioDataFromElement(t);e&&t&&this.player.addOrDeleteAudio(t,e)},this.audioIsObject=t=>!Array.isArray(t),this.setDefaultElementState=(t,e=!1)=>{if(t){const[i]=t.getElementsByClassName(this.player.playButtonClass),[s]=t.getElementsByClassName(this.player.avatarContainerClass),a=t.closest(`.${this.player.secondaryAttachmentClass}`),l=s||null;if(e||this.hideAudioAttachmentControls(t),this.player.isAdsPlaying()&&!e&&this.restoreTitleAndDescription(t),s.classList.contains(A.AUDIO_PLAYER_ENUMS.AUDIO_PLAYING_CLS)){a&&this.setAriaLabel(a,a.dataset.attachType,this.state.status),i.firstElementChild&&i.removeChild(i.firstElementChild);const[t]=this.resolvePlayIcon();this.updatePlayButtonStyle(i);const e=(0,n.createElementFromHTML)(t);i.appendChild(e)}(0,m.removeEqualizer)(l),s.classList.remove(A.AUDIO_PLAYER_ENUMS.AUDIO_PLAYING_CLS)}},this.resume=()=>{"paused"===this.state.status&&this.player.play()},this.stop=()=>{this.player.stop()},this.subscribe=t=>(this.listeners.push(t),()=>{this.listeners=this.listeners.filter((e=>e!==t))}),this.timeLeft=()=>{const t=Math.floor(this.state.duration-this.state.time);return"-"+(0,a.formatDuration)(t)},this.setState=t=>{this.state=(0,s._)({},this.state,t),this.listeners.forEach((t=>t(this.state)))},this.setTitleAndDescriptionForAds=t=>{var e,i,s;if(!this.player.features.isAudioPlayerRedesignEnabled)return!1;const a=null==(e=t)?void 0:e.querySelector(".SecondaryAttachment__childrenText"),n=null==(i=t)?void 0:i.querySelector(".SecondaryAttachmentTitleAfterIcon"),l=null==(s=t)?void 0:s.querySelector(".SecondaryAttachment__description");if(a&&(a.textContent=this.player.langMap.lang_ads),n&&(n.innerHTML=""),l){l.textContent="";const t=document.createTextNode(" ");l.append(t)}},this.restoreTitleAndDescription=t=>{var e,i,s;if(!this.player.features.isAudioPlayerRedesignEnabled)return!1;const n=null==(e=t)?void 0:e.querySelector(".SecondaryAttachment__childrenText"),l=null==(i=t)?void 0:i.querySelector(".SecondaryAttachmentTitleAfterIcon"),o=null==(s=t)?void 0:s.querySelector(".SecondaryAttachment__description"),r=N.getAudioDataFromElement(t);var d,c,u,h,_;n&&(n.textContent=(0,a.decodeHTMLEntities)(null!=(c=null==(d=r)?void 0:d.title)?c:""));l&&(l.innerHTML=(null==(u=r)?void 0:u.isExplicit)?L:"");o&&(o.textContent=(0,a.decodeHTMLEntities)(null!=(_=null==(h=r)?void 0:h.artist)?_:""))},this.setAriaLabel=(t,e,i)=>{if("secondary-attach-playlist"===e){const e=t.querySelector(".SecondaryAttachment__playlistButton");var s,a;if("playing"===i)null==(s=e)||s.setAttribute("aria-label",this.player.langMap.lang_pause);else null==(a=e)||a.setAttribute("aria-label",this.player.langMap.lang_play)}else{var n,l,o,r,d,c,u,h;if("playing"===i)t.setAttribute("aria-label",`${this.player.langMap.lang_pause} ${null!=(o=null==(n=this.state.currentTrack)?void 0:n.title)?o:""} ${null!=(r=null==(l=this.state.currentTrack)?void 0:l.artist)?r:""}`);else t.setAttribute("aria-label",`${this.player.langMap.lang_play} ${null!=(u=null==(d=this.state.currentTrack)?void 0:d.title)?u:""} ${null!=(h=null==(c=this.state.currentTrack)?void 0:c.artist)?h:""}`)}},N.instance)return N.instance;this.player=t;const e=Symbol();this.player.subscribe(this,l.events.MUSIC_AUDIOS_ADD,((...t)=>{var e,i;const s=(null==(e=t.find((t=>t&&t.audioElement)))?void 0:e.audioElement)||null;if(s&&(null==(i=this.state.currentNode)?void 0:i.isSameNode(s))){const t=this.getAddAudioButton();if(t){t.innerHTML="";const e=(0,n.createElementFromHTML)(w);t.setAttribute("aria-label",this.player.langMap.lang_remove_audio),t.append(e)}}})),this.player.subscribe(this,l.events.MUSIC_AUDIOS_DELETE,((...t)=>{var e,i;const s=(null==(e=t.find((t=>t&&t.audioElement)))?void 0:e.audioElement)||null;if(s&&(null==(i=this.state.currentNode)?void 0:i.isSameNode(s))){const t=this.getAddAudioButton();if(t){t.innerHTML="";const e=(0,n.createElementFromHTML)(b);t.setAttribute("aria-label",this.player.langMap.lang_add_audio),t.append(e)}}})),this.player.subscribe(this,l.events.PLAY_REQUESTED,(()=>{this.setState({status:"loading"})})),this.player.subscribe(e,l.events.PLAY,(()=>{var t;let e=this.player.getPreviousAudio(),i=this.player.getCurrentAudio();if(!i)return;const a=N.getFullIdFromAudio(i);let n=this.findAudioElByFullId(a),l=null;if(e&&(l=N.getFullIdFromAudio(e)),this.state.currentNode&&"secondary-attach-playlist"===(null==(t=this.state.currentNode)?void 0:t.dataset.attachType)&&(this.state.currentNode.dataset.fullId=a,this.state.currentNode&&this.addAudioElementyToList(this.state.currentNode),n=this.state.currentNode),!n)return this.setState((0,s._)({},N.initial(),{audioElementList:this.state.audioElementList})),this.destroySliders(),void this.updateAllElements(!0);l!==a&&this.destroySliders(),n&&this.state.currentNode&&n.dataset.fullId!==this.state.currentNode.dataset.fullId&&this.setDefaultElementState(this.state.currentNode),this.setState({status:"playing",currentTrack:N.toTrack(i)||null,currentNode:n||this.state.currentNode,progress:0,duration:i?i[5]:0,time:0}),this.updateAllElements()})),this.player.subscribe(this,l.events.PAUSE,(()=>{"stopped"!==this.state.status&&(this.setState({status:"paused",currentTrack:this.state.currentTrack,progress:this.state.progress||0,duration:this.state.duration||0,time:this.state.time||0}),this.updateAllElements(!0))})),this.player.subscribe(this,l.events.STOP,(()=>{this.setState((0,s._)({},N.initial(),{audioElementList:this.state.audioElementList})),this.updateAllElements(!0)})),this.player.subscribe(this,l.events.ENDED,(()=>{this.setState((0,s._)({},N.initial(),{audioElementList:this.state.audioElementList})),this.updateAllElements(!0)})),this.player.subscribe(this,l.events.PLAYLIST_CHANGED,(()=>{this.updateAllElements(!0)})),N.instance=this}}N.getFullIdFromAudio=t=>`${t[1]}_${t[0]}`,N.getFullIdFromTrack=t=>`${t.owner_id}_${t.id}`},925189:(t,e,i)=>{var s;i.d(e,{AttachPlayerEvents:()=>s}),function(t){t.PLAY="attach-player-event-play"}(s||(s={}))},800523:(t,e,i)=>{i.d(e,{getSharedFeedAudioEntryStore:()=>d,makeAttachAudioPlaylistParameters:()=>c});var s=i(321850),a=i(367431),n=i(182525),l=i(898194),o=i(587204);class r{static make(){return r.instance||(r.instance=new r,(0,s.pushNavDestroy)((()=>{r.instance.cleanUp()}))),r.instance}cleanUp(){this.audioEntries=[]}push(t,e){this.audioEntries.push({postId:e,audio:t})}getAllAudios(){return this.audioEntries.map((t=>t.audio))}constructor(){this.audioEntries=[]}}const d=(0,a.makeSharedState)("shared_feed_audio_entry_store_key",(()=>r.make()),{version:1});function c(t,e){const i=t[n.EAudioTupleIndex.CONTEXT],[s]=e.split("_");let a=window.cur.wallQuery||"";var r;let d=["own","full_own"].includes(null!=(r=window.cur.wallType)?r:"")?"own":"all";const c=(0,o.numberHashCode)(d+"_"+a),u=`${i}:${e}`,h=[n.AudioPlaylistContext.FEED],_=[n.AudioPlaylistContext.WALL,n.AudioPlaylistContext.USER_WALL,n.AudioPlaylistContext.GROUP_WALL];let m=l.AudioPlayerAdapterPlaylistType.TEMP;h.includes(i)?m=l.AudioPlayerAdapterPlaylistType.FEED:_.includes(i)&&(m=l.AudioPlayerAdapterPlaylistType.WALL);const A=e?`${m}_${e}`:"";return{type:m,ownerId:parseInt(s,10),albumId:c,contextWithId:u,context:i,playlistId:A,postId:e}}},437683:(t,e,i)=>{i.d(e,{NO_POST_ID:()=>a,THUMB_TYPE_ALBUM:()=>r,THUMB_TYPE_DOC:()=>n,THUMB_TYPE_MARKET_ALBUM:()=>d,THUMB_TYPE_PHOTO:()=>l,THUMB_TYPE_VIDEO:()=>o,addThumbsInData:()=>y,deleteThumbInData:()=>p,getThumbByIndex:()=>A,getThumbsMediaItems:()=>_,isValidThumbType:()=>c,moveThumbsInData:()=>m});var s=i(839470);const a="no_post_id",n="doc",l="photo",o="video",r="album",d="market_album";function c(t){const e=[n,l,o];return(0,s.partConfigEnabled)("attachments_primary_mode_web_feature")||e.push(r,d),!!~e.indexOf(t.toString())}const u=([t,,e])=>t===n?"editable"in e&&function(t){return t.editable&&"gif"!==t.ext}(e):c(t);var h;const _=t=>{var e;return null!=(h=null==(e=t)?void 0:e.filter(u))?h:[]};const m=(t,e,i)=>{const s=_(i),a=i.map((t=>c(t[0])?void 0:t)),n=s[t];return s.splice(t,1),s.splice(e,0,n),a.map((t=>t||s.shift()))},A=(t,e)=>_(e)[t],p=(t,e)=>{const i=A(t,e);return e.filter((t=>t!==i))},y=(t,e)=>{const[i,s]=t,a=e.findIndex((([t,e])=>t===i&&e===s));return a<0?e.push(t):e[a]=t,e}},482522:(t,e,i)=>{i.d(e,{appendEqualizerToContainer:()=>l,createAudioEqualizer:()=>n,makeEqualizerParams:()=>r,removeEqualizer:()=>o});var s=i(839470);const a=()=>{const t=document.createElement("div");t.classList.add("Equalizer__column");const e=document.createElement("div");return e.classList.add("Equalizer__row"),t.appendChild(e),t},n=(t,e)=>{var i;if(null==(i=e)?void 0:i.querySelector(".Equalizer"))return null;const s=document.createElement("div");s.classList.add("Equalizer","Equalizer--animation"),t.showAnimation&&s.classList.add("Equalizer--animation");const n=document.createElement("div");n.classList.add("Equalizer__container"),t.showTaller&&n.classList.add("Equalizer__container--taller"),s.append(n);let l=0;for(;l!==t.columnCount;){const t=a();n.appendChild(t),l++}return s},l=(t,e)=>{e&&t&&t.append(e)},o=t=>{var e,i;null==(i=null==(e=t)?void 0:e.querySelector(".Equalizer"))||i.remove()},r=()=>(0,s.partConfigEnabled)("feed_secondary_attachment_audio_redesign")?{columnCount:4,showTaller:!0,showAnimation:!0}:{columnCount:3,showTaller:!1,showAnimation:!1}},220126:(t,e,i)=>{i.d(e,{formatAudioTime:()=>a});var s=i(722082);function a({duration:t,progress:e,negative:i}){return i&&e<1?"-"+(0,s.formatTime)(Math.round(t-e*t)):(0,s.formatTime)(Math.round(e*t))}},898194:(t,e,i)=>{var s;i.d(e,{AudioPlayerAdapterPlaylistType:()=>s}),function(t){t.CURRENT="current",t.PLAYLIST="playlist",t.MY="my",t.ALBUM="album",t.TEMP="temp",t.RECOM="recoms",t.SEARCH="search",t.FEED="feed",t.LIVE="live",t.WALL="wall",t.RECENT="recent"}(s||(s={}))},587204:(t,e,i)=>{function s(t){let e=0;if(0===t.length)return e;for(let i=0,s=t.length;i<s;i++){e=(e<<5)-e+t.charCodeAt(i),e|=0}return e}i.d(e,{numberHashCode:()=>s})},333954:(t,e,i)=>{function s(){return{icon:'<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 9H5V4h3v1H6v1h2v1H6v1h2v1Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M1 3.5A2.5 2.5 0 0 1 3.5 1h6A2.5 2.5 0 0 1 12 3.5v6A2.5 2.5 0 0 1 9.5 12h-6A2.5 2.5 0 0 1 1 9.5v-6ZM3.5 2h6c.83 0 1.5.67 1.5 1.5v6c0 .83-.67 1.5-1.5 1.5h-6A1.5 1.5 0 0 1 2 9.5v-6C2 2.67 2.67 2 3.5 2Z" fill="currentColor"/></svg>',name:"explicit_12"}}i.d(e,{getIcon12Explicit:()=>s})},769227:(t,e,i)=>{function s(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="add_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="add_24__add_24"><path id="add_24__Bounds" d="M0 0h24v24H0z"/><path d="M13 11h6.5a1 1 0 0 1 0 2H13v6.5a1 1 0 0 1-2 0V13H4.5a1 1 0 0 1 0-2H11V4.5a1 1 0 0 1 2 0V11Z" id="add_24__Mask" fill="currentColor"/></g></g></svg>',name:"add_24"}}i.d(e,{getIcon24Add:()=>s})},39356:(t,e,i)=>{function s(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="done_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="done_24__done_24"><path id="done_24__Bounds" d="M0 0h24v24H0z"/><path d="m9 16.2-3.5-3.5a.99.99 0 1 0-1.4 1.4l4.2 4.2a1 1 0 0 0 1.4 0L20.3 7.7a.99.99 0 0 0-1.4-1.4L9 16.2Z" id="done_24__Mask" fill="currentColor"/></g></g></svg>',name:"done_24"}}i.d(e,{getIcon24Done:()=>s})},540842:(t,e,i)=>{function s(){return{icon:'<svg fill="none" height="28" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M28 14a14 14 0 1 1-28 0 14 14 0 0 1 28 0zM10 9.6c0-.33.27-.6.6-.6h1.8c.33 0 .6.27.6.6v8.8a.6.6 0 0 1-.6.6h-1.8a.6.6 0 0 1-.6-.6zm5 0c0-.33.27-.6.6-.6h1.8c.33 0 .6.27.6.6v8.8a.6.6 0 0 1-.6.6h-1.8a.6.6 0 0 1-.6-.6z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"pause_circle_28"}}i.d(e,{getIcon28PauseCircle:()=>s})},606222:(t,e,i)=>{function s(){return{icon:'<svg fill="none" height="28" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M28 14a14 14 0 1 1-28 0 14 14 0 0 1 28 0zm-8.98.87c.64-.39.64-1.36 0-1.74l-6.6-4c-.64-.38-1.42.1-1.42.87v8c0 .76.78 1.25 1.41.87z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"play_circle_28"}}i.d(e,{getIcon28PlayCircle:()=>s})},44804:(t,e,i)=>{i.d(e,{Slider:()=>n});var s=i(936134),a=i(664988);void 0===window.isTouch&&(window.isTouch=!1);class n{toggleLoading(t){t=!!t,window.toggle(this._progressEl,t),window.setStyle(this._progressEl,"opacity",t?1:0)}destroy(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));let t=window.re||window.remove;t(this._el),t(this._currHintEl)}resetWidthCache(){this._widthCache=null}_updateHint(t,e){if(!this._currHintEl){const t=document.createElement("div");t.className="slider_hint",t.id="slider_hint",this._currHintEl=t,this.options.hintClass&&this._currHintEl.classList.add(this.options.hintClass),this._el.appendChild(this._currHintEl)}let i=this._getPos(),s=Math.round((t.pageX||t.touches[0].pageX)-i[0]),a=this._width;if(s=e?Math.min(Math.max(0,s),a):s,s>=0&&s<=a){let t=s/a;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,t):t;let i=this._currHintEl.getBoundingClientRect();window.setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+s-(i.right-i.left)/2,top:this._slideEl.offsetTop-(i.bottom-i.top)-10}),!e&&this._toggleHint(!0)}else!e&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)}_toggleHint(t){this._currHintEl&&this._currHintEl.classList.toggle("visible",t)}_onMouseOver(t){n._currenSliderDrag||this._el.classList.contains("active")||this._updateHint(t)}_onMouseLeave(t){this._el.classList.contains("active")||this._toggleHint(!1)}get _width(){if(!this._widthCache){let t=this._el.getBoundingClientRect();this._widthCache=t.right-t.left}return this._widthCache}_onMouseDown(t){(0==t.button||t.touches)&&(this.blocked||(delete cur._sliderMouseUpNowEl,delete cur._sliderMouseUpTargetElement,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(t),n._currenSliderDrag=this,this._el.classList.add("active"),cancelEvent(t)))}_onMouseUp(t){cur._sliderMouseUpNowEl=this._el,cur._sliderMouseUpTargetElement=t.target,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),this._el.classList.remove("active"),n._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(t)}_onMouseMove(t){let e=this._getPos(),i=e[0];i=void 0!==t.touches&&t.touches.length>0?t.touches[0].pageX:t.pageX,i=Math.max(i,e[0]),i=Math.min(i,e[0]+this._width),i-=e[0],this.setValue(i/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(t,!0),cancelEvent(t)}_getPos(){return this._slidePos=window.getXY(this._slideEl)}_logf(t){if(!this.options.log)return t;let e=this.options.logfbase;return(Math.pow(e,t)-1)/(e-1)}_unlogf(t){if(!this.options.log)return t;let e=this.options.logfbase;return i=e,s=1+t*(e-1),Math.log(s)/Math.log(i);var i,s}setValue(t,e,i){if(this._el&&this._el.classList.contains("active")&&!i)return;let s=i?this._logf(t):t;if(this._currValue==s)return;this._currValue=s;let a=i?t:this._unlogf(t);const n=100*a+"%";this.options.useClippedPathProgress?window.setStyle(this._amountEl,{clipPath:`inset(0 ${100*(1-a)}% 0 0)`}):window.setStyle(this._amountEl,{width:n}),window.setStyle(this._handlerEl,{left:n}),!e&&this._onValueChange()}setBackValue(t){this._backEl&&this._backEl.classList.toggle("slider_back_transition",t>this._backValue),this._backValue=t;let e=100*t+"%";window.setStyle(this._backEl,{width:e})}setBlocked(t){this.blocked=t}_onValueChange(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))}constructor(t,e){if(!t)throw new Error("No element was provided for Slider");t="string"==typeof t||"number"==typeof t?document.getElementById(t):t,this.options=e||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=35),this.options.backValue=this.options.backValue||0;let i=100*this.options.backValue;const n=`<div class="slider_slide">\n        <div class="slider_loading_bar" style="opacity: 0; display: none;"></div>\n        ${this.options.withBackLine?'<div class="slider_back" style="width:'+i+'%"></div>':""}\n        <div class="slider_amount ${this.options.useClippedPathProgress?"slider_amount--clipped":""}"></div>\n        <div class="slider_handler"></div>\n      </div>`;this._el=document.createElement("div"),this._el.innerHTML=n,this._el.id=t.getAttribute("id")||"",this._el.className="slider";let l=this;if(t.classList){let e=t.classList;for(let t=0,i=e.length;t<i;t++)this._el.classList.add(e[t])}else this._el.className=t.className;(0,a.each)(this._el.attributes,(function(t,e){"id"==e.name&&"class"==e.name||l._el.setAttribute(e.name,e.value)})),t.parentNode.replaceChild(this._el,t),this._amountEl=this._el.querySelector(".slider_amount"),this._handlerEl=this._el.querySelector(".slider_handler"),this._slideEl=this._el.querySelector(".slider_slide"),this._backEl=this._el.querySelector(".slider_back"),this._progressEl=this._el.querySelector(".slider_loading_bar"),this.options.color&&(window.setStyle(this._amountEl,{backgroundColor:this.options.color}),window.setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&window.setStyle(this._slideEl,{backgroundColor:this.options.backColor}),this._el.classList.add("slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=(0,s.debounce)(this._onValueChange,this.options.debounce)),!isTouch&&e.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}}}}]);try{stManager.done("dist/fa9e5f7c95b738066016fcecbe5aec02.5bc227e8afbd726a8133.js")}catch(t){}
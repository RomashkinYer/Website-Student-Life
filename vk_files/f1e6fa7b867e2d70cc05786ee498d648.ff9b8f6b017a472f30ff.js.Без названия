"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[61957],{696023:(e,t,n)=>{n.d(t,{BrowserEnvProvider:()=>se,ChannelsProvider:()=>H,ConvosProvider:()=>L,ConvosSearchIndexProvider:()=>he,DispatchProvider:()=>C,FeatureFlagsProvider:()=>J,HelpHintsProvider:()=>x,InsertIntoCacheProvider:()=>pe,LastSeenProvider:()=>y,OrganisersProvider:()=>O,OwnerProvider:()=>Z,PeersProvider:()=>B,TypingsProvider:()=>F,VideoMessageShapesProvider:()=>ie,ViewerProvider:()=>te,isDepsShallowEqual:()=>g,matchAddEventListener:()=>E,useActualEffectCleanup:()=>m,useBrowserEnv:()=>re,useCallbackWithCustomCompare:()=>f,useChannels:()=>W,useCombinedRefs:()=>le,useConvos:()=>q,useConvosSearchIndex:()=>fe,useDebounced:()=>h,useDidUpdate:()=>u,useDispatch:()=>I,useFeatureFlags:()=>$,useHelpHints:()=>A,useInsertIntoCache:()=>me,useLastSeen:()=>b,useLayoutDidUpdate:()=>p,useMemoWithCustomCompare:()=>v,useNow:()=>N,useOnChange:()=>_,useOrganisers:()=>K,useOwner:()=>Y,usePeers:()=>T,usePixelDensity:()=>U,usePrevious:()=>l,useTypings:()=>P,useVideoMessageShapes:()=>ne,useViewer:()=>X,useViewport:()=>de});var o=n(434788),i=n(667294),r=n(96190),a=n(821551),s=n(83062),d=n(89131),c=n(991792);function l(e){const t=(0,i.useRef)();return(0,i.useEffect)((()=>{t.current=e}),[e]),t.current}function u(e,t){const n=(0,i.useRef)(!1);(0,i.useEffect)((()=>{if(n.current)return e()}),t),(0,i.useEffect)((()=>{n.current=!0}),[])}function p(e,t){const n=(0,i.useRef)(!1);(0,i.useLayoutEffect)((()=>{if(n.current)return e()}),t),(0,i.useLayoutEffect)((()=>{n.current=!0}),[])}function m(e,t){const n=(0,i.useRef)(t);n.current=t,(0,i.useEffect)((()=>()=>{t.some(((e,t)=>e!==n.current[t]))&&e()}),[...t,e]);const o=(0,i.useRef)(e);o.current=e,(0,i.useEffect)((()=>()=>{o.current()}),[])}function _(e,t,n=!0){const[o,r]=(0,i.useState)(n?void 0:t);(void 0===o||t.some(((e,t)=>o[t]!==e)))&&(r(t),e())}function h(e,t){const[n,r]=(0,i.useState)({debounced:e,debouncedUpdatesCount:0});return(0,i.useLayoutEffect)((()=>{if(0===t)return void r((t=>(0,o._)({},t,{debounced:e})));const n=setTimeout((()=>{r((({debouncedUpdatesCount:t})=>({debounced:e,debouncedUpdatesCount:t+1})))}),t);return()=>{clearTimeout(n)}}),[e,t]),n}function f(e,t,n){const o=(0,i.useRef)(e),r=(0,i.useRef)(t);return n(r.current,t)||(o.current=e,r.current=t),o.current}function v(e,t,n){const o=(0,i.useRef)(!1),r=(0,i.useRef)(!o.current&&e()),a=(0,i.useRef)(t);return n(a.current,t)||(r.current=e(),a.current=t),o.current=!0,r.current}function g(e,t){return t.every(((t,n)=>(0,d.isShallowEqual)(t,e[n])))}function b(e){const t=(0,i.useContext)(k);if(r.isUserPeerId(e))return t.get(e)}const k=i.createContext(new Map),y=k.Provider;function I(){const e=(0,i.useContext)(w);if(!e)throw new Error("DispatchProvider не добавлен в дерево Реакта!");return e}const w=i.createContext(null),C=w.Provider;function A(){const e=(0,i.useContext)(S);if(void 0===e)throw new Error("HelpHintsProvider не добавлен в дерево Реакта!");return e}const S=i.createContext(new Set),x=S.Provider;function P(e,t="full",n=3){const o=(0,i.useContext)(M),a=T(),{lang:s}=re(),d=o.get(e);if(!d)return;const l=e=>"full"===t?r.name(e):r.shortName(e),u=[],p=new Set;for(const e of c.TypingVariants){const t=d[e];t&&(u.push(e),t.peerIds.forEach((e=>p.add(e))))}const m=u.length>1?"text":u[0]||"text";if(0===n)return{text:s.use(`me_typing_${m}`),type:m};const _=[];for(const e of p){const t=a.get(e);if(t&&(_.push(t),_.length===n))break}let h;const f=p.size-_.length;switch(!0){case 0===_.length&&f>0:h=s.use("me_typing_people",{num:f});break;case f>0:h=_.map(l).join(", "),h=s.use("me_typing_names_lots",{num:f,values:{names:h}});break;case _.length>1:{const e=_.length>n-1?_.slice(0,n-1).map(l).join(", "):_[0]?l(_[0]):"",t=_[_.length-1],o=t?l(t):"";h=s.use("me_typing_names_couple",{values:{before:e,after:o}});break}case 1===_.length:h=_[0]?r.name(_[0]):"";break;default:h=""}return{text:"compact"===t?h:s.use(`me_typing_${m}_named`,{num:_.length+f,values:{names:h}}),type:m}}const M=i.createContext(new Map),F=M.Provider,R=()=>window.devicePixelRatio>=1.25;function U(){const[e,t]=(0,i.useState)(R);return(0,i.useEffect)((()=>E(window.matchMedia("(resolution: 1.25dppx)"),(()=>{t(R)}))),[]),e}function E(e,t){try{return e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}}catch(n){return e.addListener(t),()=>{e.removeListener(t)}}}function N(e=6e4){const[t,n]=(0,i.useState)(Date.now);return(0,i.useLayoutEffect)((()=>{const t=setInterval((()=>{n(Date.now())}),e);return()=>clearInterval(t)}),[e]),t}function T(){return(0,i.useContext)(D)}const D=i.createContext(new Map),B=D.Provider;function q(){return(0,i.useContext)(j)}const j=i.createContext(new Map),L=j.Provider;function K(){return(0,i.useContext)(G)}const G=i.createContext(s.empty()),O=G.Provider;function W(){return(0,i.useContext)(V)}const V=i.createContext(new Map),H=V.Provider;function $(){const e=(0,i.useContext)(z);if(!e)throw new Error("FeatureFlagsProvider не добавлен в дерево Реакта!");return e}const z=i.createContext(null),J=z.Provider;function Y(){const e=(0,i.useContext)(Q);if(!e)throw new Error("OwnerProvider не добавлен в дерево Реакта!");return e}const Q=i.createContext(null),Z=Q.Provider;function X(){const e=(0,i.useContext)(ee);if(!e)throw new Error("ViewerProvider не добавлен в дерево Реакта!");return e}const ee=i.createContext(null),te=ee.Provider;function ne(){return(0,i.useContext)(oe)}const oe=i.createContext(new Map),ie=oe.Provider;function re(){const e=(0,i.useContext)(ae);if(!e)throw new Error("BrowserEnvProvider не добавлен в дерево Реакта!");return e}const ae=i.createContext(null),se=ae.Provider;function de({debounced:e=!1}){const[t,n]=(0,i.useState)(ce),o=(0,i.useRef)((0,d.debounce)(n,300,!1));return(0,i.useLayoutEffect)((()=>{const t=o.current,i=()=>{e?t(ce()):n(ce())};return window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i),e&&t.cancel()}}),[e]),t}function ce(){return"undefined"==typeof window?[0,0]:[document.documentElement.clientWidth,document.documentElement.clientHeight]}function le(...e){const t=(0,i.useRef)(null);return i.useEffect((()=>{e.forEach((e=>{e&&("function"==typeof e?e(t.current):e.current=t.current)}))}),[e]),t}const ue=i.createContext(null),pe=ue.Provider;function me(){const e=(0,i.useContext)(ue);if(!e)throw new Error("InsertIntoCacheProvider не добавлен в дерево Реакта!");return e}const _e=i.createContext(a.create()),he=_e.Provider;function fe(){return(0,i.useContext)(_e)}},398255:(e,t,n)=>{n.d(t,{PEER_FLAG_BUSINESS_NOTIFY:()=>o});const o=8192},859352:(e,t,n)=>{function o(e){return e}n.d(t,{resolveEventId:()=>o})},452788:(e,t,n)=>{n.d(t,{empty:()=>r,getLockId:()=>d,isLoaded:()=>c,push:()=>l,refresh:()=>u,snakeCaseId:()=>s,sorter:()=>m,updateCounters:()=>p});var o=n(434788),i=n(839963);function r(){const e={channelIds:new Set,hasMore:!0,unreadCount:0,unreadUnmutedCount:0,totalCount:0,boundary:{channelId:i.resolveId(0),majorSortId:1/0,minorSortId:1/0}};return{all:(0,o._)({kind:"all"},e),unread:(0,o._)({kind:"unread"},e),archive:(0,o._)({kind:"archive",isHidden:!1},e)}}const a={all:"all",unread:"unread",archive:"archived"};function s(e){return a[e]}function d(e){return`filter_${e}`}function c(e){return e.boundary.minorSortId!==1/0&&e.boundary.majorSortId!==1/0}function l(e,t,n,o){for(const o of n)_(e,t,o),u(e,o);e[t].hasMore=o,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0,channelId:i.resolveId(0)})}function u(e,t){e.all.channelIds.delete(t.id),e.unread.channelIds.delete(t.id),e.archive.channelIds.delete(t.id),t.isMember&&(t.isArchived?h(e.archive,t)&&e.archive.channelIds.add(t.id):(h(e.all,t)&&e.all.channelIds.add(t.id),i.isUnread(t)&&h(e.unread,t)&&e.unread.channelIds.add(t.id)))}function p(e,{unread:t,archiveTotal:n,unreadUnmuted:o}){void 0!==t&&(e.all.unreadCount=t,e.unread.unreadCount=t),void 0!==o&&(e.all.unreadUnmutedCount=o,e.unread.unreadUnmutedCount=o),void 0!==n&&(e.archive.totalCount=n)}function m(e,t){var n,o;if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;const r=i.lastPost({channel:e,withPending:!0}),a=i.lastPost({channel:t,withPending:!0});var s,d,c,l;return"Pending"===(null==(n=r)?void 0:n.kind)||"Pending"===(null==(o=a)?void 0:o.kind)?(null!=(c=null==(s=a)?void 0:s.sentAt)?c:0)-(null!=(l=null==(d=r)?void 0:d.sentAt)?l:0):t.minorSortId!==e.minorSortId?t.minorSortId-e.minorSortId:e.id-t.id}function _(e,t,n){i.isHidden(n)||(n.majorSortId<e[t].boundary.majorSortId?e[t].boundary={channelId:n.id,majorSortId:n.majorSortId,minorSortId:n.minorSortId}:n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId<e[t].boundary.minorSortId?(e[t].boundary.channelId=n.id,e[t].boundary.minorSortId=n.minorSortId):n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId===e[t].boundary.minorSortId&&(e[t].boundary.channelId=n.id),"all"===t&&_(e,"unread",n))}function h(e,t){return!i.isHidden(t)&&(!(t.majorSortId<e.boundary.majorSortId)&&(t.majorSortId>e.boundary.majorSortId||!(t.minorSortId<e.boundary.minorSortId)&&(t.minorSortId>e.boundary.minorSortId||!(t.id>e.boundary.channelId))))}},498928:(e,t,n)=>{n.d(t,{empty:()=>s,getLockId:()=>u,isLoaded:()=>l,isVisible:()=>p,push:()=>m,refresh:()=>_,snakeCaseId:()=>c,sorter:()=>f,toggleBusinessNotifyVisibility:()=>v,updateCounters:()=>h});var o=n(434788),i=n(185327),r=n(168465),a=n(89131);function s(){const e={peerIds:new Set,hasMore:!0,unreadCount:0,unreadUnmutedCount:0,totalCount:0,boundary:{majorSortId:1/0,minorSortId:1/0}};return{all:(0,o._)({kind:"all"},e),unread:(0,o._)({kind:"unread",headerNotMutedUnread:0},e),chats:(0,o._)({kind:"chats"},e),archive:(0,o._)({kind:"archive",hasMentions:!1},e),messageRequest:(0,o._)({kind:"messageRequest"},e),businessNotify:(0,o._)({kind:"businessNotify",isHidden:!1},e)}}const d={all:"all",unread:"unread",chats:"chats",messageRequest:"message_request",businessNotify:"business_notify",archive:"archive"};function c(e){return d[e]}function l(e){return e.boundary.majorSortId!==1/0&&e.boundary.minorSortId!==1/0}function u(e){return`filter_${e}`}function p(e){switch(e.kind){case"all":case"unread":case"chats":case"archive":return!0;case"messageRequest":return e.peerIds.size>0||e.hasMore;case"businessNotify":return!e.isHidden&&(e.totalCount>0||e.unreadCount>0);default:(0,a.exhaustivenessCheck)(e)}}function m(e,t,n,o){for(const o of n)g(e,t,o),_(e,o);e[t].hasMore=o,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0})}function _(e,t){switch(t.kind){case"ChatConvo":case"GroupConvo":case"UserConvo":case"ContactConvo":case"MessageRequestUserConvo":case"MessageRequestChatConvo":case"BusinessNotify":return e.all.peerIds.delete(t.peerId),e.unread.peerIds.delete(t.peerId),e.archive.peerIds.delete(t.peerId),e.messageRequest.peerIds.delete(t.peerId),e.businessNotify.peerIds.delete(t.peerId),i.isBusinessNotify(t)?void(b(e.businessNotify,t)&&e.businessNotify.peerIds.add(t.peerId)):i.isMR(t)?void(i.isPendingMR(t)&&b(e.messageRequest,t)&&e.messageRequest.peerIds.add(t.peerId)):t.isArchived?void(b(e.archive,t)&&e.archive.peerIds.add(t.peerId)):(b(e.all,t)&&e.all.peerIds.add(t.peerId),i.isUnread(t)&&b(e.unread,t)&&e.unread.peerIds.add(t.peerId),void("ChatConvo"===t.kind&&b(e.chats,t)&&e.chats.peerIds.add(t.peerId)));default:return(0,a.exhaustivenessCheck)(t)}}function h(e,{unread:t,unreadUnmuted:n,headerNotMutedUnread:o,archive:i,archiveTotal:r,archiveMentions:a,messageRequests:s,businessNotify:d,businessNotifyTotal:c}){void 0!==t&&(e.all.unreadCount=t,e.unread.unreadCount=t),void 0!==n&&(e.all.unreadUnmutedCount=n,e.unread.unreadUnmutedCount=n),void 0!==o&&(e.unread.headerNotMutedUnread=o),void 0!==i&&(e.archive.unreadCount=i),void 0!==a&&(e.archive.hasMentions=!!a),void 0!==r&&(e.archive.totalCount=r),void 0!==s&&(e.messageRequest.totalCount=s),void 0!==d&&(e.businessNotify.unreadCount=d),void 0!==c&&(e.businessNotify.totalCount=c)}function f(e,t){var n,o,i,a;if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;const s=null==(n=r.lastNode({history:e.history,withDeleted:!1,withPending:!0}))?void 0:n.item,d=null==(o=r.lastNode({history:t.history,withDeleted:!1,withPending:!0}))?void 0:o.item;var c,l,u,p;return"Queued"===(null==(i=s)?void 0:i.kind)||"Queued"===(null==(a=d)?void 0:a.kind)?(null!=(u=null==(c=d)?void 0:c.sentAt)?u:0)-(null!=(p=null==(l=s)?void 0:l.sentAt)?p:0):t.minorSortId-e.minorSortId}function v(e,t){e.businessNotify.isHidden=!t}function g(e,t,n){i.isHidden(n)||(n.majorSortId<e[t].boundary.majorSortId?e[t].boundary={majorSortId:n.majorSortId,minorSortId:n.minorSortId}:n.majorSortId===e[t].boundary.majorSortId&&n.minorSortId<e[t].boundary.minorSortId&&(e[t].boundary.minorSortId=n.minorSortId),"all"===t&&(g(e,"unread",n),g(e,"chats",n)))}function b(e,t){return!i.isHidden(t)&&(t.majorSortId>e.boundary.majorSortId||t.majorSortId===e.boundary.majorSortId&&t.minorSortId>=e.boundary.minorSortId)}},985863:(e,t,n)=>{function o(){return[]}n.d(t,{empty:()=>o})},651285:(e,t,n)=>{function o(e){return!Number.isNaN(e)&&e||(e=0),e}n.d(t,{resolveId:()=>o})},83062:(e,t,n)=>{n.d(t,{canHavePinnedConvos:()=>p,empty:()=>l,filterToTab:()=>_,getId:()=>m,isEqual:()=>u,refresh:()=>d,refreshChannels:()=>c,tabToChannelFilter:()=>f,tabToFilter:()=>h});var o=n(89131),i=n(498928),r=n(452788),a=n(999504),s=n(985863);function d(e,t){a.refresh(e.folders,t),i.refresh(e.filters,t)}function c(e,t){r.refresh(e.channelFilters,t)}function l(){return{filters:i.empty(),folders:a.empty(),recommendedFolders:s.empty(),channelFilters:r.empty()}}function u(e,t){if(e.kind!==t.kind)return!1;switch(e.kind){case"filters":return e.filter===t.filter;case"folders":return e.id===t.id;default:(0,o.exhaustivenessCheck)(e)}}function p(e){return"filters"===e.kind}function m(e){return"filters"===e.kind?`${e.kind}__${e.filter}`:`${e.kind}__${e.id}__${e.filter}`}function _(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return}}function h(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return"all"}}function f(e){switch(e){case"archive":case"unread":return e;default:return"all"}}},434425:(e,t,n)=>{function o(e){return!Number.isNaN(e)&&e||(e=0),e}n.d(t,{resolveId:()=>o})},71568:(e,t,n)=>{function o(e){return Number.isNaN(e)&&(e=0),e}n.d(t,{resolveStickerId:()=>o})},651041:(e,t,n)=>{n.d(t,{dictionaryLatinConvert:()=>d,toLocalCase:()=>l,toTranslit:()=>c});var o=n(434788);const i={u1072:"a",u1073:"b",u1074:"v",u1075:"g",u1076:"d",u1077:"e",u1105:"yo",u1078:"zh",u1079:"z",u1080:"i",u1081:"y",u1082:"k",u1083:"l",u1084:"m",u1085:"n",u1086:"o",u1087:"p",u1088:"r",u1089:"s",u1090:"t",u1091:"u",u1092:"f",u1093:"kh",u1094:"ts",u1095:"ch",u1096:"sh",u1097:"shch",u1098:"'",u1099:"y",u1100:"'",u1101:"e",u1102:"yu",u1103:"ya"},r=(0,o._)({},i,{u1093:"h",u1097:"sh",u1098:"",u1100:"",u1105:"e"}),a={u102:"а",u44:"б",u100:"в",u117:"г",u108:"д",u116:"е",u92:"ё",u59:"ж",u112:"з",u98:"и",u113:"й",u114:"к",u107:"л",u118:"м",u121:"н",u106:"о",u103:"п",u104:"р",u99:"с",u110:"т",u101:"у",u97:"ф",u91:"х",u119:"ц",u120:"ч",u105:"ш",u111:"щ",u93:"ъ",u109:"ь",u115:"ы",u39:"э",u46:"ю",u122:"я",u60:"б",u126:"ё",u58:"ж",u123:"х",u125:"ъ",u34:"э",u62:"ю",u64:'"',u35:"№",u36:";",u37:"%",u94:":",u38:"?",u63:",",u47:"."},s={yo:"ё",YO:"Ё",zh:"ж",ZH:"Ж",kh:"х",KH:"Х",ts:"ц",TS:"Ц",ch:"ч",CH:"Ч",sch:"щ",SCH:"Щ",shch:"щ",SHCH:"Щ",sh:"ш",SH:"Ш",eh:"э",EH:"Э",yu:"ю",YU:"Ю",ya:"я",YA:"Я","'":"ь",a:"а",A:"А",b:"б",B:"Б",v:"В",g:"г",G:"Г",d:"д",D:"Д",e:"е",E:"Е",z:"з",Z:"З",i:"и",I:"И",j:"й",J:"Й",k:"к",K:"К",l:"л",L:"Л",m:"м",M:"М",n:"н",N:"Н",o:"о",O:"О",p:"п",P:"Р",r:"р",R:"Р",s:"с",S:"С",t:"т",T:"Т",u:"у",U:"У",f:"ф",F:"Ф",h:"х",H:"Х",c:"ц",C:"Ц",y:"ы",Y:"Ы"};function d({value:e}){return function({dictionary:e,value:t}){return Object.entries(e).reduce(((e,[t,n])=>e.replace(new RegExp(t,"g"),n)),t)}({value:e,dictionary:s})}function c(e,t){e=e.toLowerCase().trim();const n=[i,r];return t&&n.push(a),n.reduce(((t,n)=>{const o=u(e,n);return o===e||t.includes(o)||t.push(o),t}),[])}function l(e){return u(e=e.toLowerCase().trim(),a)}function u(e,t){let n="";for(const o of e){const e=t["u"+o.codePointAt(0)];n+=void 0!==e?e:o}return n}},821551:(e,t,n)=>{n.d(t,{add:()=>s,byWords:()=>p,create:()=>a,peerWords:()=>u,search:()=>d});var o=n(651041),i=n(89131),r=n(709420);function a(){return{items:new Set,branches:{}}}function s(e,t,n){if(Array.isArray(t))t.forEach((t=>s(e,t,n)));else{const{id:o,strings:i}=n(t);(0,r.getWordsVariants)(i).forEach((t=>{let n=e;n.items.add(o),Array.from(t.trim().toLowerCase()).forEach((e=>{let t=n.branches[e];t||(t=n.branches[e]=a()),t.items.add(o),n=t}))}))}return e}function d(e,t){const n=c(e,p(t)),i=c(e,p(o.toLocalCase(t))),r=c(e,o.toTranslit(t));return new Set([...n,...i,...r])}function c(e,t){let n=null;for(const o of t){const t=l(e,o);if(n)for(const e of n)t.has(e)||n.delete(e);else n=new Set([...t])}return n||new Set}function l(e,t){let n=e;const o=t.trim().toLowerCase();for(const e of o){const t=n.branches[e];if(!t)return new Set;n=t}return n.items}function u(e){const t=[];switch(e.kind){case"Chat":t.push(...p(e.title));break;case"Group":e.screenName&&t.push(e.screenName),t.push(...p(e.name));break;case"User":e.screenName&&t.push(e.screenName),t.push(...p(e.firstName)),t.push(...p(e.lastName));break;case"Contact":t.push(...p(e.name));break;default:(0,i.exhaustivenessCheck)(e)}return t}function p(e){return e.trim().toLowerCase().split(/\s+/g)}},709420:(e,t,n)=>{n.d(t,{getWordsVariants:()=>i});var o=n(651041);function i(e){const t=[];for(const n of e){const e=n.replace(/ё/g,"е").replace(/Ё/g,"Е");e!==n&&t.push(e),o.toTranslit(n,!0).forEach((e=>{e!==n&&t.push(e)})),t.push(n)}return t}},694788:(e,t,n)=>{n.d(t,{UNKNOWN_SHAPE_ID:()=>_,apiAttachWallOwnerId:()=>H,emptyPreview:()=>m,fromApiAttach:()=>h,fromApiAudio:()=>x,fromApiConvoAttach:()=>f,fromApiDoc:()=>k,fromApiPhoto:()=>I,fromApiPoll:()=>O,fromApiPollBackgroundGradient:()=>W,fromApiVideo:()=>w,fromApiVoice:()=>P,fromApiWallAttach:()=>v,fromApiWallReplyAttach:()=>g});var o=n(434788),i=n(820224),r=n(204841),a=n(197934),s=n(96190),d=n(777634),c=n(504698),l=n(89131),u=n(986727);const p=200,m="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjYGBg+A8AAQQBAHAgZQsAAAAASUVORK5CYII=",_=-1;function h({apiAttaches:e,messageAccessKey:t,attachPositionOffset:n}){if(0===e.length)return{};const i={},r=e=>{i.unknown=[...i.unknown||[],{data:e,kind:"Unknown"}]};let d=n;for(const n of e)switch(void 0!==d&&d++,n.type){case"photo":{if(!n.photo){r(n);break}const e=I({apiPhoto:n.photo,messageAccessKey:t,position:d});if(!e){r(n);break}i.photos=[...i.photos||[],e];break}case"audio":{if(!n.audio){r(n);break}const e=x(n.audio);i.audios=[...i.audios||[],e];break}case"video":if(!n.video){r(n);break}const e=w({apiVideo:n.video,messageAccessKey:t,position:d});if(!e){r(n);break}i.videos=[...i.videos||[],e];break;case"doc":{if(!n.doc){r(n);break}const e=k(n.doc);if(!e){r(n);break}i.docs=[...i.docs||[],e];break}case"link":{if(!n.link){r(n);break}const e=b(n.link);if(!e){r(n);break}const t=e=>e.image&&(0,o._)({},e,{image:e.image,kind:"InviteLink"});if(a.isChatInviteLink(e.url)&&e.image){i.inviteLink=t(e);break}i.link=e;break}case"market":if(!n.market){r(n);break}i.market={kind:"Market",id:(M=n.market).id,ownerId:M.owner_id,isService:!!M.is_price_list_service,title:M.title,price:M.price.text,priceOld:M.price.old_amount_text,photo:M.thumb_photo};break;case"market_album":if(!n.market_market_album){r(n);break}i.marketAlbum={kind:"MarketAlbum"};break;case"gift":if(!n.gift){r(n);break}const T=S(n.gift);if(!T){r(n);break}i.gift=T;break;case"event":if(!n.event){r(n);break}const D=(A=n.event,{kind:"Event",id:s.resolveRealId("Group",A.id),text:A.text,time:A.time&&1e3*A.time,address:A.address,isFavorite:A.is_favorite});i.event=D;break;case"ugc_sticker":{if(!n.ugc_sticker){r(n);break}const e=(0,u.fromApiUgcSticker)(n.ugc_sticker);if(!e){r(n);break}i.ugcSticker=e;break}case"sticker":{if(!n.sticker){r(n);break}const e=(0,u.fromApiSticker)(n.sticker);if(!e){r(n);break}i.sticker=e;break}case"wall":{if(!n.wall||!n.wall.from_id||!n.wall.id){r(n);break}n.wall.geo&&(n.wall.attachments=[...n.wall.attachments||[],{type:"geo",geo:n.wall.geo}]);const e=H(n.wall);if(!e){r(n);break}let t="all";1===n.wall.friends_only&&(t="friends"),1===n.wall.best_friends_only&&(t="best_friends"),i.wall={kind:"Wall",authorId:s.resolveId(n.wall.from_id),ownerId:s.resolveId(e),id:n.wall.id,date:1e3*(n.wall.date||0),chunks:c.fromServerText(n.wall.text||""),attaches:v(n.wall),isAds:"post_ads"===n.wall.post_type,isDeleted:n.wall.is_deleted||!1,isVisibleFor:t};break}case"wall_reply":{if(!(n.wall_reply&&n.wall_reply.from_id&&n.wall_reply.id&&n.wall_reply.post_id)){r(n);break}const e=H(n.wall_reply);if(!e){r(n);break}i.wallReply={kind:"WallReply",id:n.wall_reply.id,postId:n.wall_reply.post_id,authorId:s.resolveId(n.wall_reply.from_id),ownerId:s.resolveId(e),parentsStack:n.wall_reply.parents_stack,date:1e3*(n.wall_reply.date||0),chunks:c.fromServerText(n.wall_reply.text||""),attaches:g(n.wall_reply.attachments||[])};break}case"article":if(!n.article){r(n);break}i.article=C(n.article);break;case"poll":if(!n.poll){r(n);break}i.poll=O(n.poll);break;case"graffiti":if(!n.graffiti){r(n);break}i.graffiti={kind:"Graffiti",imageUrl:n.graffiti.url,width:n.graffiti.width,height:n.graffiti.height};break;case"audio_message":if(!n.audio_message){r(n);break}i.voice=P(n.audio_message);break;case"audio_playlist":{if(!n.audio_playlist){r(n);break}const e=(_=n.audio_playlist,h=void 0,f=void 0,y=void 0,{kind:"AudioPlaylist",id:_.id,ownerId:_.owner_id,type:F[_.type],title:_.title,count:_.count,accessKey:_.access_key,plays:_.plays,year:_.year,photo:_.photo,thumbs:_.thumbs,mainArtists:null==(h=_.main_artists)?void 0:h.map((e=>R(e))),featuredArtists:null==(f=_.featured_artists)?void 0:f.map((e=>R(e))),audios:null==(y=_.audios)?void 0:y.map((e=>x(e)))});i.audioPlaylists=[...i.audioPlaylists||[],e];break}case"artist":{if(!n.artist){r(n);break}const e=n.audios;i.artist=R(n.artist,e);break}case"podcast":if(!n.podcast){r(n);break}i.podcast=U(n.podcast);break;case"money_transfer":if(!n.money_transfer){r(n);break}i.moneyTransfer=E(n.money_transfer);break;case"money_request":if(!n.money_request){r(n);break}i.moneyRequest=N(n.money_request);break;case"story":if(!n.story){r(n);break}i.story={kind:"Story",id:(m=n.story).id,ownerId:m.owner_id,date:void 0!==m.date?1e3*m.date:void 0,restricted:!!m.is_restricted,expired:!!m.is_expired,expiresAt:void 0!==m.expires_at?1e3*m.expires_at:void 0,available:!!m.can_see,narrativesCount:m.narratives_count,photo:m.photo&&I({apiPhoto:m.photo}),video:m.video&&w({apiVideo:m.video})};break;case"geo":if(!n.geo||!n.geo.coordinates){r(n);break}i.geo={kind:"Geo",coordinates:n.geo.coordinates,place:n.geo.place};break;case"call":{if(!n.call){r(n);break}const e=q(n.call);if(!e){r(n);break}i.finishedCall=e;break}case"group_call_in_progress":if(!n.group_call_in_progress){r(n);break}i.activeCall=(l=n.group_call_in_progress,p=void 0,{kind:"ActiveCall",initiatorId:l.initiator_id,joinLink:l.join_link,participants:{list:null==(p=l.participants.list)?void 0:p.map(s.resolveId),count:l.participants.count||0,coverList:B(l)}});break;case"mini_app":if(!n.mini_app){r(n);break}const L=j(n.mini_app);if(!L){r(n);break}i.miniApps=[...i.miniApps||[],L];break;case"app_action":if(!n.app_action){r(n);break}const W=K(n.app_action);if(!W){r(n);break}i.miniAppWidgets=[...i.miniAppWidgets||[],W];break;case"donut_link":if(!n.donut_link){r(n);break}const V=G(n.donut_link);if(!V){r(n);break}i.donutLink=V;break;case"video_message":if(!n.video_message){r(n);break}i.videoMessage=$(n.video_message);break;case"widget":if(!n.widget){r(n);break}i.widget=J(n.widget);break;case"narrative":if(!n.narrative){r(n);break}const z=Y(n.narrative);if(!z){r(n);break}i.narratives=[...i.narratives||[],z];break;case"curator":case"group":case"link_curator":case"video_playlist":case"vkpay":r(n);break;default:n.type;r(n);break}var l,p,m,_,h,f,y,A,M;return i}function f(e){const t={};for(const n of e)switch(n.attachment.type){case"photo":{if(!n.attachment.photo)break;const e=I({apiPhoto:n.attachment.photo,messageAccessKey:n.attachment.photo.access_key,position:n.position});if(!e)break;const o={attach:e,cmid:d.resolveCmid(n.cmid),authorId:s.resolveId(n.from_id),date:n.date};t.photos=(t.photos||[]).concat(o);break}case"audio":{if(!n.attachment.audio)break;const e={attach:x(n.attachment.audio),cmid:d.resolveCmid(n.cmid),authorId:s.resolveId(n.from_id),date:n.date};t.audios=(t.audios||[]).concat(e);break}case"video":{if(!n.attachment.video)break;const e=w({apiVideo:n.attachment.video,messageAccessKey:n.attachment.video.access_key,position:n.position});if(!e)break;const o={attach:e,cmid:d.resolveCmid(n.cmid),authorId:s.resolveId(n.from_id),date:n.date};t.videos=(t.videos||[]).concat(o);break}case"doc":{if(!n.attachment.doc)break;const e=k(n.attachment.doc);if(!e)break;const o={attach:e,cmid:d.resolveCmid(n.cmid),authorId:s.resolveId(n.from_id),date:n.date};t.docs=(t.docs||[]).concat(o);break}case"link":{if(!n.attachment.link)break;const e=b(n.attachment.link);if(!e)break;const o={attach:e,cmid:d.resolveCmid(n.cmid),authorId:s.resolveId(n.from_id),date:n.date};t.links=(t.links||[]).concat(o);break}case"mini_app":{if(!n.attachment.mini_app)break;const e=j(n.attachment.mini_app);if(!e)break;const o={attach:e,cmid:d.resolveCmid(n.cmid),authorId:s.resolveId(n.from_id),date:n.date};t.links=(t.links||[]).concat(o);break}case"app_action":{if(!n.attachment.app_action)break;const e=K(n.attachment.app_action);if(!e)break;const o={attach:e,cmid:d.resolveCmid(n.cmid),authorId:s.resolveId(n.from_id),date:n.date};t.miniAppWidgets=(t.miniAppWidgets||[]).concat(o);break}case"audio_message":case"graffiti":case"market":case"share":case"clip":case"wall":break;default:n.attachment.type}return t}function v(e){var t;const{geo:n,attachments:i,copy_history:r,access_key:a}=e,d=[];var c;n&&(null==(c=i)||c.push({type:"geo",geo:n}));for(const e of i||[])switch(e.type){case"photo":case"audio":case"video":case"doc":case"link":case"mini_app":case"sticker":case"market":case"article":case"poll":case"audio_playlist":case"artist":case"podcast":case"narrative":case"event":case"market_album":case"donut_link":case"graffiti":d.push({type:e.type,[e.type]:e[e.type]});break;case"geo":{var l,u,p;if(!e.geo)break;const t=null==(l=e.geo.coordinates)?void 0:l.split(" ").map((e=>parseFloat(e)));d.push({type:"geo",geo:(0,o._)({},e.geo,{place:{title:null==(u=e.geo.place)?void 0:u.title,address:null==(p=e.geo.place)?void 0:p.address},coordinates:t&&t[0]&&t[1]?{latitude:t[0],longitude:t[1]}:void 0})});break}case"textlive":case"textpost":case"textpost_publish":case"posted_photo":case"note":case"app":case"page":case"album":case"situational_theme":case"group":case"curator":case"photos_list":case"pretty_cards":case"video_playlist":case"clip":case"room":case"online_booking":break;default:e.type}const m=h({apiAttaches:d,messageAccessKey:a});if(null==(t=r)?void 0:t[0]){const e=H(r[0]);m.wallHistory={kind:"WallHistory",id:r[0].id||0,authorId:s.resolveId(r[0].from_id),ownerId:s.resolveId(e),date:1e3*(r[0].date||0),text:r[0].text||""}}return m}function g(e){const t=[];for(const n of e)switch(n.type){case"photo":case"audio":case"video":case"doc":case"link":case"sticker":case"market":case"graffiti":case"market_album":case"geo":t.push({type:n.type,[n.type]:n[n.type]});break;case"note":case"page":case"audio_playlist":case"album":case"app":case"article":case"curator":case"donut_link":case"event":case"group":case"mini_app":case"narrative":case"photos_list":case"poll":case"posted_photo":case"pretty_cards":case"video_playlist":case"situational_theme":case"textlive":case"textpost":case"textpost_publish":case"podcast":case"artist":case"room":case"clip":case"online_booking":break;default:n.type}return h({apiAttaches:t})}function b(e){var t,n,o,i;if(!e.title)return;let r=e.url;const a=/^https:\/\/m\.vk\.com(.+)/;if(a.test(e.url)){const t=e.url.match(a);r=t&&t[1]?t[1]:r}let s;var d,c,l,u;((null==(t=e.seller_product)?void 0:t.owner_name)||(null==(n=e.rating)?void 0:n.stars)||(null==(o=e.rating)?void 0:o.reviews_count)||(null==(i=e.seller_product)?void 0:i.favicon_link))&&(s={ownerName:null==(d=e.seller_product)?void 0:d.owner_name,rating:null==(c=e.rating)?void 0:c.stars,reviews:null==(l=e.rating)?void 0:l.reviews_count,favicon:null==(u=e.seller_product)?void 0:u.favicon_link});return{kind:"Link",url:r,meta:s,title:e.title,subtitle:e.caption||r,image:e.photo?T(e.photo.sizes||[]):void 0}}function k(e){var t,n,i;if(!e.url)return;const r=!!(null==(i=e.preview)||null==(n=i.photo)||null==(t=n.sizes)?void 0:t.length)&&T(e.preview.photo.sizes.map((e=>(0,o._)({},e,{url:e.src}))));return(0,o._)({kind:"Doc",id:e.id,ownerId:e.owner_id,title:e.title,size:e.size,ext:e.ext,type:y(e.ext,e.type),date:e.date,url:e.url,isUnsafe:Boolean(e.is_unsafe)},r&&{image:r})}const y=(e,t)=>{switch(e){case"csv":case"dat":case"ecsv":case"ods":case"tsv":case"xar":case"xl":case"xlr":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":case"xlw":return"spreadsheet";case"ppt":case"ppta":case"pptm":case"pptx":return"default";default:switch(t){case 1:return"text";case 2:return"archive";case 3:return"gif";case 4:return"image";case 5:return"audio";case 6:return"video";case 7:return"ebook";default:return"default"}}};function I({apiPhoto:e,messageAccessKey:t,position:n}){var i;if(e.sizes)return(0,o._)({kind:"Photo",accessKey:e.access_key,albumId:e.album_id,id:e.id,ownerId:e.owner_id,hasTags:e.has_tags,thumbhashUrl:e.thumb_hash&&(0,r.thumbHashToDataURL)(Uint8Array.from(atob(e.thumb_hash),(e=>e.charCodeAt(0)))),sizes:T(e.sizes),originalImage:null==(i=e.orig_photo)?void 0:i.url,messageAccessKey:t,uploadDate:1e3*e.date,vkcomWebViewToken:e.web_view_token},n&&{position:n})}function w({apiVideo:e,messageAccessKey:t,position:n}){var i,r,a,s,d,c,l,u,p,_,h;if(!e.id||!e.owner_id)return;const f=D(e.image||[{url:m,height:1,width:1}]);return f?(0,o._)({kind:"Video",accessKey:e.access_key,id:e.id,ownerId:e.owner_id,duration:e.duration,width:e.width,height:e.height,image:f,title:e.title,views:e.views||0,restriction:e.restriction&&{title:(null==(i=e.restriction)?void 0:i.title)||"",alwaysShown:!!(null==(r=e.restriction)?void 0:r.always_shown),button:null==(a=e.restriction)?void 0:a.button,canPlay:!!(null==(s=e.restriction)?void 0:s.can_play),canPreview:!!(null==(d=e.restriction)?void 0:d.can_preview),cardIcon:null==(c=e.restriction)?void 0:c.card_icon,disclaimerType:null==(l=e.restriction)?void 0:l.disclaimer_type,isBlur:!!(null==(u=e.restriction)?void 0:u.blur),listIcon:null==(p=e.restriction)?void 0:p.list_icon,text:null==(_=e.restriction)?void 0:_.text},files:"files"in e?e.files:void 0,type:e.type,messageAccessKey:t,player:e.player,platform:e.platform,canDownload:e.can_download,uploadDate:e.date&&1e3*e.date,addingDate:e.adding_date&&1e3*e.adding_date,isFromMessage:Boolean(e.is_from_message)||!1,mainArtists:null==(h=e.main_artists)?void 0:h.map((e=>R(e)))},n&&{position:n}):void 0}function C(e){let t,n;switch(e.state){case"available":case"banned":case"deleted":case"paid":case"protected":t=e.state;break;case void 0:t="unknown";break;default:e.state;t="unknown"}return e.photo?n=T(e.photo.sizes||[]):e.owner_photo&&(n=T([{type:"o",width:0,height:0,url:e.owner_photo}])),{kind:"Article",state:t,url:e.url||"",title:e.title||"",author:e.owner_name||"",meta:e.subtitle||"",image:n}}const A={thumb:[48,96,256,512],photo:[34,68,135,270,300,600,1200],unknown:[]};function S(e){const t=function(e,t){if(!e)return;const[n,...o]=A[t].reduce(((n,o)=>{const i=e[`${t}_${o}`];return i?(n.push({url:i,width:o,height:o}),n):n}),[]);return n?[n,...o]:void 0}(e,"thumb");if(t)return{kind:"Gift",id:e.id,isStickerStyle:!!e.is_stickers_style,image:t}}function x(e){var t,n;return{kind:"Audio",id:e.id,ownerId:e.owner_id,artist:e.artist,title:e.title,subtitle:e.subtitle,url:e.url,duration:e.duration,albumId:e.album_id,trackCode:e.track_code,contentRestricted:e.content_restricted,albumPartNumber:e.album_part_number,thumb:null==(t=e.album)?void 0:t.thumb,isExplicit:null==(n=e)?void 0:n.is_explicit,accessKey:e.access_key}}function P(e){return{kind:"Voice",duration:e.duration,id:e.id,linkMp3:e.link_mp3,linkOgg:e.link_ogg,ownerId:e.owner_id,waveform:e.waveform,isTranscriptPossible:e.duration/60/60<1,transcription:M(e)}}function M(e){switch(e.transcript_state){case"done":var t;return{state:"done",text:null==(t=e.transcript)?void 0:t.trim(),updatedAt:e.transcript_update_time?1e3*e.transcript_update_time:void 0};case"error":case"in_progress":return{state:e.transcript_state};case void 0:return;default:e.transcript_state;return}}const F={0:"playlist",1:"album",2:"album",3:"album",4:"album",5:"playlist"};function R(e,t){var n;return{kind:"Artist",id:e.id,blockId:e.popular_audios_block_id,name:e.name,photo:e.photo,domain:e.domain,audios:null==(n=t)?void 0:n.map((e=>x(e)))}}function U(e){var t,n;const o=null==(n=e.podcast_info)||null==(t=n.cover)?void 0:t.sizes,i=o&&T(o).values(),r=i&&(0,l.toNonEmpty)([...i])||void 0;return{kind:"Podcast",id:e.id,ownerId:e.owner_id,title:e.title,image:r}}function E(e){if(e.amount)return{kind:"MoneyTransfer",id:e.id,toId:s.resolveId(e.to_id),fromId:s.resolveId(e.from_id),amount:+e.amount.amount/100,currencySign:e.amount.currency.title}}function N(e){var t,n;const o=e=>e&&!isNaN(Number(e))?+e/100:void 0;return{kind:"MoneyRequest",id:e.id,toId:s.resolveId(e.to_id),fromId:s.resolveId(e.from_id),isUserOwner:Boolean(e.user_is_owner),amount:+e.amount.amount/100,totalAmount:o(null==(t=e.total_amount)?void 0:t.amount),transferredAmount:o(null==(n=e.transferred_amount)?void 0:n.amount),userCount:e.users_count,currencyCode:e.amount.currency.name,currencySign:e.amount.currency.title}}function T(e){return e.sort(((e,t)=>e.width-t.width)).reduce(((e,t)=>{var{type:n,src:r,url:a}=t,s=(0,i._)(t,["type","src","url"]);return void 0===a||"s"!==n&&"m"!==n&&"x"!==n&&"o"!==n&&"p"!==n&&"q"!==n&&"r"!==n&&"y"!==n&&"z"!==n&&"w"!==n||(s.width&&s.height?e.set(n,(0,o._)({url:a},s)):e.set(n,(0,o._)({},s,{url:a,width:p,height:p}))),e}),new Map)}function D(e){const t=e.sort(((e,t)=>e.width-t.width)).map((e=>({width:e.width,height:e.height,url:e.url}))),[n,...o]=t;if(n)return[n,...o]}function B(e){var t;const n=null==(t=e.participants)?void 0:t.list;if(!n)return[];return n.reduce(((e,t)=>{const n=s.resolveAnyId(t);return(s.isUserPeerId(n)||s.isGroupPeerId(n))&&e.push(n),e}),[]).slice(0,3)}function q(e){var t,n,o;const i=function(e){switch(e.state){case"reached":return"reached";case"canceled_by_initiator":return"canceledByInitiator";case"canceled_by_receiver":return"canceledByReceiver";default:return}}(e);if(i)return{kind:"FinishedCall",initiatorId:e.initiator_id,duration:e.duration,state:i,participants:{list:null==(n=e.participants)||null==(t=n.list)?void 0:t.map(s.resolveId),count:(null==(o=e.participants)?void 0:o.count)||0,coverList:B(e)}}}function j(e){if(!e.app||!e.app.share_url||!e.app.webview_url)return;const t=(0,l.toNonEmpty)(e.images.map((({url:e,height:t,width:n})=>({width:n,height:t,url:e}))));if(!t)return;t.sort(((e,t)=>e.width-t.width));const n=e.app.share_url.replace(/https:\/\/[a-z0-9_\-.]+\//,""),o=n.split("#").slice(1).join("#");return{kind:"MiniApp",title:e.title,appLink:n,images:t,id:a.resolveMiniAppId(e.app.id),url:e.app.webview_url,shareUrl:e.app.share_url,hash:o}}function L(e){const t=[];return e.forEach((e=>{const n=function(e){var t;const{object_id:n,items:o}=e;if(n&&o&&0!==o.length)return{id:n,icon50:(null==(t=o[0])?void 0:t.url)||""}}(e);n&&t.push(n)})),t}function K(e){var t,n;const{type:o,title:i,icons:r,description:s,footer:c,button_text:l,application:u}=e;if(!u||!u.webview_url||0===r.length)return;const p={id:a.resolveMiniAppId(u.id),title:u.title,webviewUrl:u.webview_url,icon75:(null==(t=r[0])?void 0:t.url)||"",icon150:null==(n=r[1])?void 0:n.url},m=c?{description:c.description,items:c.items?L(c.items):[]}:null,_=new URL(p.webviewUrl);var h;const f=null!=(h=_.hash)?h:"";let v=`app${p.id}?`,g=0;return["vk_chat_id","vk_message_id","vk_ref"].forEach((e=>{const t=_.searchParams.get(e);"vk_message_id"===e&&(g=Number(t||0)),t&&(v=`${v}${e}=${t}`)})),{kind:"MiniAppWidget",type:o,title:i,description:s,buttonText:l,app:p,appLink:v,hash:f,cmid:d.resolveCmid(g),footer:m||void 0}}function G(e){var t,n;const o=s.resolveId(e.owner_id);if(s.isGroupPeerId(o)&&(null==(t=e.action)?void 0:t.url)&&(null==(n=e.button.action)?void 0:n.url)&&e.button.title)return{kind:"DonutLink",ownerId:o,button:{action:{target:"internal",type:"open_url",url:e.button.action.url},title:e.button.title},donorsCount:e.donors.count,text:e.text,action:{target:"internal",type:"open_url",url:e.action.url}}}function O(e){var t,n;return{kind:"Poll",id:e.id,ownerId:s.resolveId(e.owner_id),authorId:void 0!==e.author_id?s.resolveId(e.author_id):s.resolveId(e.owner_id),title:e.question,anonymous:!!e.anonymous,endDate:1e3*e.end_date,answers:e.answers.map((t=>{var n;return{id:t.id,text:t.text,votes:t.votes,rate:t.rate,selected:!!(null==(n=e.answer_ids)?void 0:n.includes(t.id))}})),voted:!!(null==(t=e.answer_ids)?void 0:t.length),canVote:e.can_vote,canChangeVote:!e.disable_unvote,canEdit:e.can_edit,multiple:e.multiple,votes:e.votes,friends:(null==(n=e.friends)?void 0:n.map((e=>s.resolveId(e.id))))||[],backgroundGradient:W(e.background),backgroundPhoto:V(e.photo)}}function W(e){if(!e||"gradient"!==e.type)return;const{points:t,angle:n}=e;return void 0!==t&&void 0!==n?{id:e.id||0,points:t.map((e=>"#"+e.color)),angle:n}:void 0}function V(e){if(!e||!e.color||!e.images)return;const t=(0,l.toNonEmpty)(e.images.map((e=>({url:e.url,width:e.width,height:e.height}))));return t?{kind:"PollBackgroundPhoto",image:t,color:"#"+e.color}:void 0}function H({owner_id:e,source_id:t,to_id:n}){var o;return null!=(o=null!=e?e:t)?o:n}function $(e){if(!e.id||!e.owner_id)return;const t=D(e.image||[{url:"",height:0,width:0}]);return t?{kind:"VideoMessage",id:e.id,ownerId:e.owner_id,duration:e.duration,shapeId:e.shape_id||_,image:t,files:e.files,transcription:z(e)}:void 0}function z(e){switch(e.transcript_state){case"done":var t;return{state:"done",text:null==(t=e.transcript)?void 0:t.trim(),updatedAt:e.transcript_update_time?1e3*e.transcript_update_time:void 0};case"error":case"in_progress":case"uninitialized":return{state:e.transcript_state};case void 0:return;default:(0,l.exhaustivenessCheck)(e.transcript_state)}}function J(e){if(e.item.widget_id)return{kind:"Widget",id:e.item.widget_id,data:e}}function Y(e){var t;const n=(null==(t=e.cover)?void 0:t.cropped_sizes)&&(0,l.toNonEmpty)(e.cover.cropped_sizes.map((e=>({url:e.url,width:e.width,height:e.height}))))||void 0;return{kind:"Narrative",id:e.id,title:e.title,ownerId:s.resolveId(e.owner_id),isDeleted:e.is_delete,isFavorite:e.is_favorite,canSee:e.can_see,storyIds:e.story_ids,image:n}}},233300:(e,t,n)=>{n.d(t,{convertButtons:()=>p,fromApiKeyboard:()=>c,fromApiMessageEvent:()=>_,fromEngineKeyboard:()=>l});var o=n(434788),i=n(659397),r=n(197934),a=n(859352),s=n(96190),d=n(95154);function c(e,t){const n=u(e.buttons,e.inline),o=s.resolveId(e.author_id||t);return e.inline?{kind:"InlineKeyboard",authorId:o,buttons:n}:{kind:"InputKeyboard",authorId:o,buttons:n,oneTime:e.one_time}}function l(e,t){if(e.inline)return e.buttons?{kind:"InlineKeyboard",buttons:u(e.buttons,e.inline),authorId:s.resolveId(e.author_id||t)}:void 0;var n;if(!(null==(n=e.buttons)?void 0:n.length))return{kind:"InputKeyboardDeleteEvent"};return{kind:"InputKeyboardUpsertEvent",keyboard:{kind:"InputKeyboard",buttons:u(e.buttons,e.inline),authorId:s.resolveId(e.author_id||t),oneTime:e.one_time}}}function u(e,t){return e.map((e=>p(e,t)))}function p(e,t){return e.map((e=>function(e,t){const n="positive"===(a=e.color)?{mode:"primary",appearance:"positive"}:"negative"===a?{mode:"primary",appearance:"negative"}:"primary"===a?{mode:"primary"}:{mode:"secondary"};var a;switch(e.action.type){case"text":case"callback":return(0,o._)({type:e.action.type,label:(0,i.unescape)(e.action.label||""),payload:e.action.payload||""},n);case"open_link":case"open_modal_view":return(0,o._)({type:e.action.type,link:e.action.link,label:(0,i.unescape)(e.action.label||""),payload:e.action.payload||""},n);case"location":return(0,o._)({type:e.action.type,payload:e.action.payload||""},n);case"vkpay":return{type:e.action.type,payload:e.action.payload||"",appId:(0,r.resolveMiniAppId)(d.VK_PAY_APP_ID),hash:e.action.hash||""};case"open_app":return(0,o._)({type:e.action.type,payload:e.action.payload||"",label:(0,i.unescape)(e.action.label||""),hash:e.action.hash||"",appId:(0,r.resolveMiniAppId)(e.action.app_id),ownerId:e.action.owner_id?s.resolveId(e.action.owner_id):void 0},n);case"open_photo":return;default:return void e.action}}(e))).filter(m)}function m(e){return void 0!==e}const _=(e,t,n)=>{const{event_id:o,action:i,owner_id:d}=n,c=a.resolveEventId(o),l=s.resolveId(d);if(i)switch(i.type){case"show_snackbar":return{type:i.type,id:c,ownerId:l,text:i.text,title:s.name(e),photo:t.photo50,peerId:e.id};case"open_link":case"open_modal_view":return{type:i.type,id:c,ownerId:l,link:i.link,title:s.name(e),peerId:e.id};case"open_app":return{type:i.type,id:c,ownerId:l,appId:(0,r.resolveMiniAppId)(i.app_id),hash:i.hash,peerId:e.id};default:}return{type:"null",id:c,ownerId:l,peerId:e.id}}},634263:(e,t,n)=>{n.d(t,{fromApiTemplate:()=>s});var o=n(434788),i=n(820224),r=n(233300),a=n(694788);function s(e,t){var n;return{kind:"carousel",elements:(null==(n=e.elements)?void 0:n.map((e=>function(e,t){var{buttons:n,photo:s,action:d}=e,c=(0,i._)(e,["buttons","photo","action"]);const l=s?(0,a.fromApiPhoto)({apiPhoto:s,messageAccessKey:t}):null,u=(0,o._)({buttons:n?(0,r.convertButtons)(n,!0):[]},l&&{photo:l},c),p=(0,o._)({},u,{kind:"simple"});if(!d)return p;switch(d.type){case"open_photo":return s&&l?(0,o._)({},u,{kind:"photo",photo:l}):p;case"open_link":case"open_modal_view":return(0,o._)({},u,{kind:"link",link:d.link});default:return p}}(e,t))))||[]}}},739361:(e,t,n)=>{n.d(t,{fromApiChannel:()=>s});var o=n(839963),i=n(86144),r=n(504698),a=n(54965);const s=(e,t)=>{var n,s,d,c,l,u,p,m,_,h,f,v,g,b,k,y,I,w,C,A,S,x,P,M,F,R,U;const{channel:E,last_message:N}=e,T=N&&(0,a.fromApiPost)(N).post,D={confirmed:[],pending:[]};T&&(D.confirmed=T.cmid>1?[{kind:"GapNode",fromCmid:i.resolveCmid(1),toCmid:i.resolveCmid(T.cmid-1)},{kind:"Node",item:T}]:[{kind:"Node",item:T}]);const B=!E.user_data.notification_settings.is_enabled||(E.user_data.notification_settings.disable_duration||0)>0,q=i.resolveCmid((null==(s=E.user_data)||null==(n=s.read_state)?void 0:n.read_up_to_cmid)||0),j=(null==(c=t.menu)||null==(d=c.items)?void 0:d.length)?null==(u=t.menu)||null==(l=u.items)?void 0:l.map((e=>({id:e.id,title:e.title,url:e.url,cover:e.cover,counter:e.counter}))):void 0;return{kind:"Channel",id:o.resolveId(E.channel_id),unreadCount:(null==(p=E.user_data.read_state)?void 0:p.unread_count)||0,isArchived:!!(null==(m=E.user_data)?void 0:m.is_archived),isMuted:B,notificationsDisabledUntil:E.user_data.notification_settings.disable_duration||0,inReadCmid:q,majorSortId:E.sort_id.major_id,minorSortId:E.sort_id.minor_id,membersCount:t.members_count||0,isMember:E.user_data.is_member,adminLevel:t.admin_level||0,photos:{photo50:t.photo_50,photo100:t.photo_100},name:t.name||"",description:r.fromServerText(t.description||""),activity:t.activity||"",isVerified:!!t.verified,screenName:t.screen_name,history:D,rights:{canSendDonut:!!t.can_post_donut,canPost:!!t.can_post},pending:{},isRepostsDisabled:Boolean(t.reposts_disabled),actionButton:{isEnabled:Boolean(null==(_=t.action_button)?void 0:_.is_enabled),title:null==(h=t.action_button)?void 0:h.title,type:null==(f=t.action_button)?void 0:f.action_type,target:{appId:null==(g=t.action_button)||null==(v=g.target)?void 0:v.app_id,email:null==(k=t.action_button)||null==(b=k.target)?void 0:b.email,googleStoreURL:null==(I=t.action_button)||null==(y=I.target)?void 0:y.google_store_url,isInternal:null==(C=t.action_button)||null==(w=C.target)?void 0:w.is_internal,itunesURL:null==(S=t.action_button)||null==(A=S.target)?void 0:A.itunes_url,phone:null==(P=t.action_button)||null==(x=P.target)?void 0:x.phone,url:null==(F=t.action_button)||null==(M=F.target)?void 0:M.url,userId:null==(U=t.action_button)||null==(R=U.target)?void 0:R.user_id}},menu:j,isClosed:Boolean(t.is_closed)}}},330852:(e,t,n)=>{n.d(t,{fromApiIncognitoMember:()=>a});var o=n(434788),i=n(96190),r=n(202881);function a(e){const t=r.resolveIncognitoMemberId(e.id),n=i.resolveId(e.invited_by),a=i.resolveId(e.member_id);return(0,o._)({id:t,name:e.name||"",inviteDate:1e3*e.join_date,inviterId:n},(i.isUserPeerId(a)||i.isContactPeerId(a))&&{memberId:a})}},508047:(e,t,n)=>{n.d(t,{fromApiConvoBanner:()=>i});var o=n(504698);function i(e){var t,n;return{icon:null!=(t=e.icon)?t:"",name:e.name,title:null!=(n=e.title)?n:"",chunks:o.fromServerText(e.text),canHide:e.can_hide||!0,buttons:(e.buttons||[]).map((e=>{var t,n,o,i;return{callbackData:null!=(o=null==(t=e)?void 0:t.callback_data)?o:"",mode:e.layout,appearance:r(e.style),link:null!=(i=null==(n=e)?void 0:n.link)?i:"",text:e.text,hideOnAction:!!e.hide_on_action,type:e.type}}))}}function r(e){return"destructive"===e?"negative":"regular"===e?"accent":e}},954811:(e,t,n)=>{n.d(t,{fromApiConvo:()=>m,fromLongpollPushSettings:()=>_});var o=n(434788),i=n(96190),r=n(185327),a=n(999504),s=n(777634),d=n(481186),c=n(398255),l=n(233300),u=n(508047);const p={18:"peer_deleted",900:"peer_blacklisted_by_me",901:"peer_blacklisted",902:"peer_blacklisted",915:"disabled_by_community",916:"disabled_by_peer",917:"kicked",918:"no_access",922:"no_access",925:"no_access",932:"no_access",945:"chat_unsupported",946:"chat_unsupported",983:"restricted_to_write_in_chat",203:"disabled_by_peer",1012:"forbid_writing_for_all"};function m(e,t){var n,p,m,_;const g=t&&(0,d.fromApiMessage)(t).message,b={confirmed:[],pending:[]};g?b.confirmed=g.cmid>1?[{kind:"GapNode",fromCmid:s.resolveCmid(1),toCmid:s.resolveCmid(g.cmid-1)},{kind:"Node",item:g}]:[{kind:"Node",item:g}]:void 0!==e.last_conversation_message_id&&e.last_conversation_message_id>0&&(b.confirmed=[{kind:"GapNode",fromCmid:1,toCmid:e.last_conversation_message_id}]);const k=e.current_keyboard&&(0,l.fromApiKeyboard)(e.current_keyboard);if("InlineKeyboard"===(null==(n=k)?void 0:n.kind))throw new Error("Не может прийти инлайн клавиатура для сообщения");const y={majorSortId:(null==(p=e.sort_id)?void 0:p.major_id)||0,minorSortId:(null==(m=e.sort_id)?void 0:m.minor_id)||0,unreadCount:e.unread_count||0,isMarkedUnread:!!e.is_marked_unread,isArchived:!!e.is_archived,inReadBy:s.resolveCmid(e.in_read_cmid),outReadBy:s.resolveCmid(e.out_read_cmid),folderIds:new Set((null==(_=e.folder_ids)?void 0:_.map(a.resolveId))||[]),isNew:!!e.is_new,canWrite:f(e),currentKeyboard:k,push:h(e.push_settings),history:b,unreadExpireables:new Set((e.expire_cmids||[]).map(s.resolveCmid)),unreadReactions:new Map((e.unread_reactions||[]).map((e=>[s.resolveCmid(e),void 0]))),convoBanner:e.conversation_bar&&(0,u.fromApiConvoBanner)(e.conversation_bar)},I=i.resolveId(e.peer.id);switch(e.peer.type){case"user":if(!i.isUserPeerId(I))return null;if(void 0!==e.message_request_data){const{status:t}=e.message_request_data;return"pending"===t||"cancelled"===t||"rejected"===t?{convo:(0,o._)({},y,{kind:"MessageRequestUserConvo",peerId:I,MRStatus:t})}:null}return{convo:(0,o._)({},y,{kind:"UserConvo",peerId:I})};case"chat":{var w,C,A,S,x,P;if(!i.isChatPeerId(I))return null;if(!e.chat_settings)throw new Error("TODO chat convo has to has chat settings");const t=e.chat_settings.owner_id&&0!==e.chat_settings.owner_id?i.resolveId(e.chat_settings.owner_id):void 0,n=t&&(i.isUserPeerId(t)||i.isGroupPeerId(t))?t:void 0,a={count:e.chat_settings.members_count||0,members:new Map,adminIds:new Set,memberIds:new Set,invitedIds:new Set,incognitoMembers:new Map},l=(0,o._)({},y,{peerId:I,ownerId:n,unreadMentions:new Set((e.mention_cmids||[]).map(s.resolveCmid)),state:e.chat_settings.state,isCasper:!!e.chat_settings.is_disappearing,isCommunityChat:!!t&&i.isGroupPeerId(t),isDonut:!!e.chat_settings.is_donut,isGroupChannel:!!e.chat_settings.is_group_channel,activeCall:v(e.call_in_progress),pinnedMessage:e.chat_settings.pinned_message?(0,d.fromApiPinnedMessage)(e.chat_settings.pinned_message):void 0,acl:(R=e.chat_settings.acl,{canChangeInfo:R.can_change_info,canChangeInviteLink:R.can_change_invite_link,canChangePin:R.can_change_pin,canInvite:R.can_invite,canPromoteUsers:R.can_promote_users,canSeeInviteLink:R.can_see_invite_link,canModerate:R.can_moderate,canCopyChat:R.can_copy_chat,canCall:R.can_call,canUseMassMentions:R.can_use_mass_mentions,canChangeServiceType:Boolean(R.can_change_service_type),canChangeStyle:Boolean(R.can_change_style),canSendReactions:!0}),permissions:e.chat_settings.permissions?(F=e.chat_settings.permissions,(0,o._)({},r.DEFAULT_CHAT_PERMISSIONS,F)):void 0,description:e.chat_settings.description,isService:Boolean(e.chat_settings.is_service),members:a,adminIds:new Set([...[t]||0,...e.chat_settings.admin_ids||[]].map(i.resolveId)),shouldShortPollReactions:Boolean(e.chat_settings.short_poll_reactions),isIncognito:e.chat_settings.is_incognito,forbidedWritingForAll:e.chat_settings.writing_disabled?(M=e.chat_settings.writing_disabled,{value:M.value,until:M.until_ts}):void 0}),u={kind:"Chat",id:I,title:(null==(w=e.chat_settings)?void 0:w.title)||"",photo50:null==(C=e.chat_settings.photo)?void 0:C.photo_50,photo100:null==(A=e.chat_settings.photo)?void 0:A.photo_100,photo200:null==(S=e.chat_settings.photo)?void 0:S.photo_200,hasDefaultPhoto:(null==(x=e.chat_settings.photo)?void 0:x.is_default_photo)||(null==(P=e.chat_settings.photo)?void 0:P.is_default_call_photo),canCall:e.chat_settings.acl.can_call};if(void 0!==e.message_request_data){const{status:t,inviter_id:n}=e.message_request_data;return"pending"!==t&&"rejected"!==t&&"cancelled"!==t||void 0===n?null:{convo:(0,o._)({},l,{kind:"MessageRequestChatConvo",inviterPeerId:i.resolveId(n),MRStatus:t}),peer:u}}return e.peer_flags&&0!=(e.peer_flags&c.PEER_FLAG_BUSINESS_NOTIFY)?{convo:(0,o._)({},l,{kind:"BusinessNotify"}),peer:u}:{convo:(0,o._)({},l,{kind:"ChatConvo"}),peer:u}}case"group":return i.isGroupPeerId(I)?{convo:(0,o._)({},y,{peerId:I,kind:"GroupConvo"})}:null;case"email":return null;case"contact":return i.isContactPeerId(I)?{convo:(0,o._)({},y,{peerId:I,kind:"ContactConvo"})}:null;default:e.peer.type;return null}var M,F,R}function _(e){const t=Number(e[1].disabled_until);switch(t){case 0:return{mode:"everything",disabledUntil:0};case-1:return{mode:"every-mention",disabledUntil:1/0};default:return{mode:"every-mention",disabledUntil:1e3*t}}}function h(e){let t={mode:"everything",disabledUntil:0};return e?(e.disabled_forever?t={mode:"every-mention",disabledUntil:1/0}:e.disabled_until&&(t={mode:"every-mention",disabledUntil:1e3*e.disabled_until}),"everything"!==t.mode&&(e.disabled_mass_mentions&&(t=(0,o._)({},t,{mode:"direct-mention"})),e.disabled_mentions&&(t=(0,o._)({},t,{mode:"nothing"}))),t):t}function f(e){var t,n,o,i;return"chat"===e.peer.type&&"rejected"===(null==(t=e.message_request_data)?void 0:t.status)?{allowed:!1,reason:"mr_rejected"}:(null==(n=e.can_write)?void 0:n.allowed)?{allowed:!0}:{allowed:!1,reason:(null==(o=e.can_write)?void 0:o.reason)&&p[e.can_write.reason]||"unknown",until:(null==(i=e.can_write)?void 0:i.until)?1e3*e.can_write.until:void 0}}function v(e){if(!e)return;return{participants:{list:(e.participants.list||[]).reduce(((e,t)=>{const n=i.resolveAnyId(t);return(i.isUserPeerId(n)||i.isGroupPeerId(n))&&e.push(n),e}),[]),count:e.participants.count||0},joinLink:e.join_link,canFinishCall:Boolean(e.can_finish_call),hasLink:Boolean(e.has_link),id:e.call_id}}},171949:(e,t,n)=>{n.d(t,{fromApiFolder:()=>r,fromApiFolderRecommended:()=>s,fromEngineFolder:()=>a});var o=n(434788),i=n(999504);function r(e){return(0,o._)({},d(),i.convertFlags(e.flags),{id:i.resolveId(e.id),name:e.name})}function a(e){const[,t,n,r]=e;return(0,o._)({},d(),i.convertFlags(r),{id:i.resolveId(t),name:n})}function s(e){return{name:e.name,type:e.type,description:e.description,isHidden:!!e.is_hidden}}function d(){return{unreadCount:0,unreadUnmutedCount:0,all:{peerIds:new Set,boundaryMinorId:1/0,hasMore:!0},unread:{peerIds:new Set,boundaryMinorId:1/0,hasMore:!0}}}},481186:(e,t,n)=>{n.d(t,{fromApiMessage:()=>h,fromApiPinnedMessage:()=>y,fromEngineMessage:()=>f});var o=n(659397),i=n(877740),r=n(694788),a=n(777634),s=n(96190),d=n(197934),c=n(504698),l=n(651285),u=n(89131),p=n(233300),m=n(634263),_=n(858289);function h(e){var t;if(e.action)return{message:{kind:"Service",action:b({apiAction:e.action,apiAttaches:e.attachments,messageAccessKey:`mail${e.peer_id}-${e.conversation_message_id}`}),peerId:s.resolveId(e.peer_id),cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),sentAt:1e3*e.date,isOut:1===e.out,isSilent:e.is_silent,deleteTTL:void 0!==e.ttl?1e3*e.ttl:void 0},mentions:{hasDirect:!1,hasMass:!1}};const n=s.resolveId(e.peer_id);if(e.is_expired)return{message:{kind:"Expired",cmid:a.resolveCmid(e.conversation_message_id),peerId:s.resolveId(e.peer_id),authorId:s.resolveId(e.from_id),isOut:1===e.out,isSilent:e.is_silent,sentAt:1e3*e.date},mentions:{hasDirect:!1,hasMass:!1}};const o=e.keyboard&&(0,p.fromApiKeyboard)(e.keyboard);if("InputKeyboard"===(null==(t=o)?void 0:t.kind))throw new Error("Кажется из апи пришла не инлайн клавиатура для сообщения");const i=a.resolveCmid(e.conversation_message_id),u=(0,r.fromApiAttach)({apiAttaches:k(e),messageAccessKey:`mail${e.peer_id}-${e.conversation_message_id}`,attachPositionOffset:0}),h=d.count(u);return{message:{kind:"Normal",randomId:a.resolveRandomId(e.random_id),cmid:i,peerId:n,authorId:s.resolveId(e.from_id),chunks:c.fromServerText(e.text),isOut:1===e.out,isSilent:e.is_silent,isImportant:!!e.important,isUnavailable:!e.id||!!e.deleted,isPlayed:!!e.was_played,sentAt:1e3*e.date,updatedAt:e.update_time&&1e3*e.update_time,attaches:u,keyboard:o,replyMessage:e.reply_message?v(e.reply_message,n,i,h):void 0,forwardedMessages:g(e.fwd_messages,n,i,h),expireTTL:e.expire_ttl?1e3*e.expire_ttl:void 0,deleteTTL:void 0!==e.ttl?1e3*e.ttl:void 0,pinnedAt:e.pinned_at&&1e3*e.pinned_at,template:e.template?(0,m.fromApiTemplate)(e.template,`mail${e.peer_id}-${e.conversation_message_id}`):void 0,reactions:e.reactions?(0,_.fromApiMessageReactions)(e.reactions):new Map,reactionId:e.reaction_id?l.resolveId(e.reaction_id):void 0},mentions:{hasDirect:e.is_mentioned_user,hasMass:!1}}}function f(e,t,n){var d;let l,m,_,h,f,v,g,k,y,I;switch(e[0]){case 10004:[,I,m,,_,h,f,v,g,k,l]=e;break;case 10005:case 10018:[,I,m,_,h,f,v,g,k,l,y]=e;break;default:(0,u.exhaustivenessCheck)(e)}const w=s.resolveId(_),{isOut:C,isImportant:A,noPush:S,isPlayed:x}=a.convertFlags(m),P=C||s.isFavorites(w,t),M="1"===v.is_silent;let F;if(F=void 0!==v.from?s.resolveId(Number(v.from)):P?t:w,v.source_act)return{message:{kind:"Service",cmid:a.resolveCmid(I),peerId:w,authorId:F,action:b({messageAccessKey:`mail${w}-${a.resolveCmid(I)}`,apiAction:{conversation_message_id:v.source_chat_local_id?Number(v.source_chat_local_id):void 0,message:v.source_message,type:v.source_act,member_id:v.source_mid?Number(v.source_mid):void 0,text:v.source_text,old_text:v.source_old_text,style:v.source_style}}),deleteTTL:void 0!==v.ttl?1e3*Number(v.ttl):void 0,sentAt:1e3*h,isOut:P,isSilent:M},mentions:{hasDirect:!1,hasMass:!1},noPush:S};if("1"===v.is_expired)return{message:{kind:"Expired",cmid:a.resolveCmid(I),isOut:P,isSilent:M,peerId:w,authorId:F,sentAt:1e3*h},mentions:{hasDirect:!1,hasMass:!1},noPush:!0};const R={hasDirect:!1,hasMass:!1};for(const e of v.marked_users||[])if(e[0]===i.IEngine.MarkedType.Mention)switch(e[1]){case"all":R.hasMass=R.hasMass||F!==t;break;case"online":R.hasMass=R.hasMass||e[2].includes(t);break;default:R.hasDirect=e[1].includes(t)}let U,E={};if("sticker"!==g.attach1_type&&"audiomsg"!==g.attach1_kind||!g.attachments)void 0!==g.attach1_type&&(E={unknown:[{data:g,kind:"Unknown"}]});else{const e=JSON.parse(g.attachments);Array.isArray(e)&&(E=(0,r.fromApiAttach)({apiAttaches:e,messageAccessKey:`mail${w}-${I}`}))}if(void 0!==g.reply){const e=JSON.parse(g.reply),t=n(a.resolveCmid(e.conversation_message_id));t&&(U=a.toForeign({message:t,rootPeerId:w,rootCmid:a.resolveCmid(I)}))}const N=v.keyboard?(0,p.fromEngineKeyboard)(v.keyboard,F):void 0;let T,D;return"InlineKeyboard"===(null==(d=N)?void 0:d.kind)?T=N:D=N,{message:{kind:"Normal",cmid:a.resolveCmid(I),randomId:a.resolveRandomId(k),peerId:w,authorId:F,chunks:c.fromServerText((0,o.unescape)(f)),isOut:P,isSilent:M,isImportant:A,isPlayed:x,isUnavailable:!1,sentAt:1e3*h,updatedAt:y?1e3*y:void 0,pinnedAt:v.pinned_at?1e3*Number(v.pinned_at):void 0,expireTTL:v.expire_ttl?1e3*Number(v.expire_ttl):void 0,deleteTTL:void 0!==v.ttl?1e3*Number(v.ttl):void 0,attaches:E,replyMessage:U,keyboard:T,reactions:new Map},mentions:R,noPush:S,keyboardEvent:D}}function v(e,t,n,o){let i;if(e.peer_id&&(i=s.resolveId(e.peer_id)),e.is_expired)return{kind:"ForeignExpired",peerId:i,rootPeerId:t,rootCmid:n,isUnavailable:!!e.is_unavailable,cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),sentAt:1e3*e.date};const l=(0,r.fromApiAttach)({apiAttaches:k(e),messageAccessKey:e.peer_id?`mail${e.peer_id}-${e.conversation_message_id}`:void 0,attachPositionOffset:o}),u=o+d.count(l);return{kind:"Foreign",peerId:i,rootPeerId:t,rootCmid:n,isUnavailable:!!e.is_unavailable,cmid:a.resolveCmid(e.conversation_message_id),authorId:s.resolveId(e.from_id),chunks:c.fromServerText(e.text),sentAt:1e3*e.date,updatedAt:e.update_time&&1e3*e.update_time,attaches:l,replyMessage:e.reply_message?v(e.reply_message,t,n,u):void 0,forwardedMessages:g(e.fwd_messages,t,n,u)}}function g(e,t,n,o){if(!e||0===e.length)return;let i,r=o;for(const o of e){const e=v(o,t,n,r);if("ForeignExpired"!==e.kind&&(r+=a.getMessageAttachmentsCount(e)),"ForeignExpired"!==e.kind)i?i.push(e):i=[e];else if(u.isDev)throw new Error("Исчезающих сообщений не может быть в пересланных.")}return i}function b({apiAction:e,apiAttaches:t,messageAccessKey:n}){const o={type:"unknown"};switch(e.type){case"chat_create":return e.text?{type:e.type,title:e.text}:o;case"chat_title_update":return e.text&&e.old_text?{type:e.type,title:e.text,oldTitle:e.old_text}:o;case"chat_photo_remove":case"chat_screenshot":case"chat_group_call_started":case"chat_invite_user_by_link":case"chat_invite_user_by_call_join_link":case"chat_kick_don":case"call_transcription_failed":return{type:e.type};case"chat_pin_message":case"chat_unpin_message":return{type:e.type,cmid:a.resolveCmid(e.conversation_message_id),chunks:e.message?c.fromServerText(e.message):[]};case"chat_photo_update":var i,d;const l=null==(d=null==(i=t)?void 0:i.find((e=>"photo"===e.type)))?void 0:d.photo;let u;return l&&(u=(0,r.fromApiPhoto)({apiPhoto:l,messageAccessKey:n})),{type:e.type,photo:u};case"chat_invite_user":case"chat_kick_user":case"accepted_message_request":{if(!e.member_id)return o;const t=s.resolveId(e.member_id);return s.isUserPeerId(t)||s.isGroupPeerId(t)?{type:e.type,peerId:t}:o}case"chat_invite_user_by_message_request":case"chat_invite_user_by_call":case"chat_kick_user_call_block":{if(!e.member_id)return o;const t=s.resolveId(e.member_id);return s.isUserPeerId(t)?{type:e.type,peerId:t}:o}case"conversation_style_update":case"conversation_style_update_action":let p;switch(e.style){case"disco":case"twilight":case"sunset":case"lagoon":case"marine":case"retrowave":case"candy":case"crimson":case"emerald":case"halloween_orange":case"halloween_violet":case"unicorn":case"midnight":case"easter_egg":case"frost":case"new_year":case"valentine":case"warm_valentine":case"womens_day":case"mable":case"vk17":case"gamer":case void 0:p=e.style;break;default:p="unknown"}return{type:e.type,style:p};case"custom":return e.message?{type:e.type,chunks:c.fromServerText(e.message)}:o;default:e.type;return o}}function k({attachments:e=[],geo:t}){return t?[...e,{type:"geo",geo:t}]:e}function y(e){const t=s.resolveId(e.peer_id),n=a.resolveCmid(e.conversation_message_id);return{kind:"Pinned",cmid:n,peerId:t,authorId:s.resolveId(e.from_id),isUnavailable:!!e.is_unavailable,chunks:c.fromServerText(e.text),sentAt:1e3*e.date,forwardedMessages:e.fwd_messages?g(e.fwd_messages,t,n,0):void 0,replyMessage:e.reply_message?v(e.reply_message,t,n,0):void 0,attaches:(0,r.fromApiAttach)({apiAttaches:e.attachments||[]})}}},858289:(e,t,n)=>{n.d(t,{fromApiMessageReactions:()=>r});var o=n(651285),i=n(96190);function r(e){return e.sort(((e,t)=>t.count-e.count)).reduce(((e,t)=>(e.set(o.resolveId(t.reaction_id),{reactionId:o.resolveId(t.reaction_id),count:t.count,peerIds:new Set(t.user_ids.map(i.resolveId))}),e)),new Map)}},882670:(e,t,n)=>{n.d(t,{convertPlatform:()=>l,fromApiAnonym:()=>c,fromApiContact:()=>d,fromApiGroup:()=>s,fromApiUser:()=>a});var o=n(96190);const i=[6482950,6481715,6146827],r={1:"mobile",2:"mobile",3:"mobile",4:"mobile",5:"mobile",6:"other",7:"other"};function a(e){var t,n,r,a,s,d;const c={0:"unfamiliar",1:"outgoingRequest",2:"incomingRequest",3:"friends"};let l="other";(null==(t=e.online_info)?void 0:t.is_mobile)&&(l="mobile"),i.includes((null==(n=e.online_info)?void 0:n.app_id)||0)&&(l="vkme");const u={isOnline:!!(null==(r=e.online_info)?void 0:r.is_online),at:(null==(a=e.online_info)?void 0:a.status)?null==(s=e.online_info)?void 0:s.status:(null==(d=e.online_info)?void 0:d.last_seen)?1e3*e.online_info.last_seen:"not_show",platform:l},p=o.resolveRealId("User",e.id),m=Boolean(e.blacklisted),[,_]=e.photo_id?e.photo_id.split("_"):[],h=_?parseInt(_):null;return{user:{kind:"User",id:p,firstName:e.first_name,firstNameGen:e.first_name_gen||e.first_name,firstNameAcc:e.first_name_acc||e.first_name,lastName:e.last_name,lastNameGen:e.last_name_gen||e.last_name,lastNameAcc:e.last_name_acc||e.last_name,screenName:e.screen_name,sex:void 0!==e.sex?{0:"unknown",1:"female",2:"male"}[e.sex]:"unknown",photoId:h&&!isNaN(h)?h:void 0,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,isVerified:Boolean(e.verified),isBlacklisted:m,isBlacklistedByMe:Boolean(e.blacklisted_by_me),isProfileClosed:Boolean(e.is_closed)&&!e.can_access_closed,isDeactivated:Boolean(e.deactivated),deactivationReason:e.deactivated,canCall:Boolean(e.can_call),canChangeFriendship:1===e.can_send_friend_request,canInviteToChats:!!e.can_invite_to_chats,canMessage:1===e.can_write_private_message,hasDefaultPhoto:1!==e.has_photo,followersCount:e.followers_count||0,friendship:void 0!==e.friend_status?c[e.friend_status]:c[0],mutualFriends:m?{hint:[],count:0}:void 0,contactName:e.contact_name,occupation:e.occupation,bdate:e.bdate,city:e.city,phone:e.mobile_phone,employeeMark:e.employee_mark,isService:e.is_service_account||e.is_service},lastSeen:u}}function s(e){var t;const n=o.resolveRealId("Group",e.id);if(!e.type)throw new Error(`fromApiGroup содержит некорректный тип ${e.type}`);const i={0:"notMember",1:"member",2:"unsure",3:"declined",4:"outgoingRequest",5:"incomingRequest"}[e.member_status||0];return{kind:"Group",id:n,type:e.type,name:e.name,screenName:e.screen_name,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,activity:e.activity,memberCount:e.members_count||0,membership:i,isDeactivated:Boolean(e.deactivated),isVerified:1===e.verified,isClosed:Boolean(e.is_closed),canMessage:1===e.can_message,canChangeMembership:0!==(null==(t=e.ban_info)?void 0:t.end_date)&&(0===e.is_closed||"member"===i||"incomingRequest"===i),mutualFriends:2===e.is_closed&&"member"!==i?{hint:[],count:0}:void 0,isBlacklistedByMe:1===e.is_messages_blocked,site:e.site}}function d(e){const t=o.resolveRealId("Contact",e.id),n=o.resolveId(e.user_id);return{kind:"Contact",id:t,name:e.name,userId:n,phone:e.phone,canWrite:e.can_write,photo50:e.photo_50,lastSeen:e.last_seen_status}}function c(e){const t=o.resolveAnyId(e.id);if(o.isAnonymPeerId(t))return{id:t,kind:"Anonym",name:e.name,photo50:e.photo_50,photo100:e.photo_100,photo200:e.photo_200,photo400:e.photo_400}}function l(e,t){let n=r[e]||"other";return i.includes(t)&&(n="vkme"),n}},54965:(e,t,n)=>{n.d(t,{fromApiPost:()=>p,fromApiSearchPost:()=>h});var o=n(434788),i=n(86144),r=n(504698),a=n(96190),s=n(839963),d=n(434425),c=n(694788),l=n(249690);const u={id:"reactions",items:[{id:0,title:"Нравится",asset:{animation_url:"https://vk.com/reaction/3-reactions-0?c_uniq_tag=83b2081a8e4adfc36ee536f5f1b4ad470174c89678369a4b9dc5547614a3955e",images:[{url:"https://vk.com/reaction/1-reactions-0-48?c_uniq_tag=e6bee176471af6e4f7ca0f57ac099847d57b8101bf07944e47b42b097a6d8455",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-0-72?c_uniq_tag=d6f55fe94c0add8f817b447cbd804768752eb996c06ef222b39eb3fd35834780",width:72,height:72}],title:{color:{foreground:{light:"FF3347",dark:"FF5C5C"},background:{light:"FFEDED",dark:"3E2526"}}},title_color:{light:"FF3347",dark:"FF5C5C"}}},{id:1,title:"Смешно",asset:{animation_url:"https://vk.com/reaction/3-reactions-1?c_uniq_tag=a47193579880c0f53dd597a15d3bd57d4827820687c73d6128df2720647b42b9",images:[{url:"https://vk.com/reaction/1-reactions-1-48?c_uniq_tag=8f5eb3a1d6a6ec81aceff211782af3c9e9a5d1c837f0bfade6965a6844786f8b",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-1-72?c_uniq_tag=c852fcad6e67059878dcf1905e3e416fd89fbc61222ead100935a6fcc1dab4c9",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:2,title:"Ого!",asset:{animation_url:"https://vk.com/reaction/3-reactions-2?c_uniq_tag=b946fcbe262642bc920331746b6eccd9f175bb17d8ef37e54d232fa35ca2c750",images:[{url:"https://vk.com/reaction/1-reactions-2-48?c_uniq_tag=2a6544dce8827d216db7ea91eafc726cd3a823f5d465ba00216901a6de2801ad",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-2-72?c_uniq_tag=5a0663f3d38dd6fbcf3e4973610d50641420631c9df30b6cf80eee0dd5c5efee",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:3,title:"Восторг",asset:{animation_url:"https://vk.com/reaction/3-reactions-3?c_uniq_tag=c6ed3add99e841dccda5479c8e21779954e61e0fba15f94a2ae16706df492123",images:[{url:"https://vk.com/reaction/1-reactions-3-48?c_uniq_tag=eda1a2c18d733b356babdeed5f52cdcc64dd59f1f69776a133fc34a5627eecee",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-3-72?c_uniq_tag=be09c5080773a9ba78984406588c7371e48073e80b842eb7c9a817f7b435379b",width:72,height:72}],title:{color:{foreground:{light:"FF8000",dark:"FFC233"},background:{light:"FFF2D6",dark:"352E23"}}},title_color:{light:"FF8000",dark:"FFC233"}}},{id:5,title:"Печаль",asset:{animation_url:"https://vk.com/reaction/3-reactions-5?c_uniq_tag=c61122c8c334154cb10ccf0e0687057bf1f0f40c2817198b2e1150df534c22c4",images:[{url:"https://vk.com/reaction/1-reactions-5-48?c_uniq_tag=31bcb230babad96120a62589c52af22811aaba54d4ed73a36cfd499d9d94102f",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-5-72?c_uniq_tag=a840d0eb581c133d97638ff5bf34f4b33f3fb8557b932cfe3516925b88e2f151",width:72,height:72}],title:{color:{foreground:{light:"4986CC",dark:"71AAEB"},background:{light:"EDF3FA",dark:"27303C"}}},title_color:{light:"4986CC",dark:"71AAEB"}}},{id:4,title:"&$#%!",asset:{animation_url:"https://vk.com/reaction/3-reactions-4?c_uniq_tag=063e6b2dd888bb5a9716cf6153f03bf9c0c9707713b857eed8fe1e4e09aea2b3",images:[{url:"https://vk.com/reaction/1-reactions-4-48?c_uniq_tag=c80e3224c299a73384c057ff065c9458dcd533d57a1458875eb98883c3a96783",width:48,height:48},{url:"https://vk.com/reaction/1-reactions-4-72?c_uniq_tag=a0eddba1ec31f96adbb9afa2c6c14bec055b95f8d9f113bdf759fb5a9c9054f0",width:72,height:72}],title:{color:{foreground:{light:"EF5203",dark:"FA5300"},background:{light:"FDEBE8",dark:"3C2421"}}},title_color:{light:"EF5203",dark:"FA5300"}}}]};function p(e){var t,n,p,h,f,v,g,b,k,y,I,w,C,A,S,x,P,M,F,R,U,E,N,T,D,B,q,j,L,K;const G=(0,o._)({},null==(p=e)||null==(n=p.attachments)||null==(t=n[0])?void 0:t.wall,{attachments:_(e),inner_type:"wall_wallpost"}),O=null==(f=G)||null==(h=f.copy_history)?void 0:h[0];let W={};if(O){const e=(0,c.apiAttachWallOwnerId)(O),t="reply"===O.post_type;let n="all";1===O.friends_only&&(n="friends"),1===O.best_friends_only&&(n="best_friends"),W=(0,o._)({},W,t?{wallReply:{kind:"WallReply",id:O.id||0,postId:O.reply_post_id||0,authorId:a.resolveId(O.from_id),ownerId:a.resolveId(e),parentsStack:O.parents_stack,date:1e3*(O.date||0),chunks:r.fromServerText(O.text||""),attaches:(0,c.fromApiWallAttach)(O)}}:{wall:{kind:"Wall",isAds:"post_ads"===O.post_type,id:O.id||0,authorId:a.resolveId(O.from_id),ownerId:a.resolveId(e),date:1e3*(O.date||0),chunks:r.fromServerText(O.text||""),attaches:(0,c.fromApiWallAttach)(O),isDeleted:O.is_deleted||!1,isVisibleFor:n}}),G.copy_history=void 0}(null==(v=G)?void 0:v.attachments)&&(W=(0,o._)({},W,(0,c.fromApiWallAttach)(G)));const V=[],H=[];return u.items.forEach((e=>{const t=(0,l.fromApiReaction)(e);t&&(V.push(t),H.push(t.id))})),{post:{topicId:G.topic_id,kind:"Normal",cmid:i.resolveCmid(e.cmid),chunks:(null==(g=G)?void 0:g.text)?r.fromServerText(G.text):[],views:(null==(k=G)||null==(b=k.views)?void 0:b.count)||0,sentAt:1e3*e.time,updatedAt:e.update_time&&1e3*e.update_time,channelId:s.resolveId(e.author_id),likes:{count:(null==(I=G)||null==(y=I.likes)?void 0:y.count)||0,reactionId:Boolean(null==(C=G)||null==(w=C.likes)?void 0:w.user_likes)?d.resolveId(null==(S=G)||null==(A=S.reactions)?void 0:A.user_reaction):void 0,availableReactionIds:H,peerIds:new Set},reposts:{count:(null==(P=G)||null==(x=P.reposts)?void 0:x.count)||0,isReposted:Boolean(null==(F=G)||null==(M=F.reposts)?void 0:M.user_reposted)},comments:{count:(null==(U=G)||null==(R=U.comments)?void 0:R.count)||0,oneLevelCount:0,canView:Boolean(null==(N=G)||null==(E=N.comments)?void 0:E.can_view),canPost:Boolean(null==(D=G)||null==(T=D.comments)?void 0:T.can_post),history:[],order:"interesting"},attaches:W,donut:{isDonut:null==(B=G.donut)?void 0:B.is_donut,placeholder:(null==(q=G.donut)?void 0:q.placeholder)?{text:null==(j=G.donut.placeholder)?void 0:j.text,button:null==(L=G.donut.placeholder)?void 0:L.button}:void 0,duration:m(null==(K=G.donut)?void 0:K.paid_duration)},signerId:G.signer_id?a.resolveId(G.signer_id):void 0,markedAsAds:Boolean(G.marked_as_ads)},reactions:V}}function m(e){return-1===e||void 0===e?-1:e/60/60/24}function _(e){var t,n,o,i,r;const a=null==(o=e)||null==(n=o.attachments)||null==(t=n[0])?void 0:t.wall,s=null==(i=a)?void 0:i.geo,d=(null==(r=a)?void 0:r.attachments)||[];return s?[...d,{type:"geo",geo:s}]:d}function h(e){var t,n,d,l,u,p,_,h,f,v,g,b,k,y,I,w,C,A,S,x,P,M;if("ads"===e.type||"donut_wall_donate_block"===e.type)return;if(!function(e){return void 0===e.title}(e))return;const F=null==(t=e.copy_history)?void 0:t[0];let R={};if(F){const t=(0,c.apiAttachWallOwnerId)(F),n="reply"===F.post_type;let i="all";1===F.friends_only&&(i="friends"),1===F.best_friends_only&&(i="best_friends"),R=(0,o._)({},R,n?{wallReply:{kind:"WallReply",id:F.id||0,postId:F.reply_post_id||0,authorId:a.resolveId(F.from_id),ownerId:a.resolveId(t),parentsStack:F.parents_stack,date:1e3*(F.date||0),chunks:r.fromServerText(F.text||""),attaches:(0,c.fromApiWallAttach)(F)}}:{wall:{kind:"Wall",isAds:"post_ads"===F.post_type,id:F.id||0,authorId:a.resolveId(F.from_id),ownerId:a.resolveId(t),date:1e3*(F.date||0),chunks:r.fromServerText(F.text||""),attaches:(0,c.fromApiWallAttach)(F),isDeleted:F.is_deleted||!1,isVisibleFor:i}}),e.copy_history=void 0}return(null==(n=e)?void 0:n.attachments)&&(R=(0,o._)({},R,(0,c.fromApiWallAttach)(e))),{kind:"Normal",topicId:e.topic_id,cmid:i.resolveCmid(e.id||0),chunks:(null==(d=e)?void 0:d.text)?r.fromServerText(e.text):[],views:(null==(u=e)||null==(l=u.views)?void 0:l.count)||0,sentAt:1e3*(e.date||0),updatedAt:e.edited&&1e3*e.edited,channelId:s.resolveId(e.owner_id||0),likes:{count:(null==(_=e)||null==(p=_.likes)?void 0:p.count)||0,reactionId:void 0,availableReactionIds:[],peerIds:new Set},reposts:{count:(null==(f=e)||null==(h=f.reposts)?void 0:h.count)||0,isReposted:Boolean(null==(g=e)||null==(v=g.reposts)?void 0:v.user_reposted)},comments:{count:(null==(k=e)||null==(b=k.comments)?void 0:b.count)||0,oneLevelCount:0,canView:Boolean(null==(I=e)||null==(y=I.comments)?void 0:y.can_view),canPost:Boolean(null==(C=e)||null==(w=C.comments)?void 0:w.can_post),history:[],order:"old"},attaches:R,donut:{isDonut:null==(A=e.donut)?void 0:A.is_donut,placeholder:(null==(S=e.donut)?void 0:S.placeholder)?{text:null==(x=e.donut.placeholder)?void 0:x.text,button:null==(P=e.donut.placeholder)?void 0:P.button}:void 0,duration:m(null==(M=e.donut)?void 0:M.paid_duration)},signerId:e.signer_id?a.resolveId(e.signer_id):void 0,markedAsAds:Boolean(e.marked_as_ads)}}},249690:(e,t,n)=>{n.d(t,{fromApiReaction:()=>i});var o=n(434425);function i(e){var t,n,i,r,a,s;if(!e.asset.animation_url||!(null==(t=e.asset.title_color)?void 0:t.dark)||!(null==(n=e.asset.title_color)?void 0:n.light))return;const d=null==(i=e.asset.images.find((e=>48===e.height)))?void 0:i.url,c=null==(r=e.asset.images.find((e=>72===e.height)))?void 0:r.url;return d&&c?{id:o.resolveId(e.id),animation:e.asset.animation_url,title:e.title,image48:d,image72:c,color:{light:null==(a=e.asset.title_color)?void 0:a.light,dark:null==(s=e.asset.title_color)?void 0:s.dark}}:void 0}},986727:(e,t,n)=>{n.d(t,{fromApiSticker:()=>r,fromApiStickersKeywords:()=>a,fromApiUgcSticker:()=>s,fromContextSticker:()=>d});var o=n(434788),i=n(71568);function r(e){return{id:i.resolveStickerId(e.sticker_id),kind:"Sticker",item:e}}function a(e){return e.dictionary.reduce(((e,t)=>{const n=(t.stickers||[]).map((e=>r((0,o._)({},e,{inner_type:"base_sticker_new"})).id));for(const o of t.words)e[o]=n;return e}),{})}const s=e=>({kind:"UgcSticker",id:e.id,item:e}),d=e=>e.isUGC?{id:e.id,kind:"UgcSticker",item:e.rawData}:{id:e.id,kind:"Sticker",item:e.rawData}},877740:(e,t,n)=>{var o;n.d(t,{IEngine:()=>o}),function(e){let t,n,o;!function(e){e[e.Mention=1]="Mention",e[e.ExpiringMessage=2]="ExpiringMessage"}(t=e.MarkedType||(e.MarkedType={})),function(e){e[e.CopyFlagChanged=0]="CopyFlagChanged",e[e.TitleChanged=1]="TitleChanged",e[e.AvatarChanged=2]="AvatarChanged",e[e.AdminGrated=3]="AdminGrated",e[e.FlagsChanged=4]="FlagsChanged",e[e.Pinned=5]="Pinned",e[e.UserJoined=6]="UserJoined",e[e.UserLeft=7]="UserLeft",e[e.UserKicked=8]="UserKicked",e[e.AdminKicked=9]="AdminKicked",e[e.BannerChanged=10]="BannerChanged",e[e.KeyboardChanged=11]="KeyboardChanged",e[e.MessageRequestChanged=12]="MessageRequestChanged",e[e.ContactConverted=13]="ContactConverted",e[e.BusinessNotifyDataChanged=14]="BusinessNotifyDataChanged",e[e.MessageRequestCanceled=15]="MessageRequestCanceled",e[e.MessageRequestRejected=16]="MessageRequestRejected",e[e.MessageRequestAccepted=17]="MessageRequestAccepted",e[e.ContactJoined=18]="ContactJoined",e[e.CallInProgressChanged=19]="CallInProgressChanged",e[e.DonSubscribed=20]="DonSubscribed",e[e.DonUnsubscribed=21]="DonUnsubscribed",e[e.IsNewChange=22]="IsNewChange",e[e.StyleChanged=23]="StyleChanged",e[e.DescriptionChanged=24]="DescriptionChanged",e[e.ShortPollReactionsChanged=25]="ShortPollReactionsChanged",e[e.IncognitoJoined=26]="IncognitoJoined",e[e.ConvertIncognito=27]="ConvertIncognito",e[e.IncognitoLeft=28]="IncognitoLeft"}(n=e.ChatUpdateType||(e.ChatUpdateType={})),function(e){e[e.Deleted=0]="Deleted",e[e.Accepted=1]="Accepted",e[e.Rejected=2]="Rejected",e[e.New=3]="New"}(o=e.MRStatus||(e.MRStatus={})),e.isIncompleteUpdate=function(e){switch(e[0]){case 10004:{const t=12;return e.length<t}case 10005:{const t=11;return e.length<t}case 10018:{const t=11;return e.length<t}default:return!1}}}(o||(o={}))},991792:(e,t,n)=>{n.d(t,{TypingVariants:()=>v,addConvosToFolder:()=>P,getConvosByIds:()=>M,getOwnerGroupId:()=>S,insertChannels:()=>C,insertChatMembers:()=>F,insertContactItems:()=>k,insertContacts:()=>y,insertConvos:()=>g,insertFolders:()=>I,insertIncognitoMembers:()=>A,insertPeers:()=>b,insertRecommendedFolders:()=>w,removeConvosFromFolder:()=>x});var o=n(434788),i=n(83062),r=n(185327),a=n(96190),s=n(821551),d=n(839963),c=n(999504),l=n(202881),u=n(954811),p=n(882670),m=n(171949),_=n(739361),h=n(54965),f=n(330852);const v=["text","voice","photo","video","file","videomessage"];function g(e,t,{dangerouslyMerge:n}={}){const o=[];for(const s of t){var a;const t="conversation"in s?(0,u.fromApiConvo)(s.conversation,s.last_message):(0,u.fromApiConvo)(s);if(!t)continue;const{convo:d,peer:c}=t,l=e.convos.get(d.peerId);if(l&&!n){o.push(l);continue}const p=r.merge(d,l);e.convos.set(d.peerId,p),c&&e.peers.set(c.id,c),i.refresh(e.organisers,p),o.push(d),"ChatConvo"===p.kind&&e.hiddenPinnedMessages.get(p.peerId)!==(null==(a=p.pinnedMessage)?void 0:a.cmid)&&e.hiddenPinnedMessages.delete(p.peerId)}const d=o.filter((e=>!r.isMR(e)&&!r.isBusinessNotify(e)));return s.add(e.convosSearchIndex,d,(t=>{const n=e.peers.get(t.peerId);return{id:t.peerId,strings:n?s.peerWords(n):[]}})),o}function b(e,{apiUsers:t,apiGroups:n,apiContacts:o},{dangerouslyOverwrite:i}={}){const r=[];for(const n of t){var a;const{user:t,lastSeen:o}=(0,p.fromApiUser)(n);e.lastSeens.set(t.id,o);const s=e.peers.get(t.id);"User"!==(null==(a=s)?void 0:a.kind)||i?(e.peers.set(t.id,t),r.push(t)):r.push(s)}const s=[];for(const t of n){const n=(0,p.fromApiGroup)(t),o=e.peers.get(n.id);!o||"Group"!==o.kind||i?(e.peers.set(n.id,n),s.push(n)):s.push(o)}const d=[];for(const t of o){const n=(0,p.fromApiContact)(t),o=e.peers.get(n.id);!o||"Contact"!==o.kind||i?(e.peers.set(n.id,n),d.push(n)):d.push(o)}return{insertedUsers:r,insertedGroups:s,insertedContacts:d}}function k(e,t,n){const o=[];return b(e,{apiUsers:n,apiGroups:[],apiContacts:[]},{dangerouslyOverwrite:!0}),t.forEach((t=>{const n=a.resolveId(t);if(a.isUserPeerId(n)){var i;const t=e.peers.get(n);if("User"!==(null==(i=t)?void 0:i.kind))return;e.contacts.items.set(n,t),o.push(n)}})),o}function y(e,t){const n=[];t.sort(((e,t)=>e.name.localeCompare(t.name)));for(const o of t){const t=(0,p.fromApiContact)(o),i=t.userId?t.userId:t.id;e.contacts.contacts.set(i,t),n.push(t)}return n}function I(e,t){const n=[];for(const o of t){e.organisers.folders.find((e=>e.id===o.id))?n.push(o):(e.organisers.folders.push(o),n.push(o))}return n}function w(e,t){const n=[];for(const o of t){const t=(0,m.fromApiFolderRecommended)(o);e.organisers.recommendedFolders.find((e=>e.type===t.type))?n.push(t):(e.organisers.recommendedFolders.push(t),n.push(t))}return n}function C(e,{apiChannels:t,apiGroups:n,dangerouslyMerge:o}){const i=[];for(const a of t){var r;const t=n.find((e=>-e.id===a.channel.channel_id));if(!t)throw new Error("С бэка не приходит нужная группа для канала");const s=(0,_.fromApiChannel)(a,t);(a.last_message&&(0,h.fromApiPost)(a.last_message).reactions||[]).forEach((t=>{e.reactions.set(t.id,t)}));let c=e.channels.get(s.id);if("ChannelRestricted"===(null==(r=c)?void 0:r.kind)&&(c=void 0),c&&!o){i.push(c);continue}const l=c?d.merge(c,s):s;e.channels.set(l.id,l),i.push(l)}return i}function A(e,t){for(const o of t){var n;const t=(0,f.fromApiIncognitoMember)(o);if(!t)continue;const i=a.resolveId(o.peer_id),r=e.convos.get(i);"ChatConvo"===(null==(n=r)?void 0:n.kind)&&l.addIncognitoMembers(r.members,[t])}}function S(e){return a.isGroupPeerId(e)?a.toRealId(e):0}function x(e,t,n){const o=e.organisers.folders.find((e=>e.id===t));if(!o)return;var i;let a=null!=(i=o.unreadCount)?i:0;var s;let d=null!=(s=o.unreadUnmutedCount)?s:0;for(const o of n)r.isInFolder(o,t)&&(r.removeFolder(o,t),c.refresh(e.organisers.folders,o),o.unreadCount&&(r.isMuted(o)?a--:d--));c.setUnreadCounters(e.organisers.folders,t,a,d)}function P(e,t,n){const o=[],i=e.organisers.folders.find((e=>e.id===t));if(!i)return;var a;let s=null!=(a=i.unreadCount)?a:0;var d;let l=null!=(d=i.unreadUnmutedCount)?d:0;for(const e of n)r.isInFolder(e,t)||(r.addFolder(e,t),o.push(e),e.unreadCount&&(r.isMuted(e)?s++:l++));c.push(e.organisers.folders,t,"all",o,i.all.hasMore),c.push(e.organisers.folders,t,"unread",o.filter((e=>r.isUnread(e))),i.unread.hasMore),c.setUnreadCounters(e.organisers.folders,t,s,l)}function M(e,t){return t.reduce(((t,n)=>{const o=e.convos.get(a.resolveId(n));return o&&t.push(o),t}),[])}function F(e,t){const n=(t.incognito_members||[]).reduce(((e,{id:t,name:n=""})=>e.set(t,{name:n})),new Map);l.setCount(e,t.count);for(const s of t.items){if(s.incognito_id&&0===s.member_id){var i;const t=n.get(s.incognito_id);if(!t)continue;const r=a.resolveId(s.invited_by),d=l.resolveIncognitoMemberId(s.incognito_id),c=(0,o._)({},t,{id:d,inviterId:r},s.join_date&&{inviteDate:1e3*s.join_date});if(0!==s.member_id){const e=a.resolveId(s.member_id);(a.isUserPeerId(e)||a.isContactPeerId(e))&&(c.memberId=e)}null==(i=e.incognitoMembers)||i.set(d,c);continue}const t=a.resolveId(s.member_id);if(!a.isUserPeerId(t)&&!a.isGroupPeerId(t)&&!a.isContactPeerId(t))continue;const d={canKick:Boolean(s.can_kick),isMessageRequest:Boolean(s.is_message_request),isRestrictedToWrite:Boolean(s.is_restricted_to_write),peerId:t};var r;if(s.is_message_request&&s.request_date&&(d.requestDate=1e3*s.request_date),s.join_date&&(d.joinDate=1e3*s.join_date),e.members.set(t,d),e.memberIds.add(t),d.isMessageRequest)null==(r=e.invitedIds)||r.add(t);a.isContactPeerId(t)||s.is_admin&&e.adminIds.add(t)}}},204841:(e,t,n)=>{function o(e){let t=function(e){let{PI:t,min:n,max:o,cos:i,round:r}=Math,a=e[0]|e[1]<<8|e[2]<<16,s=e[3]|e[4]<<8,d=(63&a)/63,c=(a>>6&63)/31.5-1,l=(a>>12&63)/31.5-1,u=(a>>18&31)/31,p=a>>23,m=(s>>3&63)/63,_=(s>>9&63)/63,h=s>>15,f=o(3,h?p?5:7:7&s),v=o(3,h?7&s:p?5:7),g=p?(15&e[5])/15:1,b=(e[5]>>4)/15,k=p?6:5,y=0,I=(t,n,o)=>{let i=[];for(let r=0;r<n;r++)for(let a=r?0:1;a*n<t*(n-r);a++)i.push(((e[k+(y>>1)]>>((1&y++)<<2)&15)/7.5-1)*o);return i},w=I(f,v,u),C=I(3,3,1.25*m),A=I(3,3,1.25*_),S=p&&I(5,5,b),x=function(e){let t=e[3],n=128&e[2],o=128&e[4];return(o?n?5:7:7&t)/(o?7&t:n?5:7)}(e),P=r(x>1?32:32*x),M=r(x>1?32/x:32),F=new Uint8Array(P*M*4),R=[],U=[];for(let e=0,r=0;e<M;e++)for(let a=0;a<P;a++,r+=4){let s=d,u=c,m=l,_=g;for(let e=0,n=o(f,p?5:3);e<n;e++)R[e]=i(t/P*(a+.5)*e);for(let n=0,r=o(v,p?5:3);n<r;n++)U[n]=i(t/M*(e+.5)*n);for(let e=0,t=0;e<v;e++)for(let n=e?0:1,o=2*U[e];n*v<f*(v-e);n++,t++)s+=w[t]*R[n]*o;for(let e=0,t=0;e<3;e++)for(let n=e?0:1,o=2*U[e];n<3-e;n++,t++){let e=R[n]*o;u+=C[t]*e,m+=A[t]*e}if(p)for(let e=0,t=0;e<5;e++)for(let n=e?0:1,o=2*U[e];n<5-e;n++,t++)_+=S[t]*R[n]*o;let h=s-2/3*u,b=(3*s-h+m)/2,k=b-m;F[r]=o(0,255*n(1,b)),F[r+1]=o(0,255*n(1,k)),F[r+2]=o(0,255*n(1,h)),F[r+3]=o(0,255*n(1,_))}return{w:P,h:M,rgba:F}}(e);return function(e,t,n){let o=4*e+1,i=6+t*(5+o),r=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,255&e,0,0,t>>8,255&t,8,6,0,0,0,0,0,0,0,i>>>24,i>>16&255,i>>8&255,255&i,73,68,65,84,120,1],a=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],s=1,d=0;for(let e=0,i=0,a=o-1;e<t;e++,a+=o-1)for(r.push(e+1<t?0:1,255&o,o>>8,255&~o,o>>8^255,0),d=(d+s)%65521;i<a;i++){let e=255&n[i];r.push(e),s=(s+e)%65521,d=(d+s)%65521}r.push(d>>8,255&d,s>>8,255&s,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[e,t]of[[12,29],[37,41+i]]){let n=-1;for(let o=e;o<t;o++)n^=r[o],n=n>>>4^a[15&n],n=n>>>4^a[15&n];n=~n,r[t++]=n>>>24,r[t++]=n>>16&255,r[t++]=n>>8&255,r[t++]=255&n}return"data:image/png;base64,"+btoa(String.fromCharCode(...r))}(t.w,t.h,t.rgba)}n.d(t,{thumbHashToDataURL:()=>o})}}]);try{stManager.done("dist/f1e6fa7b867e2d70cc05786ee498d648.ff9b8f6b017a472f30ff.js")}catch(e){}
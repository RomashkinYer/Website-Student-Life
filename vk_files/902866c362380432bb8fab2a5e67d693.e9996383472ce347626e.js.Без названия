/*! For license information please see 902866c362380432bb8fab2a5e67d693.e9996383472ce347626e.js.LICENSE.txt */
(self.webpackChunkvk=self.webpackChunkvk||[]).push([[43087],{161183:(e,t,s)=>{"use strict";s.d(t,{Icon16Attach:()=>i});var i=(0,s(28178).makeIcon)("Icon16Attach","attach_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="attach_16"><path fill="currentColor" fill-rule="evenodd" d="M7.968 2.038a3.528 3.528 0 0 1 4.998 0 3.545 3.545 0 0 1 0 5.005L8.66 11.359a2.14 2.14 0 0 1-3.03 0 2.148 2.148 0 0 1 0-3.031l2.09-2.106a.75.75 0 1 1 1.065 1.056L6.693 9.386a.648.648 0 0 0 0 .914.639.639 0 0 0 .906 0l4.305-4.317a2.045 2.045 0 0 0 0-2.886 2.028 2.028 0 0 0-2.874 0L4.603 7.536a9.39 9.39 0 0 0-.274.28 3.203 3.203 0 0 0 0 4.3c.174.192.36.38.552.554.594.54 1.421.824 2.252.827.836.003 1.591-.278 2.068-.755.1-.1.204-.198.304-.298l2.214-2.22a.75.75 0 0 1 1.062 1.06l-2.23 2.235c-.134.135-.222.223-.301.296-.818.81-1.984 1.186-3.121 1.182-1.148-.004-2.35-.392-3.258-1.219a9.76 9.76 0 0 1-.653-.655 4.703 4.703 0 0 1 0-6.315c.075-.083.165-.173.306-.315l4.444-4.455Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},689826:(e,t,s)=>{"use strict";s.d(t,{Icon28AdvertisingCircleFillRed:()=>i});var i=(0,s(28178).makeIcon)("Icon28AdvertisingCircleFillRed","advertising_circle_fill_red_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="advertising_circle_fill_red_28"><linearGradient id="advertising_circle_fill_red_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#ff5263" /><stop offset="1" stop-color="#ff3347" /></linearGradient><path fill="url(#advertising_circle_fill_red_28_a)" d="M14 28c7.732 0 14-6.268 14-14S21.732 0 14 0 0 6.268 0 14s6.268 14 14 14" /><g fill="#fff"><path d="M19.7 19c-.169 0-.388-.05-.529-.149L16.732 16.7s-.123-.11-.152-.146a.35.35 0 0 1-.062-.122.52.52 0 0 1-.018-.143v-5.523a.68.68 0 0 1 .019-.205.35.35 0 0 1 .062-.122c.029-.037.152-.149.152-.149l2.438-2.135c.141-.1.371-.152.529-.155a.8.8 0 0 1 .8.8v9.4a.8.8 0 0 1-.8.8M14.7 10.5a.3.3 0 0 1 .3.3v5.4a.3.3 0 0 1-.3.3l-2.2.003c0 .606.326 1.372.583 1.697.391.493.286 1.12-.182 1.53-.47.412-1.344.345-1.734-.148-.59-.743-1.167-1.93-1.167-3.08l-.5-.002a3 3 0 1 1 0-6z" /></g></symbol>',28,28,!1,void 0)},439561:(e,t,s)=>{"use strict";s.d(t,{Icon28MoreHorizontalCircleFillGray:()=>i});var i=(0,s(28178).makeIcon)("Icon28MoreHorizontalCircleFillGray","more_horizontal_circle_fill_gray_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="more_horizontal_circle_fill_gray_28"><linearGradient id="more_horizontal_circle_fill_gray_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#b1b6bd" /><stop offset="1" stop-color="#99a2ad" /></linearGradient><path fill="url(#more_horizontal_circle_fill_gray_28_a)" d="M0 14C0 6.268 6.268 0 14 0s14 6.268 14 14-6.268 14-14 14S0 21.732 0 14" /><path fill="#fff" d="M15 6.667c.18.6.306 1.201 1.305 1.777 1.118.304 1.665.003 2.173-.337.53-.353.688-.25.9-.043l.515.515c.235.236.33.33 0 .943-.298.552-.633 1.066-.335 2.18.577 1.004 1.176 1.178 1.775 1.298.625.125.664.309.667.606v.727c0 .334 0 .467-.667.667-.6.18-1.201.306-1.777 1.305-.303 1.118-.002 1.665.337 2.173.353.53.25.688.043.9l-.515.515c-.236.235-.33.33-.943 0-.552-.298-1.066-.633-2.18-.335-1.004.577-1.178 1.176-1.298 1.775-.125.625-.309.664-.606.667h-.727c-.334 0-.467 0-.667-.667-.18-.6-.306-1.201-1.305-1.777-1.118-.303-1.665-.002-2.173.337-.53.353-.688.25-.9.043l-.515-.515c-.235-.236-.33-.33 0-.943.298-.552.634-1.066.335-2.18C7.865 15.294 7.266 15.12 6.667 15c-.625-.125-.664-.309-.667-.606v-.727c0-.334 0-.467.667-.667.6-.18 1.201-.306 1.777-1.305.304-1.118.003-1.665-.337-2.173-.353-.53-.25-.688-.043-.9l.515-.515c.236-.235.33-.33.943 0 .552.298 1.066.634 2.18.335C12.706 7.865 12.88 7.266 13 6.667c.125-.625.309-.664.606-.667h.727c.334 0 .467 0 .667.667zM14 10.2a3.8 3.8 0 1 0 0 7.6 3.8 3.8 0 0 0 0-7.6" /></symbol>',28,28,!1,void 0)},685446:(e,t,s)=>{"use strict";s.d(t,{Icon28UgcChatStickerCircleFillBlue:()=>i});var i=(0,s(28178).makeIcon)("Icon28UgcChatStickerCircleFillBlue","ugc_chat_sticker_circle_fill_blue_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="ugc_chat_sticker_circle_fill_blue_28"><rect width="28" height="28" fill="url(#ugc_chat_sticker_circle_fill_blue_28_a)" rx="14" /><path fill="#fff" d="M13.47 8v2.286c0 2.612 2.105 4.728 4.702 4.728h1.986c-.832 1.797-3.026 3.515-5.655 3.515a6.746 6.746 0 0 1-1.703-.216 12.07 12.07 0 0 1-1.896 1.34 7.9 7.9 0 0 1-.401.21l-.159.078a.604.604 0 0 1-.802-.275.584.584 0 0 1-.017-.477 8.66 8.66 0 0 0 .225-.61c.176-.55.311-1.117.404-1.699-1.026-.95-1.654-2.236-1.654-3.65 0-2.63 2.132-4.813 4.97-5.229Zm1.4.318v1.968a3.31 3.31 0 0 0 3.302 3.32H20.5l-5.63-5.288Z" /><defs><linearGradient id="ugc_chat_sticker_circle_fill_blue_28_a" x1="-14" x2="14" y1="14" y2="42" gradientUnits="userSpaceOnUse"><stop stop-color="#70B2FF" /><stop offset="1" stop-color="#5C9CE6" /></linearGradient></defs></symbol>',28,28,!1,void 0)},294184:(e,t)=>{var s;!function(){"use strict";var i={}.hasOwnProperty;function n(){for(var e=[],t=0;t<arguments.length;t++){var s=arguments[t];if(s){var a=typeof s;if("string"===a||"number"===a)e.push(s);else if(Array.isArray(s)){if(s.length){var o=n.apply(null,s);o&&e.push(o)}}else if("object"===a)if(s.toString===Object.prototype.toString)for(var r in s)i.call(s,r)&&s[r]&&e.push(r);else e.push(s.toString())}}return e.join(" ")}e.exports?(n.default=n,e.exports=n):void 0===(s=function(){return n}.apply(t,[]))||(e.exports=s)}()},651656:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});const i={ugcBadge:"ChatSettingsUGCStickers-module__ugcBadge--Fxi7u",ugcIcon:"ChatSettingsUGCStickers-module__ugcIcon--wa31g",listItem:"ChatSettingsUGCStickers-module__listItem--hWpWE",textWrapper:"ChatSettingsUGCStickers-module__textWrapper--eae7m",secondaryText:"ChatSettingsUGCStickers-module__secondaryText--pu1YU",infoIcon:"ChatSettingsUGCStickers-module__infoIcon--RUa0q",userAside:"ChatSettingsUGCStickers-module__userAside--NvIXj"}},640523:(e,t,s)=>{"use strict";function i(e){return new URLSearchParams(e).toString()}s.d(t,{getUGCAppHash:()=>i})},257306:(e,t,s)=>{"use strict";s.d(t,{AvatarDropdown:()=>h});var i=s(785893),n=s(249600),a=s(77199),o=s(95432),r=s(29271),l=s(273192),c=s(769287);const h=({peerId:e,onPhotoUpload:t,children:s})=>{const h=[{text:(0,i.jsx)(c.AvatarDropdownItem,{icon:(0,i.jsx)(n.Icon20PictureOutline,{}),text:r.getLang("mail_upload_photo")}),onClick:t},{text:(0,i.jsx)(c.AvatarDropdownItem,{icon:(0,i.jsx)(a.Icon20Stars,{}),text:r.getLang("mail_create_photo_from_emoji")}),onClick:()=>{(0,o.showWiki)({w:`app7754294#peer=${e}`})}}];return(0,i.jsx)(l.default,{position:"b",appearance:"fancy",trigger:"hover",marginTop:2,marginLeft:5,align:"left",horizontalPosition:"left",data:h,children:s})}},769287:(e,t,s)=>{"use strict";s.d(t,{AvatarDropdownItem:()=>n});var i=s(785893);const n=({icon:e,text:t})=>(0,i.jsxs)("div",{className:"AvatarDropdownItem",children:[(0,i.jsx)("div",{className:"AvatarDropdownItem__icon",children:e}),t]})},600998:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsInfo:()=>C});var i=s(785893),n=s(667294),a=s(659397),o=s(401840),r=s(622284),l=s(664988),c=s(29271),h=s(514653),d=s(513698),_=s(736846),g=s(568012),p=s(875610),u=s(257306),m=s(47304);class C extends n.PureComponent{getCasperInfo(){const e=c.getLang("mail_casper_chat_info");return(0,i.jsxs)(i.Fragment,{children:[c.getLang("mail_casper_chat_label"),(0,i.jsx)(o.HintIcon,{"aria-label":e,tooltip:{maxWidth:280,placement:"top",text:e}})]})}render(){const{store:e,photo:t,title:s,description:n,grid:o,meta:p,isDonutChat:m,isDefaultPhotoOwner:C=!1,isCasper:S=!1,peerId:A}=this.props,I=(0,l.unclean)(s),v=(0,g.canChangeTitle)(e),L=(0,a.classNames)("ChatSettingsInfo",{"ChatSettingsInfo--editable":v}),N=e.get().isAvatarBuilderEntryPointEnabled,f=(0,a.classNames)("ChatSettingsInfo__title",{"ChatSettingsInfo__title-service":Boolean(64&this.props.flags)}),x=t?(0,i.jsx)("img",{src:t,width:"80",height:"80",alt:I,className:"ChatSettingsInfo__photoSelf"}):(0,i.jsx)("div",{className:"nim-peer--photo-w",children:(0,i.jsx)("div",{className:"ChatSettingsInfo__photoGrid nim-peer--photo",dangerouslySetInnerHTML:{__html:o}})});return(0,i.jsxs)("div",{className:L,children:[(0,i.jsxs)("header",{className:"ChatSettingsInfo__header",children:[(0,i.jsxs)("div",{className:"ChatSettingsInfo__photo",children:[N&&v?(0,i.jsx)(u.AvatarDropdown,{peerId:A,onPhotoUpload:this.onPhotoUpload,children:(0,i.jsx)("div",{className:"ChatSettingsInfo__avatar nim-peer nim-peer_larger",children:x})}):(0,i.jsx)("div",{className:"ChatSettingsInfo__attach nim-peer nim-peer_larger","data-tip":c.getLang("mail_settings_photo"),onClick:this.onPhotoUpload,children:x}),t&&v&&!C&&(0,i.jsx)(r.TextTooltip,{text:c.getLang("mail_settings_remove_photo"),placement:"top-start",children:(0,i.jsx)("button",{onClick:this.onPhotoRemove,className:"ChatSettingsInfo__photoRemove",children:(0,i.jsx)(d.Icon12Cancel,{})})})]}),(0,i.jsx)("h3",{className:f,children:v?(0,i.jsx)(h.EditableLabel,{value:this.state.title,changed:this.state.titleChanged,useEnter:!0,onSave:this.onSaveTitle,onChange:this.onChangeTitle,onCancel:this.onCancelTitle,validate:this.onValidateTitle}):I}),(0,i.jsxs)("div",{className:"ChatSettingsInfo__meta",children:[(0,i.jsx)("span",{className:"ChatSettingsInfo__metaItem",children:p}),m&&(0,i.jsxs)("span",{className:"ChatSettingsInfo__metaItem",children:[c.getLang("groups_donut_is_dons_chat")," ",(0,i.jsx)(_.Icon12StarCircleFillYellow,{})]}),S&&(0,i.jsx)("span",{className:"ChatSettingsInfo__metaItem",children:this.getCasperInfo()})]})]}),n&&(0,i.jsx)("div",{className:"ChatSettingsInfo__description",children:v?(0,i.jsx)(h.EditableLabel,{value:n,onSave:this.onSaveDescription}):n})]})}constructor(e){super(e),this.onSaveTitle=e=>{const t=this.props.store,s=t.get(),i=e.value.trim().replace("\n","");i&&i!==(0,l.unclean)(this.props.title)&&(this.setState({titleChanged:!1}),t.set(p.updateChatTopic.bind(null,s.peer,i)))},this.onChangeTitle=e=>{if(this.state.title!==e.target.value){const t=e.target.value.replace("\n","");this.setState({title:t,titleChanged:(0,l.unclean)(this.props.title)!==t})}},this.onValidateTitle=e=>!!e.trim().replace("\n",""),this.onCancelTitle=()=>{this.setState({title:(0,l.unclean)(this.props.title),titleChanged:!1})},this.onSaveDescription=()=>{},this.onPhotoUpload=()=>{const e=this.props.store,t=e.get().peer;(0,g.canChangeTitle)(e)&&(window.cur.recieveCropResult=void 0,window.Page.ownerPhoto(t,{gid:e.get().gid}))},this.onPhotoRemove=()=>{const e=this.props.store,t=e.get().peer;(0,g.canChangeTitle)(e)&&e.set(p.removeChatPhoto.bind(null,t)).then((()=>e.set(p.getChatDetails.bind(null,t)))).catch(m.dummyCatch)},this.state={title:(0,l.unclean)(e.title),titleChanged:!1}}}},198710:(e,t,s)=>{"use strict";s.d(t,{default:()=>m});var i=s(785893),n=s(667294),a=s(795558),o=s(29271),r=s(639973),l=s(589897),c=s(86894),h=s(898672),d=s(662230),_=s(840842),g=s(527405),p=s(774001),u=s(659397);class m extends n.Component{componentDidMount(){this.input&&(0,a.elfocus)(this.input,0,this.input.value.length)}render(){const{onReset:e,invitationLinks:t,store:s}=this.props,n=o.getLang("mail_invite_link_reset_explainer").split("{reset_link}"),a=!(0,g.isFvkcomgroup)(s,s.get().peer),{linkWithHistory:m,linkWithoutHistory:C}=t,S=this.props.isInvitationLinkWithHistory?m:C;return(0,i.jsxs)("div",{className:"ChatSettingsInvitationLink",children:[this.props.reseted&&(0,i.jsx)("div",{className:"ChatSettingsInvitationLink__reseted",children:o.getLang("mail_invite_link_reseted_explainer")}),(0,i.jsx)("p",{children:o.getLang("mail_invite_link_explainer")}),(0,i.jsx)("div",{className:"ChatSettingsInvitationLink__switch",children:(0,i.jsx)(p.default,{checked:this.props.isInvitationLinkWithHistory,onChange:this.props.onLinkHistoryOptionToggle,children:o.getLang("mail_im_chat_add_members_show_history")})}),(0,i.jsxs)("div",{className:"ChatSettingsInvitationLink__main",children:[(0,i.jsx)(r.default,{getRef:this.getInputRef,readOnly:!0,className:"ChatSettingsInvitationLink__input",value:S}),(0,i.jsx)(l.default,{onClick:this.onCopy,children:o.getLang("mail_get_invite_link_copy")}),(0,i.jsx)(c.Text,{weight:"3",className:(0,u.classNames)("ChatSettingsInvitationLink__copied",(0,h.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,i.jsx)(d.BlinkText,{shown:this.state.copied,onHide:this.onBlinkTextHide,children:o.getLang("mail_invite_link_copied")})})]}),a&&(0,i.jsxs)("p",{children:[n[0],(0,i.jsx)(_.default,{className:"ChatSettingsInvitationLink__reset",onClick:e,children:o.getLang("mail_invite_reset_link")}),n[1]]})]})}constructor(e){super(e),this.onCopy=()=>{this.input&&((0,a.elfocus)(this.input,0,this.input.value.length),document.execCommand("copy"),this.setState({copied:!0}))},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getInputRef=e=>{e&&(this.input=e)},this.state={copied:!1}}}},9654:(e,t,s)=>{"use strict";s.d(t,{default:()=>w});var i=s(785893),n=s(667294),a=s(664988),o=s(29271),r=s(659397),l=s(221780),c=s(527405),h=s(568012),d=s(425308),_=s(642144),g=s(512334),p=s(205423),u=s(377841),m=s(86894),C=s(898672),S=s(662230),A=s(705758),I=s(518219),v=s(790932),L=s(195192),N=s(407729),f=s(931917);const x=50,b={appendParentCls:"ChatSettingsWrapper"},M={all:"allShowMore",admins:"adminsShowMore",invitedByMRShowMore:"invitedByMRShowMore",invitedByMR:"invitedByMRShowMore"};class w extends n.Component{componentWillReceiveProps(e){const t=e.store.get(),s=this.getMembers(t),i=this.getAdmins(t),n=this.getInvitedByMessageRequests(t),a={removes:[],additions:[]},o=s.reduce(((e,t)=>(e[t]=!0,e)),{});s.forEach((e=>{this.membersMap[e]||a.additions.push(e)})),Object.keys(this.membersMap).forEach((e=>{o[e]||a.removes.push(e)})),(a.removes.length||a.additions.length)&&(this.updateSearchIndex(t,a),this.membersMap=o);let r={all:s,allShowMore:this.state.allShowMore&&s.length>x,admins:i,adminsShowMore:this.state.adminsShowMore&&i.length>x,invitedByMR:n,invitedByMRShowMore:this.state.invitedByMRShowMore&&n.length>x,current:"all",showSearch:this.state.showSearch,searchQuery:this.state.searchQuery};this.state.current&&(r.current=this.state.current),this.setState(r)}getMembers(e){const t=e.peer,s=e.tabs[t],i=-1!==(s.memberIds||[]).indexOf(s.ownerId),n=(s.adminIds||[]).reduce(((e,t)=>(e[t]=!0,e)),{});return(i?[s.ownerId]:[]).concat((s.adminIds||[]).filter((e=>e!==s.ownerId)),(s.memberIds||[]).filter((e=>e!==s.ownerId&&!n[e])))}getAdmins(e){const t=e.peer,s=e.tabs[t];return(-1!==(s.memberIds||[]).indexOf(s.ownerId)?[s.ownerId]:[]).concat((s.adminIds||[]).filter((e=>e!==s.ownerId)))}getInvitedByMessageRequests(e){const t=e.peer;return e.tabs[t].invitedByMessageRequest.sort((function(e,t){return e.date-t.date}))}getCurrentList(){const{store:e}=this.props,{current:t,showSearch:s,searchQuery:i,invitedByMR:n}=this.state;if(s&&i&&this.searchIndex){const e=n.filter((e=>!!e.name.toLowerCase().trim().split(/\s+/).find((e=>e.startsWith(i.toLowerCase())))));return this.searchIndex.search(i).concat(e)}const a=this.state[t],o="invitedByMR"===t?a:(0,c.getChatMembersByIds)(e.get(),a),r=`${t}ShowMore`;return this.state[r]?o.slice(0,x):o}getSearchIndex(e){const{vkIndexer:t}=window,s=(0,c.getChatMembersByIds)(this.props.store.get(),e);return this.membersMap=s.reduce(((e,t)=>(e[t.id]=!0,e)),{}),new Promise((e=>{const i=new t(s,(e=>e.name),(()=>{e(i)}))}))}updateSearchIndex(e,t){const s=(0,c.getChatMembersByIds)(e,t.removes),i=(0,c.getChatMembersByIds)(e,t.additions);(this.searchIndex?Promise.resolve(this.searchIndex):this.searchIndexPromise).then((e=>{s.forEach((t=>{e.remove(t)})),i.forEach((t=>{e.add(t)}))}))}componentDidMount(){this.searchInput.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.searchInput.removeEventListener("keydown",this.onKeydown)}render(){const{store:e,membersCount:t,membersAdded:s,onHideStatus:n}=this.props,{current:a,showSearch:h,searchQuery:A,admins:x,invitedByMR:b}=this.state,w=e.get(),T=w.peer,k=w.tabs[T],j=this.getCurrentList(),H=this.isAddMemberWidgetShown()?["add"].concat(j):j,y=M[a],E=this.state[y],O={"ChatSettingsMembersWidget--search":Boolean(h)},R=k.adminIds.reduce(((e,t)=>(e[t]=!0,e)),{});return(0,i.jsxs)("div",{className:(0,r.classNames)("ChatSettingsMembersWidget",O),children:[(0,i.jsxs)("header",{className:"ChatSettingsMembersWidget__header",children:[(0,i.jsx)("input",{placeholder:o.getLang("mail_members_search"),className:"ChatSettingsMembersWidget__search",onChange:this.onSearchChange,onInput:this.onSearchChange,onPaste:e=>this.onSearchChange(e),value:this.state.searchQuery,ref:this.searchInputRef}),(0,i.jsx)("button",{className:"ChatSettingsMembersWidget__searchIcon",onClick:this.onToggleSearch,children:this.state.showSearch?(0,i.jsx)(v.Icon16Cancel,{}):(0,i.jsx)(L.Icon16SearchOutline,{})}),(0,i.jsxs)(d.default,{className:"ChatSettingsMembersWidget__tabs",onTabClick:this.onTabClick,children:[(0,i.jsxs)("span",{children:[o.getLang("mail_settings_everyone")+" ",(0,i.jsx)("span",{className:"Tabs__desc",children:(0,c.getAliveMembersCount)(k)})]},"all"),x.length>0&&(0,i.jsxs)("span",{children:[o.getLang("mail_settings_admins")+" ",(0,i.jsx)("span",{className:"Tabs__desc",children:x.length})]},"admins"),b.length>0&&(0,i.jsxs)("span",{children:[o.getLang("mail_invited_members")+" ",(0,i.jsx)("span",{className:"Tabs__desc",children:b.length})]},"invitedByMR")]})]}),(0,i.jsx)("div",{className:"ChatSettingsMembersWidget__list",children:(0,i.jsxs)(_.default,{border:!1,children:[H.length>0&&H.map((h=>{if("add"===h)return(0,i.jsx)(g.default,{selectable:!1,border:!1,onClick:this.props.showMembersSettings,aside:(0,i.jsx)(m.Text,{weight:"3",className:(0,r.classNames)("ChatSettingsMembersWidget__blink",(0,C.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,i.jsx)(S.BlinkText,{shown:s,onHide:n,children:(0,l.langNumeric)(t||0,o.getLang("mail_settings_members_added","raw"))})}),children:(0,i.jsxs)("span",{className:"ChatSettingsMembersWidget__add",children:[(0,i.jsx)("span",{className:"ChatSettingsMembersWidget__addIcon",children:(0,i.jsx)(N.Icon24Add,{})}),(0,i.jsx)("span",{children:o.getLang("mail_settings_add_members")})]})},"add");const d=this.getInviter(h.id),_="invitedByMR"===a,A=h.image_status?h.name+`<span class="ChatSettingsMembersWidget__imageStatus">${h.image_status}</span>`:h.name,v=this.getMemberDescriptionText(h,w,_);return(0,i.jsx)(g.default,{selectable:!1,border:!1,aside:(0,i.jsx)(u.default,{adminMap:R,store:e,storeData:w,mid:h.id,onLeave:this.props.onLeave,isMR:_}),children:(0,i.jsx)(p.default,{ignoreDecodeHTML:!0,photo:f.Ranges.isContactId(h.id)?(0,i.jsx)(I.ConversationNoPhoto,{id:T,text:(0,c.getUserInitials)(h.name),size:"xxxs",specificType:7}):h.photo,title:(0,i.jsx)("span",{dangerouslySetInnerHTML:{__html:A}}),description:v?(0,i.jsx)("span",{title:d,dangerouslySetInnerHTML:{__html:v}}):void 0,href:h.link,onLinkClick:e=>{e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),window.nav.go(h.link,e.nativeEvent))}})},h.id)})),!H.length&&h&&A&&(0,i.jsx)("div",{className:"ChatSettingsMembersWidget__empty",children:o.getLang("mail_settings_not_found")}),!(h&&A)&&E&&(0,i.jsx)("div",{className:"ChatSettingsMembersWidget__more",onClick:this.onShowMore,children:o.getLang("mail_settings_show_all_members")})]})})]})}constructor(e){super(e),this.onToggleSearch=()=>{this.state.showSearch?this.setState({showSearch:!1,searchQuery:""}):(this.setState({showSearch:!0}),requestAnimationFrame((()=>{this.searchInput.focus()})))},this.onSearchChange=e=>{const t=e.target;t.value!==this.state.searchQuery&&this.setState({searchQuery:t.value})},this.onShowMore=()=>{const e=M[this.state.current];if(this.state[e]){const t={[e]:!1};this.setState(t)}},this.onTabClick=(e,t)=>{e.preventDefault(),this.state.current!==t&&this.setState({current:t})},this.onKeydown=e=>{this.state.showSearch&&27===e.keyCode&&(this.searchInput.blur(),this.setState({showSearch:!1,searchQuery:""}),e.preventDefault(),e.stopPropagation())},this.getInviter=e=>{if(this.invitersCache[e])return this.invitersCache[e];const{store:t}=this.props,s=t.get(),i=s.peer,n=s.tabs[i],r=n.inviters;if(!r[e])return"";const d=(0,c.getChatMembersByIds)(s,[r[e][0]])[0],_=(0,l.getSmDate)(r[e][2],s.timeshift,!0);if((0,h.isUserOwnerInChat)(n,e))return this.invitersCache[e]=o.getLang("mail_settings_owner"),o.getLang("mail_settings_owner");if(!d)return this.invitersCache[e]=_,_;const g=(0,l.langSex)(r[e][1],o.getLang("mail_chat_member_invited_by_X","raw")).replace(/{inviter}/,(0,a.replaceEntities)(d.name))+" "+_;return this.invitersCache[e]=g,g},this.isAddMemberWidgetShown=()=>{const e=this.props.store,{id:t,peer:s}=(0,A.unpackStore)(e),{current:i,showSearch:n,searchQuery:a}=this.state;return"all"===i&&!(n&&""!==a)&&(0,h.canInviteUser)(e,s,t)},this.getCommunityDescriptionText=e=>e?o.getLang("mail_settings_community"):o.getLang("mail_settings_bot"),this.getMemberDescriptionText=(e,t,s)=>{const i=t.tabs[t.peer];if(f.Ranges.isGroupId(e.id))return this.getCommunityDescriptionText(e.id===i.ownerId);if(s)return(0,c.getMessageRequestDateText)(e.date,t.timeshift);const n=i.membersLastSeen;return n&&n[e.id]?(0,c.getLastSeenText)(t,e.id,n[e.id],b):void 0},this.searchInputRef=e=>{this.searchInput=e};const t=e.store.get(),s=this.getMembers(t),i=this.getAdmins(t),n=this.getInvitedByMessageRequests(t);this.state={showSearch:!1,searchQuery:"",current:"all",all:s,allShowMore:s.length>x,admins:i,adminsShowMore:i.length>x,invitedByMR:n,invitedByMRShowMore:n.length>x},this.membersMap=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.searchIndexPromise=this.getSearchIndex(s).then((e=>{this.searchIndex=e})),this.invitersCache={}}}},189563:(e,t,s)=>{"use strict";s.d(t,{default:()=>w});var i=s(785893),n=s(667294),a=s(659397),o=s(221780),r=s(29271),l=s(840842),c=s(642144),h=s(512334),d=s(86894),_=s(898672),g=s(662230),p=s(205423),u=s(627240),m=s(921018),C=s(177878),S=s(161183),A=s(287865),I=s(689826),v=s(62340),L=s(439561),N=s(568012),f=s(527405),x=s(222009),b=s(995276),M=s(396316);class w extends n.Component{getPushSettingsFromProps(e){const t=e.store.get();return t.tabs[t.peer].notifications}getPushDisabledFromProps(e){const t=e.store.get();return t.tabs[t.peer].notifications.push_disabled}getDisabledPlaceholder(e){if(!e||0===e)return r.getLang("mail_settings_configure");if(-1===e)return r.getLang("mail_settings_time_forever");const t=(0,o.getShortDateWithTime)(e,0,!1);return`${r.getLang("mail_settings_until")} ${t}`}getDisabledOptions(){const e=[{label:r.getLang("mail_settings_time_one_hour"),value:m.HOUR},{label:r.getLang("mail_settings_time_eight_hours"),value:8*m.HOUR},{label:r.getLang("mail_settings_time_day"),value:m.DAY},{label:r.getLang("mail_settings_time_week"),value:m.WEEK},{label:r.getLang("mail_settings_time_forever"),value:-1}];return this.state.push_disabled_until?[...e,{label:r.getLang("mail_settings_time_cancel"),value:0}]:e}render(){const{store:e,flagsUpdated:t,notificationSettingsUpdated:s,disableUntilUpdated:n,onHideStatus:o,invitationLinks:m,isInvitationLinkWithHistory:w}=this.props,T=e.get(),k=T.tabs[T.peer],j=(0,f.isFvkcomgroup)(T,T.peer),H=(0,x.isCommunityChat)(T,T.peer),y=k.inviteLinks&&(0,N.canSeeInviteLink)(e)||(0,N.canChangeInviteLink)(e),E=m||k.inviteLinks,O=E&&(w?E.linkWithHistory:E.linkWithoutHistory),R=(0,N.canSeeSettingsItem)(e,T.peer,T.id),G=(0,a.classNames)("ChatSettingsMenu",{"ChatSettingsMenu--copied":this.state.copied}),P=T.isMassMentionsMessageAllowed,U=w?r.getLang("mail_get_invite_link_copy_with_history"):r.getLang("mail_get_invite_link_copy_without_history");return(0,i.jsxs)("div",{className:"ChatSettings__pane",children:[H&&(0,i.jsx)(c.default,{className:G,children:(0,i.jsx)(h.default,{onClick:e=>window.nav.go(k.owner.link,e.nativeEvent),chevron:!0,className:"ChatSettingsMenu__owner",children:(0,i.jsx)(p.default,{size:"28",title:k.owner.title,photo:k.owner.photo,href:k.owner.link,description:k.owner.description})})}),(0,i.jsx)(c.default,{className:G,children:(0,i.jsxs)(h.default,{onClick:this.props.showAttachments,chevron:!0,children:[(0,i.jsx)(C.ChatSettingsRoundedIcon,{backgroundColor:"blue",children:(0,i.jsx)(S.Icon16Attach,{})}),r.getLang("mail_im_show_media_history")]})}),(0,M.isUGCStickersEnabled)()&&(0,i.jsx)(c.default,{className:G,children:(0,i.jsx)(b.ChatSettingsUGCStickers,{peerId:T.peer})}),(0,i.jsxs)(c.default,{className:G,children:[P&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(h.default,{selectable:!1,chevron:!1,aside:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Text,{weight:"3",className:(0,a.classNames)("ChatSettingsMenu__saved",(0,_.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,i.jsx)(g.BlinkText,{shown:s,onHide:o,children:r.getLang("global_changes_saved_short")})}),(0,i.jsx)(u.default,{className:"ChatSettingsMenu__select",onChange:this.onMentionSettingsChange,options:[{label:r.getLang("mail_settings_mentions_all"),value:0},{label:r.getLang("mail_settings_mentions_except"),value:1},{label:r.getLang("mail_settings_mentions_disable"),value:2}],value:this.state.mentions_push_disabled})]}),children:[(0,i.jsx)(C.ChatSettingsRoundedIcon,{children:(0,i.jsx)(A.Icon28MentionCircleFillBlue,{})}),r.getLang("mail_settings_mentions")]}),(0,i.jsxs)(h.default,{selectable:!1,aside:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Text,{weight:"3",className:(0,a.classNames)("ChatSettingsMenu__saved",(0,_.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,i.jsx)(g.BlinkText,{shown:n,onHide:o,children:r.getLang("global_changes_saved_short")})}),(0,i.jsx)(u.default,{className:"ChatSettingsMenu__select",onChange:this.onDisabledSettingsChange,options:this.getDisabledOptions(),placeholder:this.state.disabledPlaceholder})]}),children:[(0,i.jsx)(C.ChatSettingsRoundedIcon,{children:(0,i.jsx)(I.Icon28AdvertisingCircleFillRed,{})}),r.getLang("mail_settings_notices")]})]}),(y||R)&&(0,i.jsxs)(i.Fragment,{children:[y&&(0,i.jsxs)(h.default,{onClick:this.onShowInviteLink,chevron:(0,N.canChangeInviteLink)(e),children:[(0,i.jsx)(C.ChatSettingsRoundedIcon,{children:(0,i.jsx)(v.Icon28ChainCircleFillBlue,{})}),j?r.getLang("mail_vkcomgroup_invite_link"):r.getLang("mail_chat_invite_link"),O&&(0,i.jsxs)("span",{className:"ChatSettingsMenu__invite",children:[(0,i.jsx)("span",{className:"ChatSettingsMenu__hidden",children:(0,i.jsx)("input",{type:"text",readOnly:!0,value:O,ref:this.getHiddenInput})}),(0,i.jsx)(d.Text,{weight:"3",className:(0,a.classNames)("ChatSettingsMenu__copied",(0,_.getColorClass)("color_text_secondary")),Component:"span",normalize:!1,children:(0,i.jsx)(g.BlinkText,{shown:this.state.copied,onHide:this.onBlinkTextHide,children:r.getLang("mail_invite_link_copied")})}),(0,i.jsx)(l.default,{className:"ChatSettingsMenu__copy",onClick:this.onCopyInviteLink,children:U})]})]}),R&&(0,i.jsxs)(h.default,{onClick:this.props.showSettings,chevron:!0,aside:(0,i.jsx)(d.Text,{weight:"3",className:(0,_.getColorClass)("color_text_secondary"),Component:"span",normalize:!1,children:(0,i.jsx)(g.BlinkText,{shown:t,onHide:o,children:r.getLang("global_changes_saved")})}),children:[(0,i.jsx)(C.ChatSettingsRoundedIcon,{children:(0,i.jsx)(L.Icon28MoreHorizontalCircleFillGray,{})}),r.getLang("mail_settings_options")]})]})]})]})}constructor(e){super(e),this.onCopyInviteLink=e=>{this.input&&(this.input.focus(),this.input.select(),document.execCommand("copy"),this.setState({copied:!0})),e.preventDefault(),e.stopPropagation()},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getHiddenInput=e=>{this.input=e},this.onDisabledSettingsChange=e=>{const t=Number(e.selected.value),s=t>0?Math.floor((Date.now()+t)/1e3):t,i=0!==s;this.setState({push_disabled_until:s?1:0,push_disabled:i?1:0,disabledPlaceholder:this.getDisabledPlaceholder(s)},(()=>{this.props.onUpdateNotificationSettings(i,Math.floor(t/1e3)).then((()=>{this.props.afterDisableUntilUpdated()}))}))},this.onMentionSettingsChange=e=>{const t=e.selected.value;this.setState({mentions_push_disabled:t},(()=>{this.props.onUpdateMentionNotificationSettings(t).then((()=>{this.props.afterNotificationSettingsUpdated()}))}))},this.onShowInviteLink=()=>{(0,N.canChangeInviteLink)(this.props.store)&&this.props.showInvitationLink()};const t=this.getPushSettingsFromProps(e),s=t.push_disabled_until,i=s>0?+new Date(s):s;this.state=Object.assign({pushDisabled:s,mentions_push_disabled:0,disabledPlaceholder:this.getDisabledPlaceholder(i),copied:!1,push_disabled_until:null,push_disabled:0},t)}}},177878:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsRoundedIcon:()=>a});var i=s(785893),n=s(659397);const a=({type:e,backgroundColor:t,children:s})=>(0,i.jsx)("div",{className:(0,n.classNames)("ChatSettingsRoundedIcon",`ChatSettingsRoundedIcon--${e}`,`ChatSettingsRoundedIcon--${t}`),children:s})},995276:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsUGCStickers:()=>_});var i=s(785893),n=s(967805),a=s(853224),o=s(96230),r=s(647742),l=s(70161),c=s(869048),h=s(86894);const d=({children:e})=>(0,i.jsx)(c.AppRootProvider,{platform:h.Platform.VKCOM,children:(0,i.jsx)("div",{children:e})}),_=({peerId:e})=>{var t;const s=(0,n.isActiveHint)(a.AvailableHelpHints.ACCOUNT_HINT_STICKERS_UGC_SETTINGS_UNSEEN,(null==(t=window.IM)?void 0:t.activeHints)||[]),c=()=>{s&&((0,n.hideHelpHint)(a.AvailableHelpHints.ACCOUNT_HINT_STICKERS_UGC_SETTINGS_UNSEEN),(0,n.deleteActiveHelpHintLocally)(a.AvailableHelpHints.ACCOUNT_HINT_STICKERS_UGC_SETTINGS_UNSEEN))},h=(0,l.useCanOpenMiniApp)(),{canHideKeyboard:_}=(0,l.useUGCInKeyboardState)(e);return h?(0,i.jsx)(d,{children:(0,i.jsx)(o.ChatSettingsUGCStickersEditor,{showStickersUGCBadge:s,peerId:e,onClick:c})}):_?(0,i.jsx)(d,{children:(0,i.jsx)(r.ChatSettingsUGCStickersUser,{showStickersUGCBadge:s,peerId:e,onClick:c})}):null}},145258:(e,t,s)=>{"use strict";s.d(t,{Badge:()=>o});var i=s(785893),n=s(86894),a=s(651656);const o=()=>(0,i.jsx)("div",{className:a.default.ugcBadge,children:(0,i.jsx)(n.Badge,{mode:"new"})})},96230:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsUGCStickersEditor:()=>g});var i=s(785893),n=s(29271),a=s(86894),o=s(829494),r=s(651118),l=s(691709),c=s(728405),h=s(145258),d=s(70161),_=s(651656);const g=({showStickersUGCBadge:e,peerId:t,onClick:s})=>{const g=(0,d.useCannotManageUGCStickers)();return(0,i.jsx)(l.UGCListItem,{subheader:g&&(0,i.jsx)(a.Text,{className:_.default.secondaryText,children:n.getLang("stickers_ugc_management_restricted")}),onClick:({nativeEvent:e})=>{var i;g?(0,o.showUGCManagementRestrictedModal)():((0,r.showUGCStickersSettings)(e,{peer_id:t,ref:"settings"}),null==(i=s)||i())},chevron:!g,aside:(0,i.jsxs)(i.Fragment,{children:[e&&(0,i.jsx)(h.Badge,{}),g&&(0,i.jsx)(c.Icon20InfoCircleOutline,{className:_.default.infoIcon})]})})}},647742:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsUGCStickersUser:()=>_});var i=s(785893),n=s(900798),a=s(29271),o=s(86894),r=s(691709),l=s(145258),c=s(560899),h=s(70161),d=s(651656);const _=({showStickersUGCBadge:e,peerId:t,onClick:s})=>{const{isKeyboardHidden:_}=(0,h.useUGCInKeyboardState)(t);return(0,i.jsx)(c.DropdownHideShowUGC,{peerId:t,children:(0,i.jsx)("div",{children:(0,i.jsx)(r.UGCListItem,{subheader:_&&(0,i.jsx)(o.Text,{className:d.default.secondaryText,children:a.getLang("stickers_ugc_management_stickers_hidden")}),chevron:!1,aside:(0,i.jsxs)("div",{className:d.default.userAside,children:[e&&(0,i.jsx)(l.Badge,{}),(0,i.jsx)(n.Icon16MoreVertical,{width:16,className:d.default.infoIcon})]}),onClick:s})})})}},560899:(e,t,s)=>{"use strict";s.d(t,{DropdownHideShowUGC:()=>r});var i=s(785893),n=s(384627),a=s(29271),o=s(70161);const r=({children:e,peerId:t})=>{const{isKeyboardHidden:s,toggle:r}=(0,o.useUGCInKeyboardState)(t),l=s?a.getLang("stickers_ugc_management_show_stickers"):a.getLang("stickers_ugc_management_hide_stickers"),c=s?"default":"destructive";return(0,i.jsx)(n.DropdownActionSheet,{offsetDistance:-10,offsetSkidding:-20,placement:"bottom-end",action:"click",content:(0,i.jsx)(n.DropdownActionSheet.Item,{type:c,onClick:r,children:l}),children:e})}},691709:(e,t,s)=>{"use strict";s.d(t,{UGCListItem:()=>c});var i=s(785893),n=s(512334),a=s(177878),o=s(685446),r=s(29271),l=s(651656);const c=({onClick:e,aside:t,chevron:s,subheader:c})=>(0,i.jsx)(n.default,{onClick:e,aside:t,chevron:s,children:(0,i.jsxs)("div",{className:l.default.listItem,children:[(0,i.jsx)(a.ChatSettingsRoundedIcon,{backgroundColor:"blue",children:(0,i.jsx)(o.Icon28UgcChatStickerCircleFillBlue,{className:l.default.ugcIcon})}),(0,i.jsxs)("div",{className:l.default.textWrapper,children:[r.getLang("stickers_ugc_chat_settings_menu"),c||null]})]})})},70161:(e,t,s)=>{"use strict";s.d(t,{useCanOpenMiniApp:()=>r,useCannotManageUGCStickers:()=>o,useUGCInKeyboardState:()=>l});var i=s(504190),n=s(667294),a=s(597765);const o=()=>{const{is_banned:e=!1,can_edit:t=!1}=(0,i.useStore)(a.$ugcInfo);return t&&e},r=()=>{const{is_banned:e=!1,can_edit:t=!1}=(0,i.useStore)(a.$ugcInfo);return t&&!e},l=e=>{const{can_hide_keyboard:t=!1,is_keyboard_hidden:s=!1}=(0,i.useStore)(a.$ugcInfo),o=(0,n.useCallback)((()=>{t&&(s?(0,a.showUgcFromKeyboardFx)(e):(0,a.hideUgcFromKeyboardFx)(e))}),[e,s,t]);return{canHideKeyboard:t,isKeyboardHidden:s,toggle:o}}},713871:(e,t,s)=>{"use strict";s.d(t,{onboardingHints:()=>c,showHintDefault:()=>l});var i=s(853224),n=s(104677),a=s(931917),o=s(967805);const r=e=>{var t;const s=null==(t=window.vk)?void 0:t.id;return!(!s||s===e)&&(a.Ranges.isUserId(e)||a.Ranges.isChatOrChannelPeer(e))},l=e=>!!window.IM.onboardingParams[e],c=[{hintId:i.AvailableHelpHints.IM_INTEGRATION_APPS_TOOLTIP_ON_PICKER,targetClass:".ms_item_more_label",callback:({target:e})=>{const t=document.createElement("span");return t.classList.add("ms_item_more_hintDot"),e.appendChild(t),t},needToShow:r},{hintId:i.AvailableHelpHints.IM_INTEGRATION_APPS_TOOLTIP_ON_PICKER,targetClass:'a[class*="app_action_mini_app"]:not(.ms_item--hidden)',callback:({hash:e,title:t,hintId:s,target:a})=>{if(!e||!t)return;const{tooltip:r}=(0,n.helpHintTooltip)(a,{content:t,helpHintHash:e,helpHintId:s,onHideRequestSent:()=>{const e=document.querySelector(".ms_item_more_hintDot");e&&(e.remove(),window.IM.activeHints=window.IM.activeHints.filter((({id:e})=>e!==i.AvailableHelpHints.IM_INTEGRATION_APPS_TOOLTIP_ON_PICKER)))}},{offset:[6,-21],align:"left",forceSide:"left",width:160,appendToParent:!0,withCloseButton:!1,cls:"feature_intro_blue_tt feature_info_tooltip helpHintTooltip__appActionTooltip"});return r.show(),r._ttel.addEventListener("click",(()=>r.hide())),(0,o.initOnboardingAutoHide)(r),r},needToShow:r}]},967805:(e,t,s)=>{"use strict";s.d(t,{deleteActiveHelpHintLocally:()=>_,destroyHintEl:()=>u,hideHelpHint:()=>d,initOnboarding:()=>S,initOnboardingAutoHide:()=>A,isActiveHint:()=>g,updateHints:()=>C});var i=s(11010),n=s(599809),a=s(853224),o=s(713871),r=s(970978),l=s(953908);const c=e=>{const{id:t}=e;return Object.values(a.AvailableHelpHints).map((e=>String(e))).includes(t)},h=()=>new Promise(((e,t)=>{(0,n.api)("account.getHelpHints",{}).then((t=>{const s=t.items.filter(c);e(s)})).catch((e=>{var s;return t((null==(s=e)?void 0:s.message)||e)}))})),d=e=>{(0,n.api)("account.hideHelpHint",{hint_id:e}).catch((e=>(0,r.logError)(e,{environment:"im_help_hints_app_action_hide"})))},_=e=>{var t;(null==(t=window.IM)?void 0:t.activeHints)&&(window.IM.activeHints=window.IM.activeHints.filter((({id:t})=>t!==e)))},g=(e,t)=>t.findIndex((({id:t})=>t===e))>-1,p=(e,t,s)=>{var i;const{hintId:n,targetClass:a,callback:r}=e,l=((e,t)=>t.find((({id:t})=>t===e)))(n,t),c=document.querySelector(a);if(!l||!c)return;const{id:h,title:d}=l,_={target:c,hintId:h,title:d,hash:null==(i=window.IM.onboardingParams[h])?void 0:i.hash};o.onboardingHints[s].element=r(_)},u=({element:e},t)=>{e&&((e=>e.hasOwnProperty("_ttel"))(e)?e.hide():e.remove(),o.onboardingHints[t].element=null)},m=(e,t,s)=>s?s(t):(0,o.showHintDefault)(e),C=(0,i._)((function*(e){e&&(window.IM.activeHints||(yield h().then((e=>{window.IM.activeHints=e}))),o.onboardingHints.forEach(((t,s)=>{const{element:i,needToShow:n,hintId:a}=t,o=m(a,e,n);o&&!i?p(t,window.IM.activeHints,s):!o&&i&&u(t,s)})))})),S=e=>{window.IM.onboardingParams=e,o.onboardingHints.length>0&&h().then((e=>{window.IM.activeHints=e,o.onboardingHints.forEach(((t,s)=>{var i;const{hintId:n}=t,a=null==(i=window.IMBRIDGE)?void 0:i.selectedPeer(),{needToShow:o}=t;if(!a)return;m(n,a,o)&&p(t,e,s)}))})).catch((e=>{(0,r.logError)(e,{environment:"im_help_hints_app_action"})}))},A=e=>{var t,s;let i,n=!1;const a=document.querySelector("._im_media_selector"),o=null==(t=a)?void 0:t.querySelector(".ms_items_more_wrap"),r=null==(s=o)?void 0:s.querySelector(".ms_items_more");function c(){clearTimeout(i),o&&o.classList.contains("shown")&&!n&&d()}function h(){i=setTimeout(c,3e3)}function d(){n||(e.hide(),n=!0,clearTimeout(i),a&&r&&((0,l.removeEvent)(a,"mouseover",h),(0,l.removeEvent)(r,"mousedown",d)))}a&&o&&r&&((0,l.addEvent)(a,"mouseover",h),(0,l.addEvent)(r,"mousedown",d))}},853224:(e,t,s)=>{"use strict";var i;s.d(t,{AvailableHelpHints:()=>i}),function(e){e.IM_INTEGRATION_APPS_TOOLTIP_ON_PICKER="superapp:im_integration_apps_tooltip_on_picker",e.ACCOUNT_HINT_IM_INTEGRATION_PICKER_APPS_BANNER="superapp:im_integration_picker_apps_banner",e.ACCOUNT_HINT_IM_INTEGRATION_PICKER_GAMES_BANNER="superapp:im_integration_picker_games_banner",e.ACCOUNT_HINT_IM_INTEGRATION_CATALOG_ONBOARDING="superapp:im_integration_catalog_onboarding",e.ACCOUNT_HINT_STICKERS_UGC_SETTINGS_UNSEEN="stickers:ugc_settings_unseen",e.ACCOUNT_HINT_VIDEO_INTERACTIVE_VIDEO_ONBOARDING="video:interactive_video_onboarding"}(i||(i={}))},196635:(e,t,s)=>{"use strict";s.d(t,{updateLazyLocation:()=>a,updateLocation:()=>n});var i=s(82161);function n(e,t){const s=(0,i.extend)({},window.nav.objLoc,e);Object.keys(s).filter((e=>""===s[e])).forEach((e=>{delete s[e]}));const n=window.nav.toStr(s);window.nav.setLoc(n,t)}function a(){let e={};return{scheduleNav(t){e=(0,i.extend)(e,t)},commitNav(){n(e),e={}},scheduleNavWithTimeOut(t,s=100){e=(0,i.extend)(e,t),setTimeout((()=>{n(e),e={}}),s)}}}},91983:(e,t,s)=>{"use strict";s.d(t,{kickUserOptimistically:()=>n});var i=s(408014);function n(e,t,s){const n=(0,i.getTab)(e,t);return n&&(0,i.isChatConvo)(n)?(n.memberIds=n.memberIds.filter((e=>e!==s)),n.adminIds=n.adminIds.filter((e=>e!==s)),n.membersCount=n.memberIds.length,Promise.resolve(e)):Promise.reject("No chat info")}},701567:(e,t,s)=>{"use strict";s.d(t,{ConvoAttaches:()=>_});var i=s(785893),n=s(928265),a=s(240567),o=s(442717),r=s(29271),l=s(973935),c=s(96190),h=s(869048);const d=({store:e,browserEnv:t,onClose:s,peerId:l})=>(0,i.jsx)(h.AppRootProvider,{children:(0,i.jsxs)(a.BaseModal,{onClose:s,disableBodyScroll:!0,className:"ConvoAttachesModal",children:[(0,i.jsx)(o.Modal.Header,{title:r.getLang("me_convo_attaches_app"),onClose:s}),(0,i.jsx)("div",{style:{width:550,height:420},children:(0,i.jsx)(n.ConvoAttachmentsApp,{store:e,env:t,peerId:c.resolveId(l),goToMessage:()=>{}})})]})});class _{renderConvoAttachesPopup(e,t,s){const n=_.getContainer(),a=()=>this.hide();n&&l.render((0,i.jsx)(d,{store:e,browserEnv:t,peerId:s,onClose:a}),n)}static getContainer(){return document.getElementById("ConvoAttaches")}hide(){if(!this.isMounted)return;const e=_.getContainer();e&&l.unmountComponentAtNode(e),this.isMounted=!1}show(e){var t;const s=null==(t=window.reforgedME)?void 0:t.convoAttachesContext;if(!s)return;const{store:i,browserEnv:n}=s;this.renderConvoAttachesPopup(i,n,e),this.isMounted=!0}constructor(){this.isMounted=!1}}},651118:(e,t,s)=>{"use strict";s.d(t,{StickersUGC:()=>h,showUGCStickersSettings:()=>c});var i=s(829596),n=s(95432),a=s(457299),o=s(494774),r=s(829494),l=s(640523);function c(e,t,s){(0,n.showApp)(e,o.UGC_STICKERS_APP_ID,!1,null,null,{layer:!0,urlHash:(0,l.getUGCAppHash)(t),onHide:()=>{var e;null==(e=s)||e()}})}const h={showAgeRestriction:r.showAgeRestriction,showChatRestriction:r.showChatRestriction,showUGCPackInStickerPicker:e=>{var t;e?null==(t=window.StickerPickerViewer)||t.showPack(i.ServicePackKey.UGC,e):(0,a.logStickersError)("No html element as prop into showUGCPackInStickerPicker")}}},829494:(e,t,s)=>{"use strict";s.d(t,{showAgeRestriction:()=>c,showChatRestriction:()=>h,showUGCManagementRestrictedModal:()=>l});var i=s(785893),n=s(895145),a=s(359639),o=s(991243);const r=400;function l(){const e=(0,n.asyncComponent)((()=>Promise.all([s.e(79852),s.e(13503)]).then(s.bind(s,406857))),(({UGCManagementRestrictedModal:e})=>e));(0,a.showMessageBoxModalSuspense)((({onClose:t})=>(0,i.jsx)(e,{onClose:t,lang:(0,o.getLangCode)()})),{width:r})}function c(){const e=(0,n.asyncComponent)((()=>Promise.all([s.e(79852),s.e(13503)]).then(s.bind(s,406857))),(({AgeRestrictionModal:e})=>e));(0,a.showMessageBoxModalSuspense)((({onClose:t})=>(0,i.jsx)(e,{onClose:t,lang:(0,o.getLangCode)()})),{width:r})}function h(){const e=(0,n.asyncComponent)((()=>Promise.all([s.e(79852),s.e(13503)]).then(s.bind(s,406857))),(({ChatRestrictionModal:e})=>e));(0,a.showMessageBoxModalSuspense)((({onClose:t})=>(0,i.jsx)(e,{onClose:t,lang:(0,o.getLangCode)()})),{width:r})}},928265:(e,t,s)=>{"use strict";s.d(t,{ConvoAttachmentsApp:()=>l});var i=s(667294),n=s(682930),a=s(96190),o=s(389706),r=s(635800);const l=({store:e,env:t,peerId:s,goToMessage:l})=>{const[c,h]=(0,i.useState)(e.getState());(0,i.useEffect)((()=>e.subscribe(h)),[e]);const d=a.safeGet(c.peers,c.ownerId);return i.createElement(r.ErrorBoundary,{fallbackRender:()=>null,onError:e=>t.logger.error("[ConvoAttachmentsApp] Error",e)},i.createElement("div",{className:"ConvoAttachmentsApp MEConfig"},i.createElement(n.Provider,{env:t,state:c,dispatch:e.dispatch,featureFlags:e.featureFlags,owner:d},i.createElement(o.ConvoAttachments,{peerId:s,goToMessage:l}))))}},533425:(e,t,s)=>{"use strict";s.d(t,{ChatSettings:()=>b});var i=s(785893),n=s(667294),a=s(95432),o=s(527405),r=s(875610),l=s(95638),c=s(29271),h=s(705758),d=s(400856),_=s(589897),g=s(600998),p=s(198710),u=s(778555),m=s(189563),C=s(9654),S=s(763258),A=s(554254),I=s(568012),v=s(514986),L=s(222009),N=s(502478),f=s(408014),x=s(839470);class b extends n.Component{go(e,t){this.setState({section:e},(()=>{this.props.updatePopup(),t&&t()}))}getPopupTitle(){switch(this.state.section){case 1:return c.getLang("mail_settings_add_members");case 2:case 3:return c.getLang("mail_chat_invite_link");case 6:return c.getLang("mail_settings_options");default:return c.getLang("mail_settings_title")}}componentWillReceiveProps(e){const t=e.store.get(),s=t.peer,i=t.tabs[s];i.photoLarge||i.photoGrid||this.resync||(this.resync=!0,e.store.set(r.getChatDetails.bind(null,s)).then((()=>{this.resync=!0})))}componentDidMount(){this.props.updatePopup()}componentWillUnmount(){this.timers.forEach(clearTimeout)}render(){const{store:e,closePopup:t}=this.props,s=e.get(),n=s.peer,a=s.tabs[n],r=(0,o.isFvkcomgroup)(e,n),l=(0,L.isCasperChat)(e,n),h=(0,L.isCommunityChat)(e,n),v=!r&&!h||!e.get().gid,N=(0,I.canCloseChat)(e,n,s.id),x=(0,f.isClosedChat)(a),b=s.isChatTypeEditAllowed,M=r?c.getLang("mail_im_n_vkcomgroup_members",(0,o.getAliveMembersCount)(a)):c.getLang("mail_im_n_chat_members",(0,o.getAliveMembersCount)(a));return(0,i.jsxs)("section",{className:"ChatSettings",children:[(0,i.jsx)(d.ModalHeader,{onBack:()=>this.go(0),backLabel:0!==this.state.section?c.getLang("global_back"):void 0,onClose:t,closeAriaLabel:c.getLang("global_close"),children:this.getPopupTitle()}),0===this.state.section&&(0,i.jsxs)("div",{className:"ChatSettings__content",children:[(0,i.jsx)(g.ChatSettingsInfo,{peerId:n,store:e,photo:a.photoLarge,grid:a.photoGrid,title:a.name,flags:a.data.flags,isDefaultPhotoOwner:a.isDefaultPhotoOwner,isCasper:l,isDonutChat:a.isDonutChat,meta:M,description:""}),(0,i.jsx)(m.default,{store:e,showMembersSettings:()=>this.go(1),showAttachments:this.onShowAttachments,showInvitationLink:this.showInvitationLink,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks,showSettings:()=>this.go(6),notificationSettingsUpdated:this.state.notificationSettingsUpdated,disableUntilUpdated:this.state.disableUntilUpdated,flagsUpdated:this.state.flagsUpdated,onHideStatus:this.onHideStatus,onUpdateNotificationSettings:this.onUpdateNotificationSettings,onUpdateMentionNotificationSettings:this.onUpdateMentionNotificationSettings,afterNotificationSettingsUpdated:this.afterNotificationSettingsUpdated,afterDisableUntilUpdated:this.afterDisableUntilUpdated}),r?null:(0,i.jsx)("div",{className:"ChatSettings__pane",children:(0,i.jsx)(C.default,{store:e,onLeave:this.onLeave,showMembersSettings:()=>this.go(1),membersAdded:this.state.membersAdded,onHideStatus:this.onHideStatus,membersCount:this.state.membersCount})}),v&&(0,i.jsx)("div",{className:"ChatSettings__pane",children:(0,i.jsx)(_.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__leave",onClick:this.onLeave,children:r?c.getLang("mail_leave_channel"):c.getLang("mail_settings_leave")})}),N&&!x&&(0,i.jsx)("div",{className:"ChatSettings__pane",children:(0,i.jsx)(_.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__close",onClick:this.onChatClose,children:c.getLang("mail_settings_close")})}),N&&x&&a.canRestore&&(0,i.jsx)("div",{className:"ChatSettings__pane",children:(0,i.jsx)(_.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__restore",onClick:this.onChatRestore,children:c.getLang("mail_settings_restore")})})]}),1===this.state.section&&(0,i.jsx)(S.default,{store:e,afterSave:this.afterMembersAdded}),6===this.state.section&&(0,i.jsx)(A.ChatSettingsOptions,{isChatTypeEditAllowed:b,flags:a.data.flags,isCasperChatTab:l,isCommunityChat:h,allowedUpdateFlags:a.allowedUpdateFlags,back:()=>this.go(0),onSave:this.onUpdateFlags,afterSave:this.afterFlagsUpdated}),2===this.state.section&&(0,i.jsx)(p.default,{store:e,onReset:()=>this.go(3),onLinkHistoryOptionToggle:this.onLinkHistoryOptionToggle,reseted:this.state.invitationLinksReseted,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks}),3===this.state.section&&(0,i.jsx)(u.default,{onConfirm:this.onResetLink,onCancel:()=>this.go(2)})]})}constructor(e){super(e),this.showInvitationLink=()=>{const{store:e}=this.props,t=(0,h.unpackStore)(e),s=t.peer;return this.setState({invitationLoading:!0}),(0,r.getInviteLink)(s-2e9,t).then((([e])=>{this.setState({section:2,invitationLoading:!1,invitationLinks:e})}))},this.onUpdateNotificationSettings=(e,t)=>{const{store:s,parentMutations:i}=this.props,n=s.get().peer;return s.set(r.toggleMutePeer.bind(null,n,e,t)).then(i().updateState.bind(null,n))},this.onUpdateMentionNotificationSettings=e=>{const{store:t,parentMutations:s}=this.props,i=t.get().peer;return t.set(r.toggleMuteMentionsPeer.bind(null,i,e)).then(s().updateState.bind(null,i))},this.onUpdateFlags=e=>{const{store:t}=this.props,s=t.get(),i=s.peer,n=s.hasOwnProperty("onUpdateFlags")?s.onUpdateFlags.bind(null,i,e):e=>Promise.resolve(e);return(0,r.updateFlags)(i,e,s).then(n)},this.afterFlagsUpdated=()=>{this.go(0,(()=>this.setBlinkStatus({flagsUpdated:!0})))},this.afterMembersAdded=e=>{this.go(0,(()=>this.setBlinkStatus({membersAdded:!0,membersCount:e})))},this.afterNotificationSettingsUpdated=()=>{this.setBlinkStatus({notificationSettingsUpdated:!0})},this.afterDisableUntilUpdated=()=>{this.setBlinkStatus({disableUntilUpdated:!0})},this.setBlinkStatus=e=>{this.timers.push(setTimeout((()=>this.setState(e)),300))},this.onHideStatus=()=>{this.setState({membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1})},this.onLeave=()=>{const{store:e,closePopup:t}=this.props,s=e.get().peer,i=(0,o.isFvkcomgroup)(e,s),n=(0,v.showFastBox)({title:i?c.getLang("mail_leave_channel"):c.getLang("mail_chat_leave_title")},i?c.getLang("mail_vkcomgroup_leave_confirm"):c.getLang("mail_chat_leave_confirm"),i?c.getLang("mail_leave_channel"):c.getLang("mail_leave_chat"),(function(){e.set(r.unpinMessageOptimistic.bind(null,s)),e.set(r.leaveChat.bind(null,s)),n.hide(),t(),e.get().longpoll.push([(0,l.resetPeer)()])}),c.getLang("global_cancel"),(function(){n.hide()}))},this.onChatClose=()=>{const{store:e,closePopup:t}=this.props,{peer:s}=e.get(),i=(0,L.getTab)(e,s).data.flags,n=i&I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?i&~I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:i|I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE,a=(0,v.showFastBox)({title:c.getLang("global_warning")},c.getLang("mail_chat_close_confirm"),c.getLang("mail_close_chat"),(()=>{this.onUpdateFlags(n).then((()=>{a.hide(),t(),e.get().longpoll.push([(0,l.resetPeer)()])}))}),c.getLang("global_cancel"),(function(){a.hide()}))},this.onChatRestore=()=>{const{store:e,closePopup:t}=this.props,{peer:s}=e.get(),i=(0,L.getTab)(e,s).data.flags,n=i&I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?i&~I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:i|I.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE;this.onUpdateFlags(n).then(t)},this.onResetLink=()=>{const{store:e}=this.props,t=(0,h.unpackStore)(e),s=t.peer;return(0,r.resetInviteLink)(s,t).then((([e])=>{this.setState({invitationLinksReseted:!0,invitationLinks:e})}))},this.onShowAttachments=()=>{const e=(0,N.getPeer)(this.props.store);this.props.closePopup(),(0,x.partConfigEnabled)("me_fc_attaches_new_modal")?this.props.convoAttaches.show(e):(0,a.showWiki)({w:"history"+(0,o.convertPeerToUrl)(e)+"_photo"},null,{})},this.onLinkHistoryOptionToggle=()=>{const e=(0,N.getPeer)(this.props.store);this.setState((e=>({isInvitationLinkWithHistory:!e.isInvitationLinkWithHistory})),(()=>{this.props.updateHistoryLinkState(e,this.state.isInvitationLinkWithHistory)}))},this.state={section:0,invitationLinks:null,invitationLinksReseted:!1,isInvitationLinkWithHistory:this.props.isLinkWithHistorySelected,membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1},this.timers=[]}}},377841:(e,t,s)=>{"use strict";s.d(t,{default:()=>C});var i=s(785893),n=s(667294),a=s(29271),o=s(273192),r=s(752654),l=s(568012),c=s(875610),h=s(222009),d=s(149822),_=s(91983),g=s(705758),p=s(47304),u=s(931917),m=s(755320);class C extends n.Component{getMemberRole(e,t){const{storeData:s}=this.props,i=s.peer;return t===s.tabs[i].ownerId?a.getLang("mail_settings_owner"):e[t]?a.getLang("mail_settings_admin"):null}getActions(e){const{store:t,mid:s}=this.props,{id:i,peer:n}=(0,g.unpackStore)(t),o=i===s,r=(0,m.isMarusiaPeer)(s),c=[],d=(0,h.isCommunityChat)(t,n);if(r)return(0,l.canKickUser)(t,s)?[{text:a.getLang("mail_settings_kick"),onClick:this.kick}]:[];if(o)return d&&(0,h.isCommunityInterface)(t)?[]:[{text:a.getLang("mail_leave_chat"),onClick:this.props.onLeave}];if((0,l.canAddAdmin)(t,s)&&c.push({text:e[s]?a.getLang("mail_chat_remove_admin"):a.getLang("mail_settings_appoint_admin"),onClick:this.toggleAdmin}),(0,l.canKickUser)(t,s)&&c.push({text:a.getLang("mail_settings_kick"),onClick:this.kick}),u.Ranges.isGroupId(s)&&!e[s]){const e=(0,l.canSeeAllMessages)(t,t.get().peer,s),i=e?a.getLang("mail_settings_community_mentions_only"):a.getLang("mail_settings_community_full_access");c.push({text:i,onClick:this.changeAccess.bind(this,e)})}return c}render(){const{adminMap:e,storeData:t,mid:s,isMR:c}=this.props,{id:h}=t,d=!!e[h],_=this.getMemberRole(e,s),g=h===s,p=d&&this.getActions(e);return c?(0,i.jsx)(r.default,{text:a.getLang("mail_cancel_invitation"),position:"t",align:"right",children:(0,i.jsx)("span",{onClick:this.cancelMessageRequest,className:"ChatSettingsMembersEdit__kick"})}):(0,i.jsxs)(n.Fragment,{children:[_&&(0,i.jsx)("span",{className:"ChatSettingsMembersEdit__role",children:_}),p&&p.length>0&&(0,i.jsx)(o.default,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,data:this.getActions(e),children:(0,i.jsx)("span",{className:"ChatSettingsMembersEdit__actions"})}),!d&&!g&&(0,l.canKickUser)(t,s)&&(0,i.jsx)(r.default,{text:a.getLang("mail_settings_kick"),position:"t",align:"right",children:(0,i.jsx)("span",{onClick:this.kick,className:"ChatSettingsMembersEdit__kick"})}),!d&&g&&(0,i.jsx)(r.default,{text:a.getLang("mail_leave_chat"),position:"t",align:"right",children:(0,i.jsx)("span",{onClick:this.props.onLeave,className:"ChatSettingsMembersEdit__kick"})})]})}constructor(...e){super(...e),this.toggleAdmin=()=>{const{store:e,mid:t,adminMap:s}=this.props,i=e.get().peer,n=!s[t];e.set(c.toggleAdminOptimisticly.bind(null,i,t,n)),e.set(c.toggleAdmin.bind(null,i,t,n))},this.kick=()=>{const e=this.props.store,t=e.get().peer,s=this.props.mid;e.set((e=>(0,_.kickUserOptimistically)(e,t,s))),e.set((e=>(0,d.kickUserAction)(e,t,s))).catch(p.dummyCatch)},this.cancelMessageRequest=()=>{const e=this.props.store,t=e.get().peer,s=this.props.mid;e.set((e=>(0,d.cancelMessageRequestAction)(e,t,s))).catch(p.dummyCatch)},this.changeAccess=e=>{const t=this.props.store,s=t.get().peer,i=this.props.mid;t.set(c.changeCommunityAccess.bind(null,s,i,!e)).catch(p.dummyCatch)}}}},763258:(e,t,s)=>{"use strict";s.d(t,{default:()=>A});var i=s(785893),n=s(667294),a=s(664988),o=s(29271),r=s(659397),l=s(222009),c=s(875610),h=s(205423),d=s(422536),_=s(589897),g=s(282133),p=s(866781),u=s(514986),m=s(731062),C=s(408014);const S=()=>{};class A extends n.Component{resetSearch(e,t){const s=this.props.store.get(),i=(0,l.getTab)(s,s.peer);return(i.customChatMemberSearch?i.customChatMemberSearch(""):(0,c.searchLocalHints)("",this.props.store.get())).then((s=>this.setSearchResults(e,t,"",s)))}componentDidMount(){this.resetSearch()}render(){const e=Object.keys(this.state.selected).length,t="ChatSettingsMembers__entity";return(0,i.jsxs)("div",{className:"ChatSettingsMembers",children:[(0,i.jsx)(d.default,{className:"ChatSettingsMembers__multiSelect",tokens:this.state.selected.map((e=>({text:(0,a.unclean)(this.data[e].name),id:e}))),removeTokenPlaceholder:o.getLang("mail_create_chat_remove_user"),onRemoveToken:this.onRemoveToken,placeholder:o.getLang("mail_search_creation"),value:this.state.value,onChange:this.onChange,onSelect:this.onSelect,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:()=>{},notFoundText:o.getLang("mail_not_found"),autoFocus:!0,isSearching:this.isSearching,badge:this.getBadge(),children:this.state.found.map((e=>(0,i.jsx)("div",{className:(0,r.classNames)(t,{[`${t}--selected`]:this.selected[e]}),"data-id":e,children:(0,i.jsx)(h.default,{size:"34",title:this.data[e].name,photo:this.data[e].photo})},e)))}),(0,i.jsxs)(g.default,{alignment:"right",className:"ChatSettingsMembers__submitArea",children:[(0,i.jsx)(p.default,{checked:this.state.isShowHistoryChecked,onChange:this.onShowHistoryToggle,className:"ChatSettingsMembers__showHistory",children:o.getLang("mail_im_chat_add_members_show_history")}),(0,i.jsx)(_.default,{size:"m",disabled:0===e,onClick:this.onAddPeople,loading:this.state.loading,className:"ChatSettingsMembers__confirm",children:e<2?o.getLang("mail_append_chat"):o.getLang("mail_im_create_chat_with")})]})]})}constructor(e){super(e),this.onChange=e=>{const t=this.props.store.get(),s=e.target.value,i=(0,l.getTab)(t,t.peer);i.customChatMemberSearch?i.customChatMemberSearch(s).then((e=>(this.setSearchResults({},!1,s,e),s&&i.customChatMemberServerSearch?(this.isSearching=!0,i.customChatMemberServerSearch(s).catch((e=>{if("debounce"!==e)throw e}))):Promise.resolve([])))).then(this.appendSearchResults):(0,c.searchLocalHints)(s,t).then((e=>(this.setSearchResults({},!1,s,e),s?(this.isSearching=!0,this.serverSearch(s,e.map((e=>e.peerId)))):Promise.resolve([])))).then(this.appendSearchResults).catch((()=>{}))},this.serverSearch=(0,m.debouncedPromise)(((e,t)=>{const s=this.props.store;return(0,c.searchHints)(e,t,"friends",s.get())}),300),this.onRemoveToken=e=>new Promise((t=>{const s=this.state.selected.filter((t=>t!==e));this.selected=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.setState({selected:s},t)})),this.onSelect=e=>new Promise((t=>{const s=this.selected[e]?this.state.selected.filter((t=>t!==e)):[].concat(this.state.selected,e).filter(((e,t,s)=>s.indexOf(e)===t));this.selected=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.resetSearch({selected:s,value:""},t)})),this.onShowHistoryToggle=()=>{this.setState({isShowHistoryChecked:!this.state.isShowHistoryChecked})},this.onAddPeople=()=>{const e=this.props.store,t=e.get().peer,s=this.state.selected.map((e=>parseInt(e))),i=this.state.isShowHistoryChecked;this.setState({loading:!0}),e.set(c.addNewMember.bind(null,t,s,i)).then((()=>e.set(c.getChatDetails.bind(null,t)).then((()=>{this.selected={},this.resetSearch({selected:[],loading:!1},(()=>{this.props.afterSave(s.length)}))})))).catch((e=>{this.selected={},this.resetSearch({selected:[],loading:!1}),(0,u.showFastBox)(o.getLang("global_error"),e)}))},this.setSearchResults=(e,t,s,i)=>{const n=this.props.store.get(),a=(0,l.getTab)(n,n.peer);let o=[];i.forEach((e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===a.memberIds.indexOf(e.peerId)&&o.push(e.peerId)})),this.setState(Object.assign({},e,{found:o,value:s}),t||S)},this.appendSearchResults=e=>{const t=this.props.store.get(),s=(0,l.getTab)(t,t.peer);let i=this.state.found;e.forEach((e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===s.memberIds.indexOf(e.peerId)&&-1===i.indexOf(e.peerId)&&i.push(e.peerId)})),this.isSearching=!1,this.setState({found:i})},this.getBadge=()=>(0,C.getCurrentTab)(this.props.store).isDonutChat?(0,i.jsx)("div",{className:"BannerInfo ChatSettingsMembers__donutBadge",children:o.getLang("mail_dons_only_search")}):null,this.state={selected:[],value:"",loading:!1,found:[],isShowHistoryChecked:!0},this.data={},this.selected={}}}},554254:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsOptions:()=>N});var i=s(785893),n=s(667294),a=s(29271),o=s(642144),r=s(512334),l=s(627240),c=s(589897),h=s(282133),d=s(177878),_=s(883760),g=s(366582),p=s(469531),u=s(957228),m=s(287865),C=s(62340),S=s(776076),A=s(691324),I=s(382193),v=s(535505),L=s(568012);class N extends n.Component{render(){const{flags:e}=this.state,{isChatTypeEditAllowed:t,isCasperChatTab:s,isCommunityChat:n}=this.props,N=(e,t,s=0)=>[!n&&{value:e,label:a.getLang("mail_settings_only_owner")},{value:t,label:n?a.getLang("mail_settings_only_admins"):a.getLang("mail_settings_owner_and_admins")},{value:s,label:a.getLang("mail_settings_all_members")}].filter(Boolean);return(0,i.jsxs)("div",{className:"ChatSettingsOptions",children:[this.props.isChatCreation&&(0,i.jsx)(_.default,{flags:e,onSelectPreset:this.setFlags}),(0,i.jsxs)(o.default,{children:[(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE))&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE,options:N(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE),value:e&(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(g.Icon28AddCircleFillBlue,{})}),a.getLang("mail_settings_can_invite")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE))&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE,options:N(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE),value:e&(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(p.Icon28EditCircleFillBlue,{})}),a.getLang("mail_settings_can_edit_info")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN))&&!s&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN,options:N(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN),value:e&(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(u.Icon28PinCircleFillBlue,{})}),a.getLang("mail_settings_can_pin")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION))&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION,options:N(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION),value:e&(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(m.Icon28MentionCircleFillBlue,{})}),a.getLang("mail_settings_can_use_mass_mention")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK))&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK,options:N(0,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK,L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK),value:e&(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(C.Icon28ChainCircleFillBlue,{})}),a.getLang("mail_settings_can_see_invitation_link")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL))&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL,options:N(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL),value:e&(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(S.Icon28PhoneCircleFillGreen,{})}),a.getLang("mail_settings_can_start_group_call")]}),this.isAllowed(L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS)&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS,options:[{value:0,label:a.getLang("mail_settings_only_owner")},{value:L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS,label:a.getLang("mail_settings_owner_and_admins")}],value:e&L.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(A.Icon28UserCircleFillBlue,{})}),a.getLang("mail_settings_admins_can_add_admins")]}),(this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE)||this.isAllowed(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE))&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE+L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE,options:N(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE,L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE),value:e&(L.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE|L.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE)}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(I.Icon28PaletteFillBlue,{})}),a.getLang("mail_settings_can_change_style")]}),this.isAllowed(L.MAIL_CHAT_FLAG_SERVICE_CHAT)&&t&&(0,i.jsxs)(r.default,{selectable:!1,aside:(0,i.jsx)(l.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:L.MAIL_CHAT_FLAG_SERVICE_CHAT,options:[{value:0,label:a.getLang("mail_settings_service_simple")},{value:L.MAIL_CHAT_FLAG_SERVICE_CHAT,label:a.getLang("mail_settings_service_service")}],value:e&L.MAIL_CHAT_FLAG_SERVICE_CHAT}),children:[(0,i.jsx)(d.ChatSettingsRoundedIcon,{children:(0,i.jsx)(v.Icon28GearCircleFillGray,{})}),a.getLang("mail_settings_service")]})]}),(0,i.jsxs)(h.default,{alignment:"right",className:"ChatSettingsOptions__submitArena",children:[(0,i.jsx)(c.default,{size:"m",appearance:"tertiary",onClick:this.onCancel,children:a.getLang("global_cancel")}),(0,i.jsx)(c.default,{size:"m",onClick:this.onSave,loading:this.state.loading,children:a.getLang("global_save")})]})]})}constructor(e){super(e),this.onChange=e=>{const t=e.name,{value:s}=e.selected;this.setState((e=>({flags:s?e.flags&~t^s:e.flags&~t})))},this.onCancel=()=>{this.setState({flags:this.props.flags}),this.props.back()},this.onSave=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onSave(this.state.flags).then((()=>{this.setState({loading:!1},this.props.afterSave)})).catch((e=>{this.setState({loading:!1,flags:this.props.flags})})))},this.setFlags=e=>{this.setState({flags:e})},this.isAllowed=e=>{const t=this.props.allowedUpdateFlags;return!t||t.includes(e)},this.state={flags:e.flags,loading:!1}}}},883760:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var i=s(785893),n=s(667294),a=s(659397),o=s(45697),r=s.n(o),l=s(29271),c=s(9752),h=s(735347),d=s(839123);const _=149946368,g=33554432,p={regular:(0,i.jsx)(c.Icon56UsersOutline,{}),closed:(0,i.jsx)(h.Icon56LockOutline,{}),custom:(0,i.jsx)(d.Icon56SettingsOutline,{})};class u extends n.Component{componentWillReceiveProps(e){![g,_].includes(e.flags)&&this.setState({customFlags:e.flags,selectedPresetId:3})}render(){const e=this.state.customFlags?this.state.customFlags:this.props.flags,t=this.state.selectedPresetId,s="ChatSettingsPresetPanel__preset",n=[{id:1,title:l.getLang("mail_chat_creation_preset_regular"),icon:"regular",flags:g},{id:2,title:l.getLang("mail_chat_creation_preset_closed"),icon:"closed",flags:_},{id:3,title:l.getLang("mail_chat_creation_preset_custom"),icon:"custom",flags:e}];return(0,i.jsx)("div",{className:"ChatSettingsPresetPanel",children:n.map(((e,n)=>(0,i.jsxs)("div",{className:(0,a.classNames)(s,{[`${s}--selected`]:e.id===t}),onClick:this.selectPreset.bind(null,e.flags,e.id),children:[(0,i.jsx)("div",{className:"ChatSettingsPresetPanel__presetIcon",children:p[e.icon]}),(0,i.jsx)("div",{className:"ChatSettingsPresetPanel__presetTitle",children:e.title})]},n)))})}constructor(e){super(e),this.selectPreset=(e,t)=>{const s=3===this.state.selectedPresetId&&null!==this.state.customFlags;this.setState((e=>({selectedPresetId:t,customFlags:s?this.props.flags:e.customFlags}))),this.props.onSelectPreset(e)};const t=this.props.flags===_?2:this.props.flags===g?1:3;this.state={customFlags:3===t?this.props.flags:null,selectedPresetId:t}}}u.propTypes={flags:r().number,onSelectPreset:r().func}},778555:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var i=s(785893),n=s(667294),a=s(29271),o=s(589897),r=s(282133);class l extends n.Component{render(){return(0,i.jsxs)("div",{className:"ChatSettingsResetInvitationLink",children:[(0,i.jsx)("div",{className:"ChatSettingsResetInvitationLink__text",dangerouslySetInnerHTML:{__html:a.getLang("mail_chat_reset_link_warning")}}),(0,i.jsxs)(r.default,{alignment:"right",children:[(0,i.jsx)(o.default,{size:"m",appearance:"tertiary",onClick:this.props.onCancel,children:a.getLang("global_cancel")}),(0,i.jsx)(o.default,{size:"m",onClick:this.onConfirm,loading:this.state.loading,children:a.getLang("mail_chat_reset_link_confirm")})]})]})}constructor(e){super(e),this.onConfirm=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onConfirm().then((()=>{this.setState({loading:!1}),this.props.onCancel()})).catch((()=>this.setState({loading:!1}))))},this.state={}}}},349350:(e,t,s)=>{"use strict";s.d(t,{mount:()=>x});var i=s(785893),n=s(15080),a=s(795558),o=s(584356),r=(s(667294),s(973935)),l=s(533425),c=s(875610),h=s(222009),d=s(552666),_=s(502478),g=s(514986),p=s(701567),u=s(931917),m=s(869048);let C,S;function A(e,t){const s=ls.get("im_chats_no_invite_link_history")||[],i=u.Ranges.convertChatPeerIdToChatId(e),n=t?s.filter((e=>e!==i)):s.concat(i);ls.set("im_chats_no_invite_link_history",n)}function I(e,t){const s=N(),n=function(e){const t=(0,_.getPeer)(e),s=u.Ranges.convertChatPeerIdToChatId(t);return!(ls.get("im_chats_no_invite_link_history")||[]).includes(s)}(e);s&&r.render((0,i.jsx)(m.AppRootProvider,{children:(0,i.jsx)(l.ChatSettings,{store:e,closePopup:v.bind(null,e),updatePopup:L,isLinkWithHistorySelected:n,updateHistoryLinkState:A,parentMutations:t,convoAttaches:S})}),s)}function v(e){C&&C.hide();const t=e.get();t.hasOwnProperty("onClose")&&t.onClose()}function L(){C&&C.updateBoxCoords()}function N(){return document.querySelector("#ChatSettings")}function f(e){const t=document.querySelector("#box_layer_wrap"),s=document.querySelector("#box_loader"),i=(0,a.isVisible)(t);return{unmount(){const t=N();t&&r.unmountComponentAtNode(t),(0,n.destroyModule)(e)},showLoader(){(0,o.boxRefreshCoords)(s),(0,a.show)(s),i||(0,a.show)(t)},hideLoader(){(0,a.hide)(s),i||(0,a.hide)(t)}}}function x(e,t,s){const{bindMutations:i}=(0,n.createMutations)(f),a=t.get(),o=(0,n.createModule)({handlers:(e,t)=>{}}),r=a.peer,l=i(o);S=new p.ConvoAttaches(t,s);const _=function(e,t){t.get().peer===r?function(e,t){const s=(0,h.getTab)(e,e.get().peer);s&&s.data&&(0,h.isChatActive)(s)?I(e,t):v(e)}(t,s):e.unmount()}.bind(null,l),u={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:560,onShow(){I(t,s),t.subscribe(_),requestAnimationFrame((()=>C.updateBoxCoords()))},onHideAttempt:()=>(t.unsubscribe(_),l.unmount(),!0)};return l.showLoader(),t.set(c.getChatDetails.bind(null,r)).then((e=>{l.hideLoader();const t=(0,d.unpackStore)(e).peer;t&&t===r?C=new g.MessageBox(u).content('<div id="ChatSettings" class="ChatSettingsWrapper"></div>').show():l.unmount()})).catch((()=>{l.hideLoader(),l.unmount()})),l}}}]);try{stManager.done("dist/902866c362380432bb8fab2a5e67d693.e9996383472ce347626e.js")}catch(e){}